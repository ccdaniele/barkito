{"ast":null,"code":"'use strict'; // TODO: move anything related to tracing to TracingPlugin instead\n\nconst dc = require('diagnostics_channel');\n\nconst {\n  storage\n} = require('../../../datadog-core');\n\nclass Subscription {\n  constructor(event, handler) {\n    this._channel = dc.channel(event);\n\n    this._handler = (message, name) => {\n      const store = storage.getStore();\n\n      if (!store || !store.noop) {\n        handler(message, name);\n      }\n    };\n  }\n\n  enable() {\n    this._channel.subscribe(this._handler);\n  }\n\n  disable() {\n    this._channel.unsubscribe(this._handler);\n  }\n\n}\n\nmodule.exports = class Plugin {\n  constructor(tracer) {\n    this._subscriptions = [];\n    this._enabled = false;\n    this._tracer = tracer;\n  }\n\n  get tracer() {\n    return this._tracer._tracer;\n  }\n\n  enter(span, store) {\n    store = store || storage.getStore();\n    storage.enterWith({ ...store,\n      span\n    });\n  } // TODO: Implement filters on resource name for all plugins.\n\n  /** Prevents creation of spans here and for all async descendants. */\n\n\n  skip() {\n    storage.enterWith({\n      noop: true\n    });\n  }\n\n  addSub(channelName, handler) {\n    this._subscriptions.push(new Subscription(channelName, handler));\n  }\n\n  addError(error) {\n    const store = storage.getStore();\n    if (!store || !store.span) return;\n\n    if (!store.span._spanContext._tags['error']) {\n      store.span.setTag('error', error || 1);\n    }\n  }\n\n  configure(config) {\n    if (typeof config === 'boolean') {\n      config = {\n        enabled: config\n      };\n    }\n\n    this.config = config;\n\n    if (config.enabled && !this._enabled) {\n      this._enabled = true;\n\n      this._subscriptions.forEach(sub => sub.enable());\n    } else if (!config.enabled && this._enabled) {\n      this._enabled = false;\n\n      this._subscriptions.forEach(sub => sub.disable());\n    }\n  }\n\n};","map":{"version":3,"names":["dc","require","storage","Subscription","constructor","event","handler","_channel","channel","_handler","message","name","store","getStore","noop","enable","subscribe","disable","unsubscribe","module","exports","Plugin","tracer","_subscriptions","_enabled","_tracer","enter","span","enterWith","skip","addSub","channelName","push","addError","error","_spanContext","_tags","setTag","configure","config","enabled","forEach","sub"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/dd-trace/src/plugins/plugin.js"],"sourcesContent":["'use strict'\n\n// TODO: move anything related to tracing to TracingPlugin instead\n\nconst dc = require('diagnostics_channel')\nconst { storage } = require('../../../datadog-core')\n\nclass Subscription {\n  constructor (event, handler) {\n    this._channel = dc.channel(event)\n    this._handler = (message, name) => {\n      const store = storage.getStore()\n      if (!store || !store.noop) {\n        handler(message, name)\n      }\n    }\n  }\n\n  enable () {\n    this._channel.subscribe(this._handler)\n  }\n\n  disable () {\n    this._channel.unsubscribe(this._handler)\n  }\n}\n\nmodule.exports = class Plugin {\n  constructor (tracer) {\n    this._subscriptions = []\n    this._enabled = false\n    this._tracer = tracer\n  }\n\n  get tracer () {\n    return this._tracer._tracer\n  }\n\n  enter (span, store) {\n    store = store || storage.getStore()\n    storage.enterWith({ ...store, span })\n  }\n\n  // TODO: Implement filters on resource name for all plugins.\n  /** Prevents creation of spans here and for all async descendants. */\n  skip () {\n    storage.enterWith({ noop: true })\n  }\n\n  addSub (channelName, handler) {\n    this._subscriptions.push(new Subscription(channelName, handler))\n  }\n\n  addError (error) {\n    const store = storage.getStore()\n\n    if (!store || !store.span) return\n\n    if (!store.span._spanContext._tags['error']) {\n      store.span.setTag('error', error || 1)\n    }\n  }\n\n  configure (config) {\n    if (typeof config === 'boolean') {\n      config = { enabled: config }\n    }\n    this.config = config\n    if (config.enabled && !this._enabled) {\n      this._enabled = true\n      this._subscriptions.forEach(sub => sub.enable())\n    } else if (!config.enabled && this._enabled) {\n      this._enabled = false\n      this._subscriptions.forEach(sub => sub.disable())\n    }\n  }\n}\n"],"mappings":"AAAA,a,CAEA;;AAEA,MAAMA,EAAE,GAAGC,OAAO,CAAC,qBAAD,CAAlB;;AACA,MAAM;EAAEC;AAAF,IAAcD,OAAO,CAAC,uBAAD,CAA3B;;AAEA,MAAME,YAAN,CAAmB;EACjBC,WAAW,CAAEC,KAAF,EAASC,OAAT,EAAkB;IAC3B,KAAKC,QAAL,GAAgBP,EAAE,CAACQ,OAAH,CAAWH,KAAX,CAAhB;;IACA,KAAKI,QAAL,GAAgB,CAACC,OAAD,EAAUC,IAAV,KAAmB;MACjC,MAAMC,KAAK,GAAGV,OAAO,CAACW,QAAR,EAAd;;MACA,IAAI,CAACD,KAAD,IAAU,CAACA,KAAK,CAACE,IAArB,EAA2B;QACzBR,OAAO,CAACI,OAAD,EAAUC,IAAV,CAAP;MACD;IACF,CALD;EAMD;;EAEDI,MAAM,GAAI;IACR,KAAKR,QAAL,CAAcS,SAAd,CAAwB,KAAKP,QAA7B;EACD;;EAEDQ,OAAO,GAAI;IACT,KAAKV,QAAL,CAAcW,WAAd,CAA0B,KAAKT,QAA/B;EACD;;AAjBgB;;AAoBnBU,MAAM,CAACC,OAAP,GAAiB,MAAMC,MAAN,CAAa;EAC5BjB,WAAW,CAAEkB,MAAF,EAAU;IACnB,KAAKC,cAAL,GAAsB,EAAtB;IACA,KAAKC,QAAL,GAAgB,KAAhB;IACA,KAAKC,OAAL,GAAeH,MAAf;EACD;;EAES,IAANA,MAAM,GAAI;IACZ,OAAO,KAAKG,OAAL,CAAaA,OAApB;EACD;;EAEDC,KAAK,CAAEC,IAAF,EAAQf,KAAR,EAAe;IAClBA,KAAK,GAAGA,KAAK,IAAIV,OAAO,CAACW,QAAR,EAAjB;IACAX,OAAO,CAAC0B,SAAR,CAAkB,EAAE,GAAGhB,KAAL;MAAYe;IAAZ,CAAlB;EACD,CAd2B,CAgB5B;;EACA;;;EACAE,IAAI,GAAI;IACN3B,OAAO,CAAC0B,SAAR,CAAkB;MAAEd,IAAI,EAAE;IAAR,CAAlB;EACD;;EAEDgB,MAAM,CAAEC,WAAF,EAAezB,OAAf,EAAwB;IAC5B,KAAKiB,cAAL,CAAoBS,IAApB,CAAyB,IAAI7B,YAAJ,CAAiB4B,WAAjB,EAA8BzB,OAA9B,CAAzB;EACD;;EAED2B,QAAQ,CAAEC,KAAF,EAAS;IACf,MAAMtB,KAAK,GAAGV,OAAO,CAACW,QAAR,EAAd;IAEA,IAAI,CAACD,KAAD,IAAU,CAACA,KAAK,CAACe,IAArB,EAA2B;;IAE3B,IAAI,CAACf,KAAK,CAACe,IAAN,CAAWQ,YAAX,CAAwBC,KAAxB,CAA8B,OAA9B,CAAL,EAA6C;MAC3CxB,KAAK,CAACe,IAAN,CAAWU,MAAX,CAAkB,OAAlB,EAA2BH,KAAK,IAAI,CAApC;IACD;EACF;;EAEDI,SAAS,CAAEC,MAAF,EAAU;IACjB,IAAI,OAAOA,MAAP,KAAkB,SAAtB,EAAiC;MAC/BA,MAAM,GAAG;QAAEC,OAAO,EAAED;MAAX,CAAT;IACD;;IACD,KAAKA,MAAL,GAAcA,MAAd;;IACA,IAAIA,MAAM,CAACC,OAAP,IAAkB,CAAC,KAAKhB,QAA5B,EAAsC;MACpC,KAAKA,QAAL,GAAgB,IAAhB;;MACA,KAAKD,cAAL,CAAoBkB,OAApB,CAA4BC,GAAG,IAAIA,GAAG,CAAC3B,MAAJ,EAAnC;IACD,CAHD,MAGO,IAAI,CAACwB,MAAM,CAACC,OAAR,IAAmB,KAAKhB,QAA5B,EAAsC;MAC3C,KAAKA,QAAL,GAAgB,KAAhB;;MACA,KAAKD,cAAL,CAAoBkB,OAApB,CAA4BC,GAAG,IAAIA,GAAG,CAACzB,OAAJ,EAAnC;IACD;EACF;;AAhD2B,CAA9B"},"metadata":{},"sourceType":"script"}