{"ast":null,"code":"'use strict';\n\nconst URL = require('url').URL;\n\nconst log = require('../../log');\n\nconst Writer = require('./writer');\n\nclass AgentExporter {\n  constructor(config, prioritySampler) {\n    this._config = config;\n    const {\n      url,\n      hostname,\n      port,\n      lookup,\n      protocolVersion,\n      stats = {}\n    } = config;\n    this._url = url || new URL(`http://${hostname || 'localhost'}:${port}`);\n    const headers = {};\n\n    if (stats.enabled) {\n      headers['Datadog-Client-Computed-Stats'] = 'yes';\n    }\n\n    this._writer = new Writer({\n      url: this._url,\n      prioritySampler,\n      lookup,\n      protocolVersion,\n      headers\n    });\n    this._timer = undefined;\n    process.once('beforeExit', () => this._writer.flush());\n  }\n\n  setUrl(url) {\n    try {\n      url = new URL(url);\n      this._url = url;\n\n      this._writer.setUrl(url);\n    } catch (e) {\n      log.warn(e.stack);\n    }\n  }\n\n  export(spans) {\n    this._writer.append(spans);\n\n    const {\n      flushInterval\n    } = this._config;\n\n    if (flushInterval === 0) {\n      this._writer.flush();\n    } else if (flushInterval > 0 && !this._timer) {\n      this._timer = setTimeout(() => {\n        this._writer.flush();\n\n        this._timer = clearTimeout(this._timer);\n      }, flushInterval).unref();\n    }\n  }\n\n}\n\nmodule.exports = AgentExporter;","map":{"version":3,"names":["URL","require","log","Writer","AgentExporter","constructor","config","prioritySampler","_config","url","hostname","port","lookup","protocolVersion","stats","_url","headers","enabled","_writer","_timer","undefined","process","once","flush","setUrl","e","warn","stack","export","spans","append","flushInterval","setTimeout","clearTimeout","unref","module","exports"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/dd-trace/src/exporters/agent/index.js"],"sourcesContent":["'use strict'\n\nconst URL = require('url').URL\nconst log = require('../../log')\nconst Writer = require('./writer')\n\nclass AgentExporter {\n  constructor (config, prioritySampler) {\n    this._config = config\n    const { url, hostname, port, lookup, protocolVersion, stats = {} } = config\n    this._url = url || new URL(`http://${hostname || 'localhost'}:${port}`)\n\n    const headers = {}\n    if (stats.enabled) {\n      headers['Datadog-Client-Computed-Stats'] = 'yes'\n    }\n\n    this._writer = new Writer({\n      url: this._url,\n      prioritySampler,\n      lookup,\n      protocolVersion,\n      headers\n    })\n\n    this._timer = undefined\n    process.once('beforeExit', () => this._writer.flush())\n  }\n\n  setUrl (url) {\n    try {\n      url = new URL(url)\n      this._url = url\n      this._writer.setUrl(url)\n    } catch (e) {\n      log.warn(e.stack)\n    }\n  }\n\n  export (spans) {\n    this._writer.append(spans)\n\n    const { flushInterval } = this._config\n\n    if (flushInterval === 0) {\n      this._writer.flush()\n    } else if (flushInterval > 0 && !this._timer) {\n      this._timer = setTimeout(() => {\n        this._writer.flush()\n        this._timer = clearTimeout(this._timer)\n      }, flushInterval).unref()\n    }\n  }\n}\n\nmodule.exports = AgentExporter\n"],"mappings":"AAAA;;AAEA,MAAMA,GAAG,GAAGC,OAAO,CAAC,KAAD,CAAP,CAAeD,GAA3B;;AACA,MAAME,GAAG,GAAGD,OAAO,CAAC,WAAD,CAAnB;;AACA,MAAME,MAAM,GAAGF,OAAO,CAAC,UAAD,CAAtB;;AAEA,MAAMG,aAAN,CAAoB;EAClBC,WAAW,CAAEC,MAAF,EAAUC,eAAV,EAA2B;IACpC,KAAKC,OAAL,GAAeF,MAAf;IACA,MAAM;MAAEG,GAAF;MAAOC,QAAP;MAAiBC,IAAjB;MAAuBC,MAAvB;MAA+BC,eAA/B;MAAgDC,KAAK,GAAG;IAAxD,IAA+DR,MAArE;IACA,KAAKS,IAAL,GAAYN,GAAG,IAAI,IAAIT,GAAJ,CAAS,UAASU,QAAQ,IAAI,WAAY,IAAGC,IAAK,EAAlD,CAAnB;IAEA,MAAMK,OAAO,GAAG,EAAhB;;IACA,IAAIF,KAAK,CAACG,OAAV,EAAmB;MACjBD,OAAO,CAAC,+BAAD,CAAP,GAA2C,KAA3C;IACD;;IAED,KAAKE,OAAL,GAAe,IAAIf,MAAJ,CAAW;MACxBM,GAAG,EAAE,KAAKM,IADc;MAExBR,eAFwB;MAGxBK,MAHwB;MAIxBC,eAJwB;MAKxBG;IALwB,CAAX,CAAf;IAQA,KAAKG,MAAL,GAAcC,SAAd;IACAC,OAAO,CAACC,IAAR,CAAa,YAAb,EAA2B,MAAM,KAAKJ,OAAL,CAAaK,KAAb,EAAjC;EACD;;EAEDC,MAAM,CAAEf,GAAF,EAAO;IACX,IAAI;MACFA,GAAG,GAAG,IAAIT,GAAJ,CAAQS,GAAR,CAAN;MACA,KAAKM,IAAL,GAAYN,GAAZ;;MACA,KAAKS,OAAL,CAAaM,MAAb,CAAoBf,GAApB;IACD,CAJD,CAIE,OAAOgB,CAAP,EAAU;MACVvB,GAAG,CAACwB,IAAJ,CAASD,CAAC,CAACE,KAAX;IACD;EACF;;EAEDC,MAAM,CAAEC,KAAF,EAAS;IACb,KAAKX,OAAL,CAAaY,MAAb,CAAoBD,KAApB;;IAEA,MAAM;MAAEE;IAAF,IAAoB,KAAKvB,OAA/B;;IAEA,IAAIuB,aAAa,KAAK,CAAtB,EAAyB;MACvB,KAAKb,OAAL,CAAaK,KAAb;IACD,CAFD,MAEO,IAAIQ,aAAa,GAAG,CAAhB,IAAqB,CAAC,KAAKZ,MAA/B,EAAuC;MAC5C,KAAKA,MAAL,GAAca,UAAU,CAAC,MAAM;QAC7B,KAAKd,OAAL,CAAaK,KAAb;;QACA,KAAKJ,MAAL,GAAcc,YAAY,CAAC,KAAKd,MAAN,CAA1B;MACD,CAHuB,EAGrBY,aAHqB,CAAV,CAGIG,KAHJ,EAAd;IAID;EACF;;AA9CiB;;AAiDpBC,MAAM,CAACC,OAAP,GAAiBhC,aAAjB"},"metadata":{},"sourceType":"script"}