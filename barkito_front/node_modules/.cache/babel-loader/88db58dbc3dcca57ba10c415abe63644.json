{"ast":null,"code":"'use strict';\n\nconst {\n  SubscriptionManager,\n  Context\n} = require('./engine');\n\nconst als = require('../als');\n\nconst manager = new SubscriptionManager();\nContext.setManager(manager);\n\nfunction startContext() {\n  const store = new Map();\n  store.set('context', new Context());\n  als.enterWith(store);\n  return store;\n}\n\nfunction getContext() {\n  const store = als.getStore();\n  return store && store.get('context');\n}\n\nfunction propagate(data) {\n  let context = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : getContext();\n  if (!context) return;\n  const keys = Object.keys(data);\n\n  for (let i = 0; i < keys.length; ++i) {\n    const key = keys[i];\n\n    if (manager.addresses.has(key)) {\n      context.setValue(key, data[key]);\n    }\n  }\n\n  context.dispatch();\n}\n\nmodule.exports = {\n  manager,\n  startContext,\n  getContext,\n  propagate\n};","map":{"version":3,"names":["SubscriptionManager","Context","require","als","manager","setManager","startContext","store","Map","set","enterWith","getContext","getStore","get","propagate","data","context","keys","Object","i","length","key","addresses","has","setValue","dispatch","module","exports"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/dd-trace/src/appsec/gateway/engine/index.js"],"sourcesContent":["'use strict'\n\nconst { SubscriptionManager, Context } = require('./engine')\nconst als = require('../als')\n\nconst manager = new SubscriptionManager()\nContext.setManager(manager)\n\nfunction startContext () {\n  const store = new Map()\n\n  store.set('context', new Context())\n\n  als.enterWith(store)\n\n  return store\n}\n\nfunction getContext () {\n  const store = als.getStore()\n\n  return store && store.get('context')\n}\n\nfunction propagate (data, context = getContext()) {\n  if (!context) return\n\n  const keys = Object.keys(data)\n\n  for (let i = 0; i < keys.length; ++i) {\n    const key = keys[i]\n\n    if (manager.addresses.has(key)) {\n      context.setValue(key, data[key])\n    }\n  }\n\n  context.dispatch()\n}\n\nmodule.exports = {\n  manager,\n  startContext,\n  getContext,\n  propagate\n}\n"],"mappings":"AAAA;;AAEA,MAAM;EAAEA,mBAAF;EAAuBC;AAAvB,IAAmCC,OAAO,CAAC,UAAD,CAAhD;;AACA,MAAMC,GAAG,GAAGD,OAAO,CAAC,QAAD,CAAnB;;AAEA,MAAME,OAAO,GAAG,IAAIJ,mBAAJ,EAAhB;AACAC,OAAO,CAACI,UAAR,CAAmBD,OAAnB;;AAEA,SAASE,YAAT,GAAyB;EACvB,MAAMC,KAAK,GAAG,IAAIC,GAAJ,EAAd;EAEAD,KAAK,CAACE,GAAN,CAAU,SAAV,EAAqB,IAAIR,OAAJ,EAArB;EAEAE,GAAG,CAACO,SAAJ,CAAcH,KAAd;EAEA,OAAOA,KAAP;AACD;;AAED,SAASI,UAAT,GAAuB;EACrB,MAAMJ,KAAK,GAAGJ,GAAG,CAACS,QAAJ,EAAd;EAEA,OAAOL,KAAK,IAAIA,KAAK,CAACM,GAAN,CAAU,SAAV,CAAhB;AACD;;AAED,SAASC,SAAT,CAAoBC,IAApB,EAAkD;EAAA,IAAxBC,OAAwB,uEAAdL,UAAU,EAAI;EAChD,IAAI,CAACK,OAAL,EAAc;EAEd,MAAMC,IAAI,GAAGC,MAAM,CAACD,IAAP,CAAYF,IAAZ,CAAb;;EAEA,KAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,IAAI,CAACG,MAAzB,EAAiC,EAAED,CAAnC,EAAsC;IACpC,MAAME,GAAG,GAAGJ,IAAI,CAACE,CAAD,CAAhB;;IAEA,IAAIf,OAAO,CAACkB,SAAR,CAAkBC,GAAlB,CAAsBF,GAAtB,CAAJ,EAAgC;MAC9BL,OAAO,CAACQ,QAAR,CAAiBH,GAAjB,EAAsBN,IAAI,CAACM,GAAD,CAA1B;IACD;EACF;;EAEDL,OAAO,CAACS,QAAR;AACD;;AAEDC,MAAM,CAACC,OAAP,GAAiB;EACfvB,OADe;EAEfE,YAFe;EAGfK,UAHe;EAIfG;AAJe,CAAjB"},"metadata":{},"sourceType":"script"}