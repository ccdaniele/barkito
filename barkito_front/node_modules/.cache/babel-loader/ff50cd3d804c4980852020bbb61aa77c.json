{"ast":null,"code":"'use strict';\n\nconst Plugin = require('./plugin');\n\nconst {\n  storage\n} = require('../../../datadog-core');\n\nconst analyticsSampler = require('../analytics_sampler');\n\nclass TracingPlugin extends Plugin {\n  constructor() {\n    super(...arguments);\n    this.component = this.constructor.component || this.constructor.name;\n    this.operation = this.constructor.operation;\n    this.addTraceSub('start', message => {\n      this.start(message);\n    });\n    this.addTraceSub('error', err => {\n      this.error(err);\n    });\n    this.addTraceSub('finish', message => {\n      this.finish(message);\n    });\n  }\n\n  configure(config) {\n    return super.configure({ ...config,\n      hooks: {\n        [this.operation]: () => {},\n        ...config.hooks\n      }\n    });\n  }\n\n  start() {} // implemented by individual plugins\n\n\n  finish() {\n    this.activeSpan().finish();\n  }\n\n  error(error) {\n    this.addError(error);\n  }\n\n  addTraceSub(eventName, handler) {\n    this.addSub(`apm:${this.component}:${this.operation}:${eventName}`, handler);\n  }\n\n  addError(error) {\n    const span = this.activeSpan();\n\n    if (!span._spanContext._tags['error']) {\n      span.setTag('error', error || 1);\n    }\n  }\n\n  startSpan(name) {\n    let {\n      childOf,\n      kind,\n      meta,\n      metrics,\n      service,\n      resource,\n      type\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const store = storage.getStore();\n\n    if (store && childOf === undefined) {\n      childOf = store.span;\n    }\n\n    const span = this.tracer.startSpan(name, {\n      tags: {\n        'service.name': service,\n        'resource.name': resource,\n        'span.kind': kind,\n        'span.type': type,\n        ...meta,\n        ...metrics\n      }\n    });\n    analyticsSampler.sample(span, this.config.measured);\n    storage.enterWith({ ...store,\n      span\n    });\n    return span;\n  }\n\n  activeSpan() {\n    const store = storage.getStore();\n    return store && store.span;\n  }\n\n}\n\nmodule.exports = TracingPlugin;","map":{"version":3,"names":["Plugin","require","storage","analyticsSampler","TracingPlugin","constructor","component","name","operation","addTraceSub","message","start","err","error","finish","configure","config","hooks","activeSpan","addError","eventName","handler","addSub","span","_spanContext","_tags","setTag","startSpan","childOf","kind","meta","metrics","service","resource","type","store","getStore","undefined","tracer","tags","sample","measured","enterWith","module","exports"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/dd-trace/src/plugins/tracing.js"],"sourcesContent":["'use strict'\n\nconst Plugin = require('./plugin')\nconst { storage } = require('../../../datadog-core')\nconst analyticsSampler = require('../analytics_sampler')\n\nclass TracingPlugin extends Plugin {\n  constructor (...args) {\n    super(...args)\n\n    this.component = this.constructor.component || this.constructor.name\n    this.operation = this.constructor.operation\n\n    this.addTraceSub('start', message => {\n      this.start(message)\n    })\n\n    this.addTraceSub('error', err => {\n      this.error(err)\n    })\n\n    this.addTraceSub('finish', message => {\n      this.finish(message)\n    })\n  }\n\n  configure (config) {\n    return super.configure({\n      ...config,\n      hooks: {\n        [this.operation]: () => {},\n        ...config.hooks\n      }\n    })\n  }\n\n  start () {} // implemented by individual plugins\n\n  finish () {\n    this.activeSpan().finish()\n  }\n\n  error (error) {\n    this.addError(error)\n  }\n\n  addTraceSub (eventName, handler) {\n    this.addSub(`apm:${this.component}:${this.operation}:${eventName}`, handler)\n  }\n\n  addError (error) {\n    const span = this.activeSpan()\n\n    if (!span._spanContext._tags['error']) {\n      span.setTag('error', error || 1)\n    }\n  }\n\n  startSpan (name, { childOf, kind, meta, metrics, service, resource, type } = {}) {\n    const store = storage.getStore()\n\n    if (store && childOf === undefined) {\n      childOf = store.span\n    }\n\n    const span = this.tracer.startSpan(name, {\n      tags: {\n        'service.name': service,\n        'resource.name': resource,\n        'span.kind': kind,\n        'span.type': type,\n        ...meta,\n        ...metrics\n      }\n    })\n\n    analyticsSampler.sample(span, this.config.measured)\n\n    storage.enterWith({ ...store, span })\n\n    return span\n  }\n\n  activeSpan () {\n    const store = storage.getStore()\n\n    return store && store.span\n  }\n}\n\nmodule.exports = TracingPlugin\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}