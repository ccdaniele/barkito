{"ast":null,"code":"'use strict';\n\nconst {\n  storage\n} = require('../../datadog-core'); // TODO: refactor bind to use shimmer once the new internal tracer lands\n\n\nconst originals = new WeakMap();\n\nclass Scope {\n  active() {\n    const store = storage.getStore();\n    return store && store.span || null;\n  }\n\n  activate(span, callback) {\n    if (typeof callback !== 'function') return callback;\n    const oldStore = storage.getStore();\n    const newStore = span ? span._store : oldStore;\n    storage.enterWith({ ...newStore,\n      span\n    });\n\n    try {\n      return callback();\n    } catch (e) {\n      if (span && typeof span.setTag === 'function') {\n        span.setTag('error', e);\n      }\n\n      throw e;\n    } finally {\n      storage.enterWith(oldStore);\n    }\n  }\n\n  bind(fn, span) {\n    if (typeof fn !== 'function') return fn;\n    const scope = this;\n\n    const spanOrActive = this._spanOrActive(span);\n\n    const bound = function () {\n      return scope.activate(spanOrActive, () => {\n        return fn.apply(this, arguments);\n      });\n    };\n\n    originals.set(bound, fn);\n    return bound;\n  }\n\n  _spanOrActive(span) {\n    return span !== undefined ? span : this.active();\n  }\n\n  _isPromise(promise) {\n    return promise && typeof promise.then === 'function';\n  }\n\n}\n\nmodule.exports = Scope;","map":{"version":3,"names":["storage","require","originals","WeakMap","Scope","active","store","getStore","span","activate","callback","oldStore","newStore","_store","enterWith","e","setTag","bind","fn","scope","spanOrActive","_spanOrActive","bound","apply","arguments","set","undefined","_isPromise","promise","then","module","exports"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/dd-trace/src/scope.js"],"sourcesContent":["'use strict'\n\nconst { storage } = require('../../datadog-core')\n\n// TODO: refactor bind to use shimmer once the new internal tracer lands\n\nconst originals = new WeakMap()\n\nclass Scope {\n  active () {\n    const store = storage.getStore()\n\n    return (store && store.span) || null\n  }\n\n  activate (span, callback) {\n    if (typeof callback !== 'function') return callback\n\n    const oldStore = storage.getStore()\n    const newStore = span ? span._store : oldStore\n\n    storage.enterWith({ ...newStore, span })\n\n    try {\n      return callback()\n    } catch (e) {\n      if (span && typeof span.setTag === 'function') {\n        span.setTag('error', e)\n      }\n\n      throw e\n    } finally {\n      storage.enterWith(oldStore)\n    }\n  }\n\n  bind (fn, span) {\n    if (typeof fn !== 'function') return fn\n\n    const scope = this\n    const spanOrActive = this._spanOrActive(span)\n\n    const bound = function () {\n      return scope.activate(spanOrActive, () => {\n        return fn.apply(this, arguments)\n      })\n    }\n\n    originals.set(bound, fn)\n\n    return bound\n  }\n\n  _spanOrActive (span) {\n    return span !== undefined ? span : this.active()\n  }\n\n  _isPromise (promise) {\n    return promise && typeof promise.then === 'function'\n  }\n}\n\nmodule.exports = Scope\n"],"mappings":"AAAA;;AAEA,MAAM;EAAEA;AAAF,IAAcC,OAAO,CAAC,oBAAD,CAA3B,C,CAEA;;;AAEA,MAAMC,SAAS,GAAG,IAAIC,OAAJ,EAAlB;;AAEA,MAAMC,KAAN,CAAY;EACVC,MAAM,GAAI;IACR,MAAMC,KAAK,GAAGN,OAAO,CAACO,QAAR,EAAd;IAEA,OAAQD,KAAK,IAAIA,KAAK,CAACE,IAAhB,IAAyB,IAAhC;EACD;;EAEDC,QAAQ,CAAED,IAAF,EAAQE,QAAR,EAAkB;IACxB,IAAI,OAAOA,QAAP,KAAoB,UAAxB,EAAoC,OAAOA,QAAP;IAEpC,MAAMC,QAAQ,GAAGX,OAAO,CAACO,QAAR,EAAjB;IACA,MAAMK,QAAQ,GAAGJ,IAAI,GAAGA,IAAI,CAACK,MAAR,GAAiBF,QAAtC;IAEAX,OAAO,CAACc,SAAR,CAAkB,EAAE,GAAGF,QAAL;MAAeJ;IAAf,CAAlB;;IAEA,IAAI;MACF,OAAOE,QAAQ,EAAf;IACD,CAFD,CAEE,OAAOK,CAAP,EAAU;MACV,IAAIP,IAAI,IAAI,OAAOA,IAAI,CAACQ,MAAZ,KAAuB,UAAnC,EAA+C;QAC7CR,IAAI,CAACQ,MAAL,CAAY,OAAZ,EAAqBD,CAArB;MACD;;MAED,MAAMA,CAAN;IACD,CARD,SAQU;MACRf,OAAO,CAACc,SAAR,CAAkBH,QAAlB;IACD;EACF;;EAEDM,IAAI,CAAEC,EAAF,EAAMV,IAAN,EAAY;IACd,IAAI,OAAOU,EAAP,KAAc,UAAlB,EAA8B,OAAOA,EAAP;IAE9B,MAAMC,KAAK,GAAG,IAAd;;IACA,MAAMC,YAAY,GAAG,KAAKC,aAAL,CAAmBb,IAAnB,CAArB;;IAEA,MAAMc,KAAK,GAAG,YAAY;MACxB,OAAOH,KAAK,CAACV,QAAN,CAAeW,YAAf,EAA6B,MAAM;QACxC,OAAOF,EAAE,CAACK,KAAH,CAAS,IAAT,EAAeC,SAAf,CAAP;MACD,CAFM,CAAP;IAGD,CAJD;;IAMAtB,SAAS,CAACuB,GAAV,CAAcH,KAAd,EAAqBJ,EAArB;IAEA,OAAOI,KAAP;EACD;;EAEDD,aAAa,CAAEb,IAAF,EAAQ;IACnB,OAAOA,IAAI,KAAKkB,SAAT,GAAqBlB,IAArB,GAA4B,KAAKH,MAAL,EAAnC;EACD;;EAEDsB,UAAU,CAAEC,OAAF,EAAW;IACnB,OAAOA,OAAO,IAAI,OAAOA,OAAO,CAACC,IAAf,KAAwB,UAA1C;EACD;;AAnDS;;AAsDZC,MAAM,CAACC,OAAP,GAAiB3B,KAAjB"},"metadata":{},"sourceType":"script"}