{"ast":null,"code":"'use strict';\n\nconst {\n  channel,\n  addHook,\n  AsyncResource\n} = require('./helpers/instrument');\n\nconst shimmer = require('../../datadog-shimmer');\n\nfunction findCallbackIndex(args) {\n  let lowerbound = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 2;\n\n  for (let i = args.length - 1; i >= lowerbound; i--) {\n    if (typeof args[i] === 'function') return i;\n  }\n\n  return -1;\n} // handles n1ql and string queries\n\n\nfunction getQueryResource(q) {\n  return q && (typeof q === 'string' ? q : q.statement);\n}\n\nfunction wrapAllNames(names, action) {\n  names.forEach(name => action(name));\n} // semver >=2 <3\n\n\nfunction wrapMaybeInvoke(_maybeInvoke) {\n  const wrapped = function (fn, args) {\n    if (!Array.isArray(args)) return _maybeInvoke.apply(this, arguments);\n    const callbackIndex = args.length - 1;\n    const callback = args[callbackIndex];\n\n    if (callback instanceof Function) {\n      args[callbackIndex] = AsyncResource.bind(callback);\n    }\n\n    return _maybeInvoke.apply(this, arguments);\n  };\n\n  return shimmer.wrap(_maybeInvoke, wrapped);\n}\n\nfunction wrapQuery(query) {\n  const wrapped = function (q, params, callback) {\n    callback = AsyncResource.bind(arguments[arguments.length - 1]);\n\n    if (typeof callback === 'function') {\n      arguments[arguments.length - 1] = callback;\n    }\n\n    const res = query.apply(this, arguments);\n    return res;\n  };\n\n  return shimmer.wrap(query, wrapped);\n}\n\nfunction wrap(prefix, fn) {\n  const startCh = channel(prefix + ':start');\n  const finishCh = channel(prefix + ':finish');\n  const errorCh = channel(prefix + ':error');\n\n  const wrapped = function () {\n    if (!startCh.hasSubscribers) {\n      return fn.apply(this, arguments);\n    }\n\n    const callbackIndex = findCallbackIndex(arguments);\n    if (callbackIndex < 0) return fn.apply(this, arguments);\n    const callbackResource = new AsyncResource('bound-anonymous-fn');\n    const asyncResource = new AsyncResource('bound-anonymous-fn');\n    return asyncResource.runInAsyncScope(() => {\n      const cb = callbackResource.bind(arguments[callbackIndex]);\n      startCh.publish({\n        bucket: {\n          name: this.name || this._name\n        }\n      });\n      arguments[callbackIndex] = asyncResource.bind(function (error, result) {\n        if (error) {\n          errorCh.publish(error);\n        }\n\n        finishCh.publish(result);\n        return cb.apply(this, arguments);\n      });\n\n      try {\n        return fn.apply(this, arguments);\n      } catch (error) {\n        error.stack; // trigger getting the stack at the original throwing point\n\n        errorCh.publish(error);\n        throw error;\n      }\n    });\n  };\n\n  return shimmer.wrap(fn, wrapped);\n} // semver >=3\n\n\nfunction wrapCBandPromise(fn, name, startData, thisArg, args) {\n  const startCh = channel(`apm:couchbase:${name}:start`);\n  const finishCh = channel(`apm:couchbase:${name}:finish`);\n  const errorCh = channel(`apm:couchbase:${name}:error`);\n  if (!startCh.hasSubscribers) return fn.apply(thisArg, args);\n  const asyncResource = new AsyncResource('bound-anonymous-fn');\n  const callbackResource = new AsyncResource('bound-anonymous-fn');\n  return asyncResource.runInAsyncScope(() => {\n    startCh.publish(startData);\n\n    try {\n      const cbIndex = findCallbackIndex(args, 1);\n\n      if (cbIndex >= 0) {\n        // v3 offers callback or promises event handling\n        // NOTE: this does not work with v3.2.0-3.2.1 cluster.query, as there is a bug in the couchbase source code\n        const cb = callbackResource.bind(args[cbIndex]);\n        args[cbIndex] = asyncResource.bind(function (error, result) {\n          if (error) {\n            errorCh.publish(error);\n          }\n\n          finishCh.publish({\n            result\n          });\n          return cb.apply(thisArg, arguments);\n        });\n      }\n\n      const res = fn.apply(thisArg, args); // semver >=3 will always return promise by default\n\n      res.then(asyncResource.bind(result => finishCh.publish({\n        result\n      })), asyncResource.bind(err => errorCh.publish(err)));\n      return res;\n    } catch (e) {\n      e.stack;\n      errorCh.publish(e);\n      throw e;\n    }\n  });\n}\n\nfunction wrapWithName(name) {\n  return function (operation) {\n    return function () {\n      // no arguments used by us\n      return wrapCBandPromise(operation, name, {\n        collection: {\n          name: this._name || '_default'\n        },\n        bucket: {\n          name: this._scope._bucket._name\n        }\n      }, this, arguments);\n    };\n  };\n}\n\nfunction wrapV3Query(query) {\n  return function (q) {\n    const resource = getQueryResource(q);\n    return wrapCBandPromise(query, 'query', {\n      resource\n    }, this, arguments);\n  };\n} // semver >=2 <3\n\n\naddHook({\n  name: 'couchbase',\n  file: 'lib/bucket.js',\n  versions: ['^2.6.5']\n}, Bucket => {\n  const startCh = channel('apm:couchbase:query:start');\n  const finishCh = channel('apm:couchbase:query:finish');\n  const errorCh = channel('apm:couchbase:query:error');\n  Bucket.prototype._maybeInvoke = wrapMaybeInvoke(Bucket.prototype._maybeInvoke);\n  Bucket.prototype.query = wrapQuery(Bucket.prototype.query);\n  shimmer.wrap(Bucket.prototype, '_n1qlReq', _n1qlReq => function (host, q, adhoc, emitter) {\n    if (!startCh.hasSubscribers) {\n      return _n1qlReq.apply(this, arguments);\n    }\n\n    if (!emitter || !emitter.once) return _n1qlReq.apply(this, arguments);\n    const n1qlQuery = getQueryResource(q);\n    const asyncResource = new AsyncResource('bound-anonymous-fn');\n    return asyncResource.runInAsyncScope(() => {\n      startCh.publish({\n        resource: n1qlQuery,\n        bucket: {\n          name: this.name || this._name\n        }\n      });\n      emitter.once('rows', asyncResource.bind(() => {\n        finishCh.publish(undefined);\n      }));\n      emitter.once('error', asyncResource.bind(error => {\n        errorCh.publish(error);\n        finishCh.publish(undefined);\n      }));\n\n      try {\n        return _n1qlReq.apply(this, arguments);\n      } catch (err) {\n        err.stack; // trigger getting the stack at the original throwing point\n\n        errorCh.publish(err);\n        throw err;\n      }\n    });\n  });\n  wrapAllNames(['upsert', 'insert', 'replace', 'append', 'prepend'], name => {\n    Bucket.prototype[name] = wrap(`apm:couchbase:${name}`, Bucket.prototype[name]);\n  });\n  return Bucket;\n});\naddHook({\n  name: 'couchbase',\n  file: 'lib/cluster.js',\n  versions: ['^2.6.5']\n}, Cluster => {\n  Cluster.prototype._maybeInvoke = wrapMaybeInvoke(Cluster.prototype._maybeInvoke);\n  Cluster.prototype.query = wrapQuery(Cluster.prototype.query);\n  return Cluster;\n}); // semver >=3 <3.2.0\n\naddHook({\n  name: 'couchbase',\n  file: 'lib/collection.js',\n  versions: ['>=3.0.0 <3.2.0']\n}, Collection => {\n  wrapAllNames(['upsert', 'insert', 'replace'], name => {\n    shimmer.wrap(Collection.prototype, name, wrapWithName(name));\n  });\n  return Collection;\n});\naddHook({\n  name: 'couchbase',\n  file: 'lib/cluster.js',\n  versions: ['>=3.0.0 <3.2.0']\n}, Cluster => {\n  shimmer.wrap(Cluster.prototype, 'query', wrapV3Query);\n  return Cluster;\n}); // semver >=3.2.0\n\naddHook({\n  name: 'couchbase',\n  file: 'dist/collection.js',\n  versions: ['>=3.2.0']\n}, collection => {\n  const Collection = collection.Collection;\n  wrapAllNames(['upsert', 'insert', 'replace'], name => {\n    shimmer.wrap(Collection.prototype, name, wrapWithName(name));\n  });\n  return collection;\n});\naddHook({\n  name: 'couchbase',\n  file: 'dist/cluster.js',\n  versions: ['3.2.0 - 3.2.1', '>=3.2.2']\n}, cluster => {\n  const Cluster = cluster.Cluster;\n  shimmer.wrap(Cluster.prototype, 'query', wrapV3Query);\n  return cluster;\n});","map":{"version":3,"names":["channel","addHook","AsyncResource","require","shimmer","findCallbackIndex","args","lowerbound","i","length","getQueryResource","q","statement","wrapAllNames","names","action","forEach","name","wrapMaybeInvoke","_maybeInvoke","wrapped","fn","Array","isArray","apply","arguments","callbackIndex","callback","Function","bind","wrap","wrapQuery","query","params","res","prefix","startCh","finishCh","errorCh","hasSubscribers","callbackResource","asyncResource","runInAsyncScope","cb","publish","bucket","_name","error","result","stack","wrapCBandPromise","startData","thisArg","cbIndex","then","err","e","wrapWithName","operation","collection","_scope","_bucket","wrapV3Query","resource","file","versions","Bucket","prototype","_n1qlReq","host","adhoc","emitter","once","n1qlQuery","undefined","Cluster","Collection","cluster"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/datadog-instrumentations/src/couchbase.js"],"sourcesContent":["'use strict'\n\nconst {\n  channel,\n  addHook,\n  AsyncResource\n} = require('./helpers/instrument')\nconst shimmer = require('../../datadog-shimmer')\n\nfunction findCallbackIndex (args, lowerbound = 2) {\n  for (let i = args.length - 1; i >= lowerbound; i--) {\n    if (typeof args[i] === 'function') return i\n  }\n  return -1\n}\n\n// handles n1ql and string queries\nfunction getQueryResource (q) {\n  return q && (typeof q === 'string' ? q : q.statement)\n}\n\nfunction wrapAllNames (names, action) {\n  names.forEach(name => action(name))\n}\n\n// semver >=2 <3\nfunction wrapMaybeInvoke (_maybeInvoke) {\n  const wrapped = function (fn, args) {\n    if (!Array.isArray(args)) return _maybeInvoke.apply(this, arguments)\n\n    const callbackIndex = args.length - 1\n    const callback = args[callbackIndex]\n\n    if (callback instanceof Function) {\n      args[callbackIndex] = AsyncResource.bind(callback)\n    }\n\n    return _maybeInvoke.apply(this, arguments)\n  }\n  return shimmer.wrap(_maybeInvoke, wrapped)\n}\n\nfunction wrapQuery (query) {\n  const wrapped = function (q, params, callback) {\n    callback = AsyncResource.bind(arguments[arguments.length - 1])\n\n    if (typeof callback === 'function') {\n      arguments[arguments.length - 1] = callback\n    }\n\n    const res = query.apply(this, arguments)\n    return res\n  }\n  return shimmer.wrap(query, wrapped)\n}\n\nfunction wrap (prefix, fn) {\n  const startCh = channel(prefix + ':start')\n  const finishCh = channel(prefix + ':finish')\n  const errorCh = channel(prefix + ':error')\n\n  const wrapped = function () {\n    if (!startCh.hasSubscribers) {\n      return fn.apply(this, arguments)\n    }\n\n    const callbackIndex = findCallbackIndex(arguments)\n\n    if (callbackIndex < 0) return fn.apply(this, arguments)\n\n    const callbackResource = new AsyncResource('bound-anonymous-fn')\n    const asyncResource = new AsyncResource('bound-anonymous-fn')\n\n    return asyncResource.runInAsyncScope(() => {\n      const cb = callbackResource.bind(arguments[callbackIndex])\n\n      startCh.publish({ bucket: { name: this.name || this._name } })\n\n      arguments[callbackIndex] = asyncResource.bind(function (error, result) {\n        if (error) {\n          errorCh.publish(error)\n        }\n        finishCh.publish(result)\n        return cb.apply(this, arguments)\n      })\n\n      try {\n        return fn.apply(this, arguments)\n      } catch (error) {\n        error.stack // trigger getting the stack at the original throwing point\n        errorCh.publish(error)\n\n        throw error\n      }\n    })\n  }\n  return shimmer.wrap(fn, wrapped)\n}\n\n// semver >=3\n\nfunction wrapCBandPromise (fn, name, startData, thisArg, args) {\n  const startCh = channel(`apm:couchbase:${name}:start`)\n  const finishCh = channel(`apm:couchbase:${name}:finish`)\n  const errorCh = channel(`apm:couchbase:${name}:error`)\n\n  if (!startCh.hasSubscribers) return fn.apply(thisArg, args)\n\n  const asyncResource = new AsyncResource('bound-anonymous-fn')\n  const callbackResource = new AsyncResource('bound-anonymous-fn')\n\n  return asyncResource.runInAsyncScope(() => {\n    startCh.publish(startData)\n\n    try {\n      const cbIndex = findCallbackIndex(args, 1)\n      if (cbIndex >= 0) {\n        // v3 offers callback or promises event handling\n        // NOTE: this does not work with v3.2.0-3.2.1 cluster.query, as there is a bug in the couchbase source code\n        const cb = callbackResource.bind(args[cbIndex])\n        args[cbIndex] = asyncResource.bind(function (error, result) {\n          if (error) {\n            errorCh.publish(error)\n          }\n          finishCh.publish({ result })\n          return cb.apply(thisArg, arguments)\n        })\n      }\n      const res = fn.apply(thisArg, args)\n\n      // semver >=3 will always return promise by default\n      res.then(\n        asyncResource.bind((result) => finishCh.publish({ result })),\n        asyncResource.bind((err) => errorCh.publish(err)))\n      return res\n    } catch (e) {\n      e.stack\n      errorCh.publish(e)\n      throw e\n    }\n  })\n}\n\nfunction wrapWithName (name) {\n  return function (operation) {\n    return function () { // no arguments used by us\n      return wrapCBandPromise(operation, name, {\n        collection: { name: this._name || '_default' },\n        bucket: { name: this._scope._bucket._name }\n      }, this, arguments)\n    }\n  }\n}\n\nfunction wrapV3Query (query) {\n  return function (q) {\n    const resource = getQueryResource(q)\n    return wrapCBandPromise(query, 'query', { resource }, this, arguments)\n  }\n}\n\n// semver >=2 <3\naddHook({ name: 'couchbase', file: 'lib/bucket.js', versions: ['^2.6.5'] }, Bucket => {\n  const startCh = channel('apm:couchbase:query:start')\n  const finishCh = channel('apm:couchbase:query:finish')\n  const errorCh = channel('apm:couchbase:query:error')\n\n  Bucket.prototype._maybeInvoke = wrapMaybeInvoke(Bucket.prototype._maybeInvoke)\n  Bucket.prototype.query = wrapQuery(Bucket.prototype.query)\n\n  shimmer.wrap(Bucket.prototype, '_n1qlReq', _n1qlReq => function (host, q, adhoc, emitter) {\n    if (!startCh.hasSubscribers) {\n      return _n1qlReq.apply(this, arguments)\n    }\n\n    if (!emitter || !emitter.once) return _n1qlReq.apply(this, arguments)\n\n    const n1qlQuery = getQueryResource(q)\n\n    const asyncResource = new AsyncResource('bound-anonymous-fn')\n    return asyncResource.runInAsyncScope(() => {\n      startCh.publish({ resource: n1qlQuery, bucket: { name: this.name || this._name } })\n\n      emitter.once('rows', asyncResource.bind(() => {\n        finishCh.publish(undefined)\n      }))\n\n      emitter.once('error', asyncResource.bind((error) => {\n        errorCh.publish(error)\n        finishCh.publish(undefined)\n      }))\n\n      try {\n        return _n1qlReq.apply(this, arguments)\n      } catch (err) {\n        err.stack // trigger getting the stack at the original throwing point\n        errorCh.publish(err)\n\n        throw err\n      }\n    })\n  })\n\n  wrapAllNames(['upsert', 'insert', 'replace', 'append', 'prepend'], name => {\n    Bucket.prototype[name] = wrap(`apm:couchbase:${name}`, Bucket.prototype[name])\n  })\n\n  return Bucket\n})\n\naddHook({ name: 'couchbase', file: 'lib/cluster.js', versions: ['^2.6.5'] }, Cluster => {\n  Cluster.prototype._maybeInvoke = wrapMaybeInvoke(Cluster.prototype._maybeInvoke)\n  Cluster.prototype.query = wrapQuery(Cluster.prototype.query)\n\n  return Cluster\n})\n\n// semver >=3 <3.2.0\n\naddHook({ name: 'couchbase', file: 'lib/collection.js', versions: ['>=3.0.0 <3.2.0'] }, Collection => {\n  wrapAllNames(['upsert', 'insert', 'replace'], name => {\n    shimmer.wrap(Collection.prototype, name, wrapWithName(name))\n  })\n\n  return Collection\n})\n\naddHook({ name: 'couchbase', file: 'lib/cluster.js', versions: ['>=3.0.0 <3.2.0'] }, Cluster => {\n  shimmer.wrap(Cluster.prototype, 'query', wrapV3Query)\n  return Cluster\n})\n\n// semver >=3.2.0\n\naddHook({ name: 'couchbase', file: 'dist/collection.js', versions: ['>=3.2.0'] }, collection => {\n  const Collection = collection.Collection\n\n  wrapAllNames(['upsert', 'insert', 'replace'], name => {\n    shimmer.wrap(Collection.prototype, name, wrapWithName(name))\n  })\n\n  return collection\n})\n\naddHook({ name: 'couchbase', file: 'dist/cluster.js', versions: ['3.2.0 - 3.2.1', '>=3.2.2'] }, cluster => {\n  const Cluster = cluster.Cluster\n\n  shimmer.wrap(Cluster.prototype, 'query', wrapV3Query)\n  return cluster\n})\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}