{"ast":null,"code":"'use strict';\n\nconst Plugin = require('../../dd-trace/src/plugins/plugin');\n\nconst {\n  storage\n} = require('../../datadog-core');\n\nconst {\n  CI_APP_ORIGIN,\n  TEST_CODE_OWNERS,\n  TEST_SUITE,\n  TEST_STATUS,\n  TEST_PARAMETERS,\n  finishAllTraceSpans,\n  getTestEnvironmentMetadata,\n  getTestSuitePath,\n  getTestParentSpan,\n  getTestParametersString,\n  getCodeOwnersFileEntries,\n  getCodeOwnersForFilename,\n  getTestCommonTags,\n  getTestSessionCommonTags,\n  getTestSuiteCommonTags,\n  TEST_SUITE_ID,\n  TEST_SESSION_ID,\n  TEST_COMMAND\n} = require('../../dd-trace/src/plugins/util/test');\n\nfunction getTestSpanMetadata(tracer, test, sourceRoot) {\n  const childOf = getTestParentSpan(tracer);\n  const {\n    file: testSuiteAbsolutePath\n  } = test;\n  const fullTestName = test.fullTitle();\n  const testSuite = getTestSuitePath(testSuiteAbsolutePath, sourceRoot);\n  const commonTags = getTestCommonTags(fullTestName, testSuite, tracer._version);\n  return {\n    childOf,\n    ...commonTags\n  };\n}\n\nclass MochaPlugin extends Plugin {\n  static get name() {\n    return 'mocha';\n  }\n\n  constructor() {\n    super(...arguments);\n    this._testSuites = new Map();\n    this._testNameToParams = {};\n    this.testEnvironmentMetadata = getTestEnvironmentMetadata('mocha', this.config);\n    this.sourceRoot = process.cwd();\n    this.codeOwnersEntries = getCodeOwnersFileEntries(this.sourceRoot);\n    this.addSub('ci:mocha:run:start', command => {\n      if (!this.config.isAgentlessEnabled) {\n        return;\n      }\n\n      const childOf = getTestParentSpan(this.tracer);\n      const testSessionSpanMetadata = getTestSessionCommonTags(command, this.tracer._version);\n      this.command = command;\n      this.testSessionSpan = this.tracer.startSpan('mocha.test_session', {\n        childOf,\n        tags: { ...this.testEnvironmentMetadata,\n          ...testSessionSpanMetadata\n        }\n      });\n    });\n    this.addSub('ci:mocha:test-suite:start', suite => {\n      if (!this.config.isAgentlessEnabled) {\n        return;\n      }\n\n      const store = storage.getStore();\n      const testSuiteMetadata = getTestSuiteCommonTags(this.command, this.tracer._version, getTestSuitePath(suite.file, this.sourceRoot));\n      const testSuiteSpan = this.tracer.startSpan('mocha.test_suite', {\n        childOf: this.testSessionSpan,\n        tags: { ...this.testEnvironmentMetadata,\n          ...testSuiteMetadata\n        }\n      });\n      this.enter(testSuiteSpan, store);\n\n      this._testSuites.set(suite.file, testSuiteSpan);\n    });\n    this.addSub('ci:mocha:test-suite:finish', status => {\n      if (!this.config.isAgentlessEnabled) {\n        return;\n      }\n\n      const span = storage.getStore().span; // the test status of the suite may have been set in ci:mocha:test-suite:error already\n\n      if (!span.context()._tags[TEST_STATUS]) {\n        span.setTag(TEST_STATUS, status);\n      }\n\n      span.finish();\n    });\n    this.addSub('ci:mocha:test-suite:error', err => {\n      if (!this.config.isAgentlessEnabled) {\n        return;\n      }\n\n      const span = storage.getStore().span;\n      span.setTag('error', err);\n      span.setTag(TEST_STATUS, 'fail');\n    });\n    this.addSub('ci:mocha:test:start', test => {\n      const store = storage.getStore();\n      const span = this.startTestSpan(test);\n      this.enter(span, store);\n    });\n    this.addSub('ci:mocha:test:finish', status => {\n      const span = storage.getStore().span;\n      span.setTag(TEST_STATUS, status);\n      span.finish();\n      finishAllTraceSpans(span);\n    });\n    this.addSub('ci:mocha:test:skip', test => {\n      const store = storage.getStore(); // skipped through it.skip, so the span is not created yet\n      // for this test\n\n      if (!store) {\n        const testSpan = this.startTestSpan(test);\n        this.enter(testSpan, store);\n      }\n    });\n    this.addSub('ci:mocha:test:error', err => {\n      if (err) {\n        const span = storage.getStore().span;\n\n        if (err.constructor.name === 'Pending' && !this.forbidPending) {\n          span.setTag(TEST_STATUS, 'skip');\n        } else {\n          span.setTag(TEST_STATUS, 'fail');\n          span.setTag('error', err);\n        }\n      }\n    });\n    this.addSub('ci:mocha:test:parameterize', _ref => {\n      let {\n        name,\n        params\n      } = _ref;\n      this._testNameToParams[name] = params;\n    });\n    this.addSub('ci:mocha:run:finish', status => {\n      if (this.testSessionSpan) {\n        this.testSessionSpan.setTag(TEST_STATUS, status);\n        this.testSessionSpan.finish();\n        finishAllTraceSpans(this.testSessionSpan);\n      }\n\n      this.tracer._exporter._writer.flush();\n    });\n  }\n\n  startTestSpan(test) {\n    const testSuiteTags = {};\n\n    const testSuiteSpan = this._testSuites.get(test.parent.file);\n\n    if (testSuiteSpan) {\n      const testSuiteId = testSuiteSpan.context()._spanId.toString(10);\n\n      testSuiteTags[TEST_SUITE_ID] = testSuiteId;\n    }\n\n    if (this.testSessionSpan) {\n      const testSessionId = this.testSessionSpan.context()._traceId.toString(10);\n\n      testSuiteTags[TEST_SESSION_ID] = testSessionId;\n      testSuiteTags[TEST_COMMAND] = this.command;\n    }\n\n    const {\n      childOf,\n      ...testSpanMetadata\n    } = getTestSpanMetadata(this.tracer, test, this.sourceRoot);\n    const testParametersString = getTestParametersString(this._testNameToParams, test.title);\n\n    if (testParametersString) {\n      testSpanMetadata[TEST_PARAMETERS] = testParametersString;\n    }\n\n    const codeOwners = getCodeOwnersForFilename(testSpanMetadata[TEST_SUITE], this.codeOwnersEntries);\n\n    if (codeOwners) {\n      testSpanMetadata[TEST_CODE_OWNERS] = codeOwners;\n    }\n\n    const testSpan = this.tracer.startSpan('mocha.test', {\n      childOf,\n      tags: { ...this.testEnvironmentMetadata,\n        ...testSpanMetadata,\n        ...testSuiteTags\n      }\n    });\n    testSpan.context()._trace.origin = CI_APP_ORIGIN;\n    return testSpan;\n  }\n\n}\n\nmodule.exports = MochaPlugin;","map":{"version":3,"names":["Plugin","require","storage","CI_APP_ORIGIN","TEST_CODE_OWNERS","TEST_SUITE","TEST_STATUS","TEST_PARAMETERS","finishAllTraceSpans","getTestEnvironmentMetadata","getTestSuitePath","getTestParentSpan","getTestParametersString","getCodeOwnersFileEntries","getCodeOwnersForFilename","getTestCommonTags","getTestSessionCommonTags","getTestSuiteCommonTags","TEST_SUITE_ID","TEST_SESSION_ID","TEST_COMMAND","getTestSpanMetadata","tracer","test","sourceRoot","childOf","file","testSuiteAbsolutePath","fullTestName","fullTitle","testSuite","commonTags","_version","MochaPlugin","name","constructor","_testSuites","Map","_testNameToParams","testEnvironmentMetadata","config","process","cwd","codeOwnersEntries","addSub","command","isAgentlessEnabled","testSessionSpanMetadata","testSessionSpan","startSpan","tags","suite","store","getStore","testSuiteMetadata","testSuiteSpan","enter","set","status","span","context","_tags","setTag","finish","err","startTestSpan","testSpan","forbidPending","params","_exporter","_writer","flush","testSuiteTags","get","parent","testSuiteId","_spanId","toString","testSessionId","_traceId","testSpanMetadata","testParametersString","title","codeOwners","_trace","origin","module","exports"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/datadog-plugin-mocha/src/index.js"],"sourcesContent":["'use strict'\n\nconst Plugin = require('../../dd-trace/src/plugins/plugin')\nconst { storage } = require('../../datadog-core')\n\nconst {\n  CI_APP_ORIGIN,\n  TEST_CODE_OWNERS,\n  TEST_SUITE,\n  TEST_STATUS,\n  TEST_PARAMETERS,\n  finishAllTraceSpans,\n  getTestEnvironmentMetadata,\n  getTestSuitePath,\n  getTestParentSpan,\n  getTestParametersString,\n  getCodeOwnersFileEntries,\n  getCodeOwnersForFilename,\n  getTestCommonTags,\n  getTestSessionCommonTags,\n  getTestSuiteCommonTags,\n  TEST_SUITE_ID,\n  TEST_SESSION_ID,\n  TEST_COMMAND\n} = require('../../dd-trace/src/plugins/util/test')\n\nfunction getTestSpanMetadata (tracer, test, sourceRoot) {\n  const childOf = getTestParentSpan(tracer)\n\n  const { file: testSuiteAbsolutePath } = test\n  const fullTestName = test.fullTitle()\n  const testSuite = getTestSuitePath(testSuiteAbsolutePath, sourceRoot)\n\n  const commonTags = getTestCommonTags(fullTestName, testSuite, tracer._version)\n\n  return {\n    childOf,\n    ...commonTags\n  }\n}\n\nclass MochaPlugin extends Plugin {\n  static get name () {\n    return 'mocha'\n  }\n\n  constructor (...args) {\n    super(...args)\n\n    this._testSuites = new Map()\n    this._testNameToParams = {}\n    this.testEnvironmentMetadata = getTestEnvironmentMetadata('mocha', this.config)\n    this.sourceRoot = process.cwd()\n    this.codeOwnersEntries = getCodeOwnersFileEntries(this.sourceRoot)\n\n    this.addSub('ci:mocha:run:start', (command) => {\n      if (!this.config.isAgentlessEnabled) {\n        return\n      }\n      const childOf = getTestParentSpan(this.tracer)\n      const testSessionSpanMetadata = getTestSessionCommonTags(command, this.tracer._version)\n\n      this.command = command\n      this.testSessionSpan = this.tracer.startSpan('mocha.test_session', {\n        childOf,\n        tags: {\n          ...this.testEnvironmentMetadata,\n          ...testSessionSpanMetadata\n        }\n      })\n    })\n\n    this.addSub('ci:mocha:test-suite:start', (suite) => {\n      if (!this.config.isAgentlessEnabled) {\n        return\n      }\n      const store = storage.getStore()\n      const testSuiteMetadata = getTestSuiteCommonTags(\n        this.command,\n        this.tracer._version,\n        getTestSuitePath(suite.file, this.sourceRoot)\n      )\n      const testSuiteSpan = this.tracer.startSpan('mocha.test_suite', {\n        childOf: this.testSessionSpan,\n        tags: {\n          ...this.testEnvironmentMetadata,\n          ...testSuiteMetadata\n        }\n      })\n      this.enter(testSuiteSpan, store)\n      this._testSuites.set(suite.file, testSuiteSpan)\n    })\n\n    this.addSub('ci:mocha:test-suite:finish', (status) => {\n      if (!this.config.isAgentlessEnabled) {\n        return\n      }\n      const span = storage.getStore().span\n      // the test status of the suite may have been set in ci:mocha:test-suite:error already\n      if (!span.context()._tags[TEST_STATUS]) {\n        span.setTag(TEST_STATUS, status)\n      }\n      span.finish()\n    })\n\n    this.addSub('ci:mocha:test-suite:error', (err) => {\n      if (!this.config.isAgentlessEnabled) {\n        return\n      }\n      const span = storage.getStore().span\n      span.setTag('error', err)\n      span.setTag(TEST_STATUS, 'fail')\n    })\n\n    this.addSub('ci:mocha:test:start', (test) => {\n      const store = storage.getStore()\n      const span = this.startTestSpan(test)\n\n      this.enter(span, store)\n    })\n\n    this.addSub('ci:mocha:test:finish', (status) => {\n      const span = storage.getStore().span\n\n      span.setTag(TEST_STATUS, status)\n\n      span.finish()\n      finishAllTraceSpans(span)\n    })\n\n    this.addSub('ci:mocha:test:skip', (test) => {\n      const store = storage.getStore()\n      // skipped through it.skip, so the span is not created yet\n      // for this test\n      if (!store) {\n        const testSpan = this.startTestSpan(test)\n        this.enter(testSpan, store)\n      }\n    })\n\n    this.addSub('ci:mocha:test:error', (err) => {\n      if (err) {\n        const span = storage.getStore().span\n        if (err.constructor.name === 'Pending' && !this.forbidPending) {\n          span.setTag(TEST_STATUS, 'skip')\n        } else {\n          span.setTag(TEST_STATUS, 'fail')\n          span.setTag('error', err)\n        }\n      }\n    })\n\n    this.addSub('ci:mocha:test:parameterize', ({ name, params }) => {\n      this._testNameToParams[name] = params\n    })\n\n    this.addSub('ci:mocha:run:finish', (status) => {\n      if (this.testSessionSpan) {\n        this.testSessionSpan.setTag(TEST_STATUS, status)\n        this.testSessionSpan.finish()\n        finishAllTraceSpans(this.testSessionSpan)\n      }\n      this.tracer._exporter._writer.flush()\n    })\n  }\n\n  startTestSpan (test) {\n    const testSuiteTags = {}\n    const testSuiteSpan = this._testSuites.get(test.parent.file)\n\n    if (testSuiteSpan) {\n      const testSuiteId = testSuiteSpan.context()._spanId.toString(10)\n      testSuiteTags[TEST_SUITE_ID] = testSuiteId\n    }\n\n    if (this.testSessionSpan) {\n      const testSessionId = this.testSessionSpan.context()._traceId.toString(10)\n      testSuiteTags[TEST_SESSION_ID] = testSessionId\n      testSuiteTags[TEST_COMMAND] = this.command\n    }\n\n    const { childOf, ...testSpanMetadata } = getTestSpanMetadata(this.tracer, test, this.sourceRoot)\n\n    const testParametersString = getTestParametersString(this._testNameToParams, test.title)\n    if (testParametersString) {\n      testSpanMetadata[TEST_PARAMETERS] = testParametersString\n    }\n    const codeOwners = getCodeOwnersForFilename(testSpanMetadata[TEST_SUITE], this.codeOwnersEntries)\n\n    if (codeOwners) {\n      testSpanMetadata[TEST_CODE_OWNERS] = codeOwners\n    }\n\n    const testSpan = this.tracer\n      .startSpan('mocha.test', {\n        childOf,\n        tags: {\n          ...this.testEnvironmentMetadata,\n          ...testSpanMetadata,\n          ...testSuiteTags\n        }\n      })\n    testSpan.context()._trace.origin = CI_APP_ORIGIN\n\n    return testSpan\n  }\n}\n\nmodule.exports = MochaPlugin\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}