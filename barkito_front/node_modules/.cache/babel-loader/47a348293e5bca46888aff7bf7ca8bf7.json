{"ast":null,"code":"'use strict';\n\nconst shimmer = require('../../datadog-shimmer');\n\nconst {\n  addHook,\n  channel\n} = require('./helpers/instrument');\n\nconst routeChannel = channel('apm:find-my-way:request:route');\n\nfunction wrapOn(on) {\n  return function onWithTrace(method, path, opts) {\n    const index = typeof opts === 'function' ? 2 : 3;\n    const handler = arguments[index];\n\n    const wrapper = function (req) {\n      routeChannel.publish({\n        req,\n        route: path\n      });\n      return handler.apply(this, arguments);\n    };\n\n    if (typeof handler === 'function') {\n      arguments[index] = wrapper;\n    }\n\n    return on.apply(this, arguments);\n  };\n}\n\naddHook({\n  name: 'find-my-way',\n  versions: ['>=1']\n}, Router => {\n  shimmer.wrap(Router.prototype, 'on', wrapOn);\n  return Router;\n});","map":{"version":3,"names":["shimmer","require","addHook","channel","routeChannel","wrapOn","on","onWithTrace","method","path","opts","index","handler","arguments","wrapper","req","publish","route","apply","name","versions","Router","wrap","prototype"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/datadog-instrumentations/src/find-my-way.js"],"sourcesContent":["'use strict'\n\nconst shimmer = require('../../datadog-shimmer')\nconst { addHook, channel } = require('./helpers/instrument')\n\nconst routeChannel = channel('apm:find-my-way:request:route')\n\nfunction wrapOn (on) {\n  return function onWithTrace (method, path, opts) {\n    const index = typeof opts === 'function' ? 2 : 3\n    const handler = arguments[index]\n    const wrapper = function (req) {\n      routeChannel.publish({ req, route: path })\n\n      return handler.apply(this, arguments)\n    }\n\n    if (typeof handler === 'function') {\n      arguments[index] = wrapper\n    }\n\n    return on.apply(this, arguments)\n  }\n}\n\naddHook({ name: 'find-my-way', versions: ['>=1'] }, Router => {\n  shimmer.wrap(Router.prototype, 'on', wrapOn)\n\n  return Router\n})\n"],"mappings":"AAAA;;AAEA,MAAMA,OAAO,GAAGC,OAAO,CAAC,uBAAD,CAAvB;;AACA,MAAM;EAAEC,OAAF;EAAWC;AAAX,IAAuBF,OAAO,CAAC,sBAAD,CAApC;;AAEA,MAAMG,YAAY,GAAGD,OAAO,CAAC,+BAAD,CAA5B;;AAEA,SAASE,MAAT,CAAiBC,EAAjB,EAAqB;EACnB,OAAO,SAASC,WAAT,CAAsBC,MAAtB,EAA8BC,IAA9B,EAAoCC,IAApC,EAA0C;IAC/C,MAAMC,KAAK,GAAG,OAAOD,IAAP,KAAgB,UAAhB,GAA6B,CAA7B,GAAiC,CAA/C;IACA,MAAME,OAAO,GAAGC,SAAS,CAACF,KAAD,CAAzB;;IACA,MAAMG,OAAO,GAAG,UAAUC,GAAV,EAAe;MAC7BX,YAAY,CAACY,OAAb,CAAqB;QAAED,GAAF;QAAOE,KAAK,EAAER;MAAd,CAArB;MAEA,OAAOG,OAAO,CAACM,KAAR,CAAc,IAAd,EAAoBL,SAApB,CAAP;IACD,CAJD;;IAMA,IAAI,OAAOD,OAAP,KAAmB,UAAvB,EAAmC;MACjCC,SAAS,CAACF,KAAD,CAAT,GAAmBG,OAAnB;IACD;;IAED,OAAOR,EAAE,CAACY,KAAH,CAAS,IAAT,EAAeL,SAAf,CAAP;EACD,CAdD;AAeD;;AAEDX,OAAO,CAAC;EAAEiB,IAAI,EAAE,aAAR;EAAuBC,QAAQ,EAAE,CAAC,KAAD;AAAjC,CAAD,EAA6CC,MAAM,IAAI;EAC5DrB,OAAO,CAACsB,IAAR,CAAaD,MAAM,CAACE,SAApB,EAA+B,IAA/B,EAAqClB,MAArC;EAEA,OAAOgB,MAAP;AACD,CAJM,CAAP"},"metadata":{},"sourceType":"script"}