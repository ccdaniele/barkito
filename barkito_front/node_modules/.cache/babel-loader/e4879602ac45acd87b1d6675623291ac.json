{"ast":null,"code":"'use strict';\n\nconst {\n  addHook\n} = require('./helpers/instrument');\n\nconst {\n  wrapThen\n} = require('./helpers/promise');\n\nconst {\n  AsyncResource\n} = require('./helpers/instrument');\n\nconst shimmer = require('../../datadog-shimmer');\n\nfunction wrapAddQueue(addQueue) {\n  return function addQueueWithTrace(name) {\n    var _this = this;\n\n    if (typeof name === 'function') {\n      arguments[0] = AsyncResource.bind(name);\n    } else if (typeof this[name] === 'function') {\n      arguments[0] = AsyncResource.bind(function () {\n        return _this[name](...arguments);\n      });\n    }\n\n    return addQueue.apply(this, arguments);\n  };\n}\n\naddHook({\n  name: 'mongoose',\n  versions: ['>=4.6.4']\n}, mongoose => {\n  if (mongoose.Promise !== global.Promise) {\n    shimmer.wrap(mongoose.Promise.prototype, 'then', wrapThen);\n  }\n\n  shimmer.wrap(mongoose.Collection.prototype, 'addQueue', wrapAddQueue);\n  return mongoose;\n});","map":{"version":3,"names":["addHook","require","wrapThen","AsyncResource","shimmer","wrapAddQueue","addQueue","addQueueWithTrace","name","arguments","bind","apply","versions","mongoose","Promise","global","wrap","prototype","Collection"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/datadog-instrumentations/src/mongoose.js"],"sourcesContent":["'use strict'\n\nconst { addHook } = require('./helpers/instrument')\nconst { wrapThen } = require('./helpers/promise')\nconst { AsyncResource } = require('./helpers/instrument')\nconst shimmer = require('../../datadog-shimmer')\n\nfunction wrapAddQueue (addQueue) {\n  return function addQueueWithTrace (name) {\n    if (typeof name === 'function') {\n      arguments[0] = AsyncResource.bind(name)\n    } else if (typeof this[name] === 'function') {\n      arguments[0] = AsyncResource.bind((...args) => this[name](...args))\n    }\n\n    return addQueue.apply(this, arguments)\n  }\n}\n\naddHook({\n  name: 'mongoose',\n  versions: ['>=4.6.4']\n}, mongoose => {\n  if (mongoose.Promise !== global.Promise) {\n    shimmer.wrap(mongoose.Promise.prototype, 'then', wrapThen)\n  }\n\n  shimmer.wrap(mongoose.Collection.prototype, 'addQueue', wrapAddQueue)\n  return mongoose\n})\n"],"mappings":"AAAA;;AAEA,MAAM;EAAEA;AAAF,IAAcC,OAAO,CAAC,sBAAD,CAA3B;;AACA,MAAM;EAAEC;AAAF,IAAeD,OAAO,CAAC,mBAAD,CAA5B;;AACA,MAAM;EAAEE;AAAF,IAAoBF,OAAO,CAAC,sBAAD,CAAjC;;AACA,MAAMG,OAAO,GAAGH,OAAO,CAAC,uBAAD,CAAvB;;AAEA,SAASI,YAAT,CAAuBC,QAAvB,EAAiC;EAC/B,OAAO,SAASC,iBAAT,CAA4BC,IAA5B,EAAkC;IAAA;;IACvC,IAAI,OAAOA,IAAP,KAAgB,UAApB,EAAgC;MAC9BC,SAAS,CAAC,CAAD,CAAT,GAAeN,aAAa,CAACO,IAAd,CAAmBF,IAAnB,CAAf;IACD,CAFD,MAEO,IAAI,OAAO,KAAKA,IAAL,CAAP,KAAsB,UAA1B,EAAsC;MAC3CC,SAAS,CAAC,CAAD,CAAT,GAAeN,aAAa,CAACO,IAAd,CAAmB;QAAA,OAAa,KAAI,CAACF,IAAD,CAAJ,CAAW,YAAX,CAAb;MAAA,CAAnB,CAAf;IACD;;IAED,OAAOF,QAAQ,CAACK,KAAT,CAAe,IAAf,EAAqBF,SAArB,CAAP;EACD,CARD;AASD;;AAEDT,OAAO,CAAC;EACNQ,IAAI,EAAE,UADA;EAENI,QAAQ,EAAE,CAAC,SAAD;AAFJ,CAAD,EAGJC,QAAQ,IAAI;EACb,IAAIA,QAAQ,CAACC,OAAT,KAAqBC,MAAM,CAACD,OAAhC,EAAyC;IACvCV,OAAO,CAACY,IAAR,CAAaH,QAAQ,CAACC,OAAT,CAAiBG,SAA9B,EAAyC,MAAzC,EAAiDf,QAAjD;EACD;;EAEDE,OAAO,CAACY,IAAR,CAAaH,QAAQ,CAACK,UAAT,CAAoBD,SAAjC,EAA4C,UAA5C,EAAwDZ,YAAxD;EACA,OAAOQ,QAAP;AACD,CAVM,CAAP"},"metadata":{},"sourceType":"script"}