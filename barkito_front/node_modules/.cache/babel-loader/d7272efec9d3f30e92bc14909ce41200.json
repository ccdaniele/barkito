{"ast":null,"code":"'use strict';\n\nconst shimmer = require('../../../datadog-shimmer');\n\nconst {\n  addHook,\n  channel,\n  AsyncResource\n} = require('../helpers/instrument');\n\nconst startChannel = channel('apm:http2:client:request:start');\nconst finishChannel = channel('apm:http2:client:request:finish');\nconst errorChannel = channel('apm:http2:client:request:error');\nconst responseChannel = channel('apm:http2:client:response');\n\nfunction createWrapEmit(requestResource, parentResource) {\n  return function wrapEmit(emit) {\n    return function (event, arg1) {\n      requestResource.runInAsyncScope(() => {\n        switch (event) {\n          case 'response':\n            responseChannel.publish(arg1);\n            break;\n\n          case 'error':\n            errorChannel.publish(arg1);\n\n          case 'close':\n            // eslint-disable-line no-fallthrough\n            finishChannel.publish();\n            break;\n        }\n      });\n      return parentResource.runInAsyncScope(() => {\n        return emit.apply(this, arguments);\n      });\n    };\n  };\n}\n\nfunction createWrapRequest(authority, options) {\n  return function wrapRequest(request) {\n    return function (headers) {\n      const parentResource = new AsyncResource('bound-anonymous-fn');\n      const requestResource = new AsyncResource('bound-anonymous-fn');\n      return requestResource.runInAsyncScope(() => {\n        startChannel.publish({\n          headers,\n          authority,\n          options\n        });\n        const req = request.apply(this, arguments);\n        shimmer.wrap(req, 'emit', createWrapEmit(requestResource, parentResource));\n        return req;\n      });\n    };\n  };\n}\n\nfunction wrapConnect(connect) {\n  return function (authority, options) {\n    const session = connect.apply(this, arguments);\n    shimmer.wrap(session, 'request', createWrapRequest(authority, options));\n    return session;\n  };\n}\n\naddHook({\n  name: 'http2'\n}, http2 => {\n  shimmer.wrap(http2, 'connect', wrapConnect);\n  return http2;\n});","map":{"version":3,"names":["shimmer","require","addHook","channel","AsyncResource","startChannel","finishChannel","errorChannel","responseChannel","createWrapEmit","requestResource","parentResource","wrapEmit","emit","event","arg1","runInAsyncScope","publish","apply","arguments","createWrapRequest","authority","options","wrapRequest","request","headers","req","wrap","wrapConnect","connect","session","name","http2"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/datadog-instrumentations/src/http2/client.js"],"sourcesContent":["'use strict'\n\nconst shimmer = require('../../../datadog-shimmer')\nconst { addHook, channel, AsyncResource } = require('../helpers/instrument')\n\nconst startChannel = channel('apm:http2:client:request:start')\nconst finishChannel = channel('apm:http2:client:request:finish')\nconst errorChannel = channel('apm:http2:client:request:error')\nconst responseChannel = channel('apm:http2:client:response')\n\nfunction createWrapEmit (requestResource, parentResource) {\n  return function wrapEmit (emit) {\n    return function (event, arg1) {\n      requestResource.runInAsyncScope(() => {\n        switch (event) {\n          case 'response':\n            responseChannel.publish(arg1)\n            break\n          case 'error':\n            errorChannel.publish(arg1)\n          case 'close': // eslint-disable-line no-fallthrough\n            finishChannel.publish()\n            break\n        }\n      })\n\n      return parentResource.runInAsyncScope(() => {\n        return emit.apply(this, arguments)\n      })\n    }\n  }\n}\n\nfunction createWrapRequest (authority, options) {\n  return function wrapRequest (request) {\n    return function (headers) {\n      const parentResource = new AsyncResource('bound-anonymous-fn')\n      const requestResource = new AsyncResource('bound-anonymous-fn')\n\n      return requestResource.runInAsyncScope(() => {\n        startChannel.publish({ headers, authority, options })\n\n        const req = request.apply(this, arguments)\n\n        shimmer.wrap(req, 'emit', createWrapEmit(requestResource, parentResource))\n\n        return req\n      })\n    }\n  }\n}\n\nfunction wrapConnect (connect) {\n  return function (authority, options) {\n    const session = connect.apply(this, arguments)\n\n    shimmer.wrap(session, 'request', createWrapRequest(authority, options))\n\n    return session\n  }\n}\n\naddHook({ name: 'http2' }, http2 => {\n  shimmer.wrap(http2, 'connect', wrapConnect)\n\n  return http2\n})\n"],"mappings":"AAAA;;AAEA,MAAMA,OAAO,GAAGC,OAAO,CAAC,0BAAD,CAAvB;;AACA,MAAM;EAAEC,OAAF;EAAWC,OAAX;EAAoBC;AAApB,IAAsCH,OAAO,CAAC,uBAAD,CAAnD;;AAEA,MAAMI,YAAY,GAAGF,OAAO,CAAC,gCAAD,CAA5B;AACA,MAAMG,aAAa,GAAGH,OAAO,CAAC,iCAAD,CAA7B;AACA,MAAMI,YAAY,GAAGJ,OAAO,CAAC,gCAAD,CAA5B;AACA,MAAMK,eAAe,GAAGL,OAAO,CAAC,2BAAD,CAA/B;;AAEA,SAASM,cAAT,CAAyBC,eAAzB,EAA0CC,cAA1C,EAA0D;EACxD,OAAO,SAASC,QAAT,CAAmBC,IAAnB,EAAyB;IAC9B,OAAO,UAAUC,KAAV,EAAiBC,IAAjB,EAAuB;MAC5BL,eAAe,CAACM,eAAhB,CAAgC,MAAM;QACpC,QAAQF,KAAR;UACE,KAAK,UAAL;YACEN,eAAe,CAACS,OAAhB,CAAwBF,IAAxB;YACA;;UACF,KAAK,OAAL;YACER,YAAY,CAACU,OAAb,CAAqBF,IAArB;;UACF,KAAK,OAAL;YAAc;YACZT,aAAa,CAACW,OAAd;YACA;QARJ;MAUD,CAXD;MAaA,OAAON,cAAc,CAACK,eAAf,CAA+B,MAAM;QAC1C,OAAOH,IAAI,CAACK,KAAL,CAAW,IAAX,EAAiBC,SAAjB,CAAP;MACD,CAFM,CAAP;IAGD,CAjBD;EAkBD,CAnBD;AAoBD;;AAED,SAASC,iBAAT,CAA4BC,SAA5B,EAAuCC,OAAvC,EAAgD;EAC9C,OAAO,SAASC,WAAT,CAAsBC,OAAtB,EAA+B;IACpC,OAAO,UAAUC,OAAV,EAAmB;MACxB,MAAMd,cAAc,GAAG,IAAIP,aAAJ,CAAkB,oBAAlB,CAAvB;MACA,MAAMM,eAAe,GAAG,IAAIN,aAAJ,CAAkB,oBAAlB,CAAxB;MAEA,OAAOM,eAAe,CAACM,eAAhB,CAAgC,MAAM;QAC3CX,YAAY,CAACY,OAAb,CAAqB;UAAEQ,OAAF;UAAWJ,SAAX;UAAsBC;QAAtB,CAArB;QAEA,MAAMI,GAAG,GAAGF,OAAO,CAACN,KAAR,CAAc,IAAd,EAAoBC,SAApB,CAAZ;QAEAnB,OAAO,CAAC2B,IAAR,CAAaD,GAAb,EAAkB,MAAlB,EAA0BjB,cAAc,CAACC,eAAD,EAAkBC,cAAlB,CAAxC;QAEA,OAAOe,GAAP;MACD,CARM,CAAP;IASD,CAbD;EAcD,CAfD;AAgBD;;AAED,SAASE,WAAT,CAAsBC,OAAtB,EAA+B;EAC7B,OAAO,UAAUR,SAAV,EAAqBC,OAArB,EAA8B;IACnC,MAAMQ,OAAO,GAAGD,OAAO,CAACX,KAAR,CAAc,IAAd,EAAoBC,SAApB,CAAhB;IAEAnB,OAAO,CAAC2B,IAAR,CAAaG,OAAb,EAAsB,SAAtB,EAAiCV,iBAAiB,CAACC,SAAD,EAAYC,OAAZ,CAAlD;IAEA,OAAOQ,OAAP;EACD,CAND;AAOD;;AAED5B,OAAO,CAAC;EAAE6B,IAAI,EAAE;AAAR,CAAD,EAAoBC,KAAK,IAAI;EAClChC,OAAO,CAAC2B,IAAR,CAAaK,KAAb,EAAoB,SAApB,EAA+BJ,WAA/B;EAEA,OAAOI,KAAP;AACD,CAJM,CAAP"},"metadata":{},"sourceType":"script"}