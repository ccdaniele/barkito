{"ast":null,"code":"'use strict';\n\nconst {\n  createWrapRouterMethod\n} = require('./router');\n\nconst shimmer = require('../../datadog-shimmer');\n\nconst {\n  addHook,\n  channel\n} = require('./helpers/instrument');\n\nconst handleChannel = channel('apm:express:request:handle');\n\nfunction wrapHandle(handle) {\n  return function handleWithTrace(req, res) {\n    if (handleChannel.hasSubscribers) {\n      handleChannel.publish({\n        req\n      });\n    }\n\n    return handle.apply(this, arguments);\n  };\n}\n\nconst wrapRouterMethod = createWrapRouterMethod('express');\naddHook({\n  name: 'express',\n  versions: ['>=4']\n}, express => {\n  shimmer.wrap(express.application, 'handle', wrapHandle);\n  shimmer.wrap(express.Router, 'use', wrapRouterMethod);\n  shimmer.wrap(express.Router, 'route', wrapRouterMethod);\n  return express;\n});","map":{"version":3,"names":["createWrapRouterMethod","require","shimmer","addHook","channel","handleChannel","wrapHandle","handle","handleWithTrace","req","res","hasSubscribers","publish","apply","arguments","wrapRouterMethod","name","versions","express","wrap","application","Router"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/datadog-instrumentations/src/express.js"],"sourcesContent":["'use strict'\n\nconst { createWrapRouterMethod } = require('./router')\nconst shimmer = require('../../datadog-shimmer')\nconst { addHook, channel } = require('./helpers/instrument')\n\nconst handleChannel = channel('apm:express:request:handle')\n\nfunction wrapHandle (handle) {\n  return function handleWithTrace (req, res) {\n    if (handleChannel.hasSubscribers) {\n      handleChannel.publish({ req })\n    }\n\n    return handle.apply(this, arguments)\n  }\n}\n\nconst wrapRouterMethod = createWrapRouterMethod('express')\n\naddHook({ name: 'express', versions: ['>=4'] }, express => {\n  shimmer.wrap(express.application, 'handle', wrapHandle)\n  shimmer.wrap(express.Router, 'use', wrapRouterMethod)\n  shimmer.wrap(express.Router, 'route', wrapRouterMethod)\n\n  return express\n})\n"],"mappings":"AAAA;;AAEA,MAAM;EAAEA;AAAF,IAA6BC,OAAO,CAAC,UAAD,CAA1C;;AACA,MAAMC,OAAO,GAAGD,OAAO,CAAC,uBAAD,CAAvB;;AACA,MAAM;EAAEE,OAAF;EAAWC;AAAX,IAAuBH,OAAO,CAAC,sBAAD,CAApC;;AAEA,MAAMI,aAAa,GAAGD,OAAO,CAAC,4BAAD,CAA7B;;AAEA,SAASE,UAAT,CAAqBC,MAArB,EAA6B;EAC3B,OAAO,SAASC,eAAT,CAA0BC,GAA1B,EAA+BC,GAA/B,EAAoC;IACzC,IAAIL,aAAa,CAACM,cAAlB,EAAkC;MAChCN,aAAa,CAACO,OAAd,CAAsB;QAAEH;MAAF,CAAtB;IACD;;IAED,OAAOF,MAAM,CAACM,KAAP,CAAa,IAAb,EAAmBC,SAAnB,CAAP;EACD,CAND;AAOD;;AAED,MAAMC,gBAAgB,GAAGf,sBAAsB,CAAC,SAAD,CAA/C;AAEAG,OAAO,CAAC;EAAEa,IAAI,EAAE,SAAR;EAAmBC,QAAQ,EAAE,CAAC,KAAD;AAA7B,CAAD,EAAyCC,OAAO,IAAI;EACzDhB,OAAO,CAACiB,IAAR,CAAaD,OAAO,CAACE,WAArB,EAAkC,QAAlC,EAA4Cd,UAA5C;EACAJ,OAAO,CAACiB,IAAR,CAAaD,OAAO,CAACG,MAArB,EAA6B,KAA7B,EAAoCN,gBAApC;EACAb,OAAO,CAACiB,IAAR,CAAaD,OAAO,CAACG,MAArB,EAA6B,OAA7B,EAAsCN,gBAAtC;EAEA,OAAOG,OAAP;AACD,CANM,CAAP"},"metadata":{},"sourceType":"script"}