{"ast":null,"code":"'use strict';\n\nconst {\n  storage\n} = require('../../datadog-core');\n\nconst Plugin = require('../../dd-trace/src/plugins/plugin');\n\nconst {\n  moleculerTags\n} = require('./util');\n\nclass MoleculerClientPlugin extends Plugin {\n  constructor() {\n    super(...arguments);\n    this.addSub('apm:moleculer:call:start', _ref => {\n      let {\n        actionName,\n        params,\n        opts\n      } = _ref;\n      const store = storage.getStore();\n      const childOf = store && store.span;\n      const span = this.tracer.startSpan('moleculer.call', {\n        childOf,\n        tags: {\n          'service.name': this.config.service || this.tracer._service,\n          'span.kind': 'client',\n          'resource.name': actionName\n        }\n      });\n      this.tracer.inject(span, 'text_map', opts.meta);\n      this.enter(span, store);\n    });\n    this.addSub('apm:moleculer:call:finish', _ref2 => {\n      let {\n        broker,\n        ctx\n      } = _ref2;\n      const store = storage.getStore();\n      const span = store.span;\n\n      if (ctx) {\n        const endpoint = ctx.endpoint || {};\n        const node = endpoint.node || {};\n        span.addTags({\n          'out.host': node.hostname,\n          'out.port': node.port,\n          ...moleculerTags(broker, ctx, this.config)\n        });\n      }\n\n      span.finish();\n    });\n    this.addSub('apm:moleculer:call:error', this.addError);\n  }\n\n}\n\nmodule.exports = MoleculerClientPlugin;","map":{"version":3,"names":["storage","require","Plugin","moleculerTags","MoleculerClientPlugin","constructor","addSub","actionName","params","opts","store","getStore","childOf","span","tracer","startSpan","tags","config","service","_service","inject","meta","enter","broker","ctx","endpoint","node","addTags","hostname","port","finish","addError","module","exports"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/datadog-plugin-moleculer/src/client.js"],"sourcesContent":["'use strict'\n\nconst { storage } = require('../../datadog-core')\nconst Plugin = require('../../dd-trace/src/plugins/plugin')\nconst { moleculerTags } = require('./util')\n\nclass MoleculerClientPlugin extends Plugin {\n  constructor (...args) {\n    super(...args)\n\n    this.addSub('apm:moleculer:call:start', ({ actionName, params, opts }) => {\n      const store = storage.getStore()\n      const childOf = store && store.span\n      const span = this.tracer.startSpan('moleculer.call', {\n        childOf,\n        tags: {\n          'service.name': this.config.service || this.tracer._service,\n          'span.kind': 'client',\n          'resource.name': actionName\n        }\n      })\n\n      this.tracer.inject(span, 'text_map', opts.meta)\n\n      this.enter(span, store)\n    })\n\n    this.addSub('apm:moleculer:call:finish', ({ broker, ctx }) => {\n      const store = storage.getStore()\n      const span = store.span\n\n      if (ctx) {\n        const endpoint = ctx.endpoint || {}\n        const node = endpoint.node || {}\n\n        span.addTags({\n          'out.host': node.hostname,\n          'out.port': node.port,\n          ...moleculerTags(broker, ctx, this.config)\n        })\n      }\n\n      span.finish()\n    })\n\n    this.addSub('apm:moleculer:call:error', this.addError)\n  }\n}\n\nmodule.exports = MoleculerClientPlugin\n"],"mappings":"AAAA;;AAEA,MAAM;EAAEA;AAAF,IAAcC,OAAO,CAAC,oBAAD,CAA3B;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAC,mCAAD,CAAtB;;AACA,MAAM;EAAEE;AAAF,IAAoBF,OAAO,CAAC,QAAD,CAAjC;;AAEA,MAAMG,qBAAN,SAAoCF,MAApC,CAA2C;EACzCG,WAAW,GAAW;IACpB,MAAM,YAAN;IAEA,KAAKC,MAAL,CAAY,0BAAZ,EAAwC,QAAkC;MAAA,IAAjC;QAAEC,UAAF;QAAcC,MAAd;QAAsBC;MAAtB,CAAiC;MACxE,MAAMC,KAAK,GAAGV,OAAO,CAACW,QAAR,EAAd;MACA,MAAMC,OAAO,GAAGF,KAAK,IAAIA,KAAK,CAACG,IAA/B;MACA,MAAMA,IAAI,GAAG,KAAKC,MAAL,CAAYC,SAAZ,CAAsB,gBAAtB,EAAwC;QACnDH,OADmD;QAEnDI,IAAI,EAAE;UACJ,gBAAgB,KAAKC,MAAL,CAAYC,OAAZ,IAAuB,KAAKJ,MAAL,CAAYK,QAD/C;UAEJ,aAAa,QAFT;UAGJ,iBAAiBZ;QAHb;MAF6C,CAAxC,CAAb;MASA,KAAKO,MAAL,CAAYM,MAAZ,CAAmBP,IAAnB,EAAyB,UAAzB,EAAqCJ,IAAI,CAACY,IAA1C;MAEA,KAAKC,KAAL,CAAWT,IAAX,EAAiBH,KAAjB;IACD,CAfD;IAiBA,KAAKJ,MAAL,CAAY,2BAAZ,EAAyC,SAAqB;MAAA,IAApB;QAAEiB,MAAF;QAAUC;MAAV,CAAoB;MAC5D,MAAMd,KAAK,GAAGV,OAAO,CAACW,QAAR,EAAd;MACA,MAAME,IAAI,GAAGH,KAAK,CAACG,IAAnB;;MAEA,IAAIW,GAAJ,EAAS;QACP,MAAMC,QAAQ,GAAGD,GAAG,CAACC,QAAJ,IAAgB,EAAjC;QACA,MAAMC,IAAI,GAAGD,QAAQ,CAACC,IAAT,IAAiB,EAA9B;QAEAb,IAAI,CAACc,OAAL,CAAa;UACX,YAAYD,IAAI,CAACE,QADN;UAEX,YAAYF,IAAI,CAACG,IAFN;UAGX,GAAG1B,aAAa,CAACoB,MAAD,EAASC,GAAT,EAAc,KAAKP,MAAnB;QAHL,CAAb;MAKD;;MAEDJ,IAAI,CAACiB,MAAL;IACD,CAhBD;IAkBA,KAAKxB,MAAL,CAAY,0BAAZ,EAAwC,KAAKyB,QAA7C;EACD;;AAxCwC;;AA2C3CC,MAAM,CAACC,OAAP,GAAiB7B,qBAAjB"},"metadata":{},"sourceType":"script"}