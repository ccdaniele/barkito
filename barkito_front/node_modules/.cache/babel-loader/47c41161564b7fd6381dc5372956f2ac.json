{"ast":null,"code":"'use strict';\n\nconst {\n  storage\n} = require('../../datadog-core');\n\nconst RouterPlugin = require('../../datadog-plugin-router/src');\n\nconst web = require('../../dd-trace/src/plugins/util/web');\n\nclass HapiPlugin extends RouterPlugin {\n  static get name() {\n    return 'hapi';\n  }\n\n  constructor() {\n    super(...arguments);\n    this._requestSpans = new WeakMap();\n    this.addSub('apm:hapi:request:handle', _ref => {\n      let {\n        req\n      } = _ref;\n      const store = storage.getStore();\n      const span = store && store.span;\n      this.setFramework(req, 'hapi', this.config);\n\n      this._requestSpans.set(req, span);\n    });\n    this.addSub('apm:hapi:request:route', _ref2 => {\n      let {\n        req,\n        route\n      } = _ref2;\n      web.setRoute(req, route);\n    });\n    this.addSub(`apm:hapi:request:error`, this.addError);\n    this.addSub('apm:hapi:extension:enter', _ref3 => {\n      let {\n        req\n      } = _ref3;\n      this.enter(this._requestSpans.get(req));\n    });\n  }\n\n}\n\nmodule.exports = HapiPlugin;","map":{"version":3,"names":["storage","require","RouterPlugin","web","HapiPlugin","name","constructor","_requestSpans","WeakMap","addSub","req","store","getStore","span","setFramework","config","set","route","setRoute","addError","enter","get","module","exports"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/datadog-plugin-hapi/src/index.js"],"sourcesContent":["'use strict'\n\nconst { storage } = require('../../datadog-core')\nconst RouterPlugin = require('../../datadog-plugin-router/src')\nconst web = require('../../dd-trace/src/plugins/util/web')\n\nclass HapiPlugin extends RouterPlugin {\n  static get name () {\n    return 'hapi'\n  }\n\n  constructor (...args) {\n    super(...args)\n\n    this._requestSpans = new WeakMap()\n\n    this.addSub('apm:hapi:request:handle', ({ req }) => {\n      const store = storage.getStore()\n      const span = store && store.span\n\n      this.setFramework(req, 'hapi', this.config)\n      this._requestSpans.set(req, span)\n    })\n\n    this.addSub('apm:hapi:request:route', ({ req, route }) => {\n      web.setRoute(req, route)\n    })\n\n    this.addSub(`apm:hapi:request:error`, this.addError)\n\n    this.addSub('apm:hapi:extension:enter', ({ req }) => {\n      this.enter(this._requestSpans.get(req))\n    })\n  }\n}\n\nmodule.exports = HapiPlugin\n"],"mappings":"AAAA;;AAEA,MAAM;EAAEA;AAAF,IAAcC,OAAO,CAAC,oBAAD,CAA3B;;AACA,MAAMC,YAAY,GAAGD,OAAO,CAAC,iCAAD,CAA5B;;AACA,MAAME,GAAG,GAAGF,OAAO,CAAC,qCAAD,CAAnB;;AAEA,MAAMG,UAAN,SAAyBF,YAAzB,CAAsC;EACrB,WAAJG,IAAI,GAAI;IACjB,OAAO,MAAP;EACD;;EAEDC,WAAW,GAAW;IACpB,MAAM,YAAN;IAEA,KAAKC,aAAL,GAAqB,IAAIC,OAAJ,EAArB;IAEA,KAAKC,MAAL,CAAY,yBAAZ,EAAuC,QAAa;MAAA,IAAZ;QAAEC;MAAF,CAAY;MAClD,MAAMC,KAAK,GAAGX,OAAO,CAACY,QAAR,EAAd;MACA,MAAMC,IAAI,GAAGF,KAAK,IAAIA,KAAK,CAACE,IAA5B;MAEA,KAAKC,YAAL,CAAkBJ,GAAlB,EAAuB,MAAvB,EAA+B,KAAKK,MAApC;;MACA,KAAKR,aAAL,CAAmBS,GAAnB,CAAuBN,GAAvB,EAA4BG,IAA5B;IACD,CAND;IAQA,KAAKJ,MAAL,CAAY,wBAAZ,EAAsC,SAAoB;MAAA,IAAnB;QAAEC,GAAF;QAAOO;MAAP,CAAmB;MACxDd,GAAG,CAACe,QAAJ,CAAaR,GAAb,EAAkBO,KAAlB;IACD,CAFD;IAIA,KAAKR,MAAL,CAAa,wBAAb,EAAsC,KAAKU,QAA3C;IAEA,KAAKV,MAAL,CAAY,0BAAZ,EAAwC,SAAa;MAAA,IAAZ;QAAEC;MAAF,CAAY;MACnD,KAAKU,KAAL,CAAW,KAAKb,aAAL,CAAmBc,GAAnB,CAAuBX,GAAvB,CAAX;IACD,CAFD;EAGD;;AA3BmC;;AA8BtCY,MAAM,CAACC,OAAP,GAAiBnB,UAAjB"},"metadata":{},"sourceType":"script"}