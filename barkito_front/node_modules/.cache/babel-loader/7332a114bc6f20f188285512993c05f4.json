{"ast":null,"code":"'use strict';\n\nconst {\n  createHook,\n  executionAsyncResource\n} = require('async_hooks');\n\nconst {\n  channel\n} = require('diagnostics_channel');\n\nconst beforeCh = channel('dd-trace:storage:before');\nconst afterCh = channel('dd-trace:storage:after');\nlet PrivateSymbol = Symbol;\n\nfunction makePrivateSymbol() {\n  // eslint-disable-next-line no-new-func\n  PrivateSymbol = new Function('name', 'return %CreatePrivateSymbol(name)');\n}\n\ntry {\n  makePrivateSymbol();\n} catch (e) {\n  try {\n    const v8 = require('v8');\n\n    v8.setFlagsFromString('--allow-natives-syntax');\n    makePrivateSymbol();\n    v8.setFlagsFromString('--no-allow-natives-syntax'); // eslint-disable-next-line no-empty\n  } catch (e) {}\n}\n\nclass AsyncResourceStorage {\n  constructor() {\n    this._ddResourceStore = PrivateSymbol('ddResourceStore');\n    this._enabled = false;\n    this._hook = createHook(this._createHook());\n  }\n\n  disable() {\n    if (!this._enabled) return;\n\n    this._hook.disable();\n\n    this._enabled = false;\n  }\n\n  getStore() {\n    if (!this._enabled) return;\n\n    const resource = this._executionAsyncResource();\n\n    return resource[this._ddResourceStore];\n  }\n\n  enterWith(store) {\n    this._enable();\n\n    const resource = this._executionAsyncResource();\n\n    resource[this._ddResourceStore] = store;\n  }\n\n  run(store, callback) {\n    this._enable();\n\n    const resource = this._executionAsyncResource();\n\n    const oldStore = resource[this._ddResourceStore];\n    resource[this._ddResourceStore] = store;\n\n    try {\n      for (var _len = arguments.length, args = new Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n        args[_key - 2] = arguments[_key];\n      }\n\n      return callback(...args);\n    } finally {\n      resource[this._ddResourceStore] = oldStore;\n    }\n  }\n\n  _createHook() {\n    return {\n      init: this._init.bind(this),\n\n      before() {\n        beforeCh.publish();\n      },\n\n      after() {\n        afterCh.publish();\n      }\n\n    };\n  }\n\n  _enable() {\n    if (this._enabled) return;\n    this._enabled = true;\n\n    this._hook.enable();\n  }\n\n  _init(asyncId, type, triggerAsyncId, resource) {\n    const currentResource = this._executionAsyncResource();\n\n    if (Object.prototype.hasOwnProperty.call(currentResource, this._ddResourceStore)) {\n      resource[this._ddResourceStore] = currentResource[this._ddResourceStore];\n    }\n  }\n\n  _executionAsyncResource() {\n    return executionAsyncResource() || {};\n  }\n\n}\n\nmodule.exports = AsyncResourceStorage;","map":{"version":3,"names":["createHook","executionAsyncResource","require","channel","beforeCh","afterCh","PrivateSymbol","Symbol","makePrivateSymbol","Function","e","v8","setFlagsFromString","AsyncResourceStorage","constructor","_ddResourceStore","_enabled","_hook","_createHook","disable","getStore","resource","_executionAsyncResource","enterWith","store","_enable","run","callback","oldStore","args","init","_init","bind","before","publish","after","enable","asyncId","type","triggerAsyncId","currentResource","Object","prototype","hasOwnProperty","call","module","exports"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/datadog-core/src/storage/async_resource.js"],"sourcesContent":["'use strict'\n\nconst { createHook, executionAsyncResource } = require('async_hooks')\nconst { channel } = require('diagnostics_channel')\n\nconst beforeCh = channel('dd-trace:storage:before')\nconst afterCh = channel('dd-trace:storage:after')\n\nlet PrivateSymbol = Symbol\nfunction makePrivateSymbol () {\n  // eslint-disable-next-line no-new-func\n  PrivateSymbol = new Function('name', 'return %CreatePrivateSymbol(name)')\n}\n\ntry {\n  makePrivateSymbol()\n} catch (e) {\n  try {\n    const v8 = require('v8')\n    v8.setFlagsFromString('--allow-natives-syntax')\n    makePrivateSymbol()\n    v8.setFlagsFromString('--no-allow-natives-syntax')\n  // eslint-disable-next-line no-empty\n  } catch (e) {}\n}\n\nclass AsyncResourceStorage {\n  constructor () {\n    this._ddResourceStore = PrivateSymbol('ddResourceStore')\n    this._enabled = false\n    this._hook = createHook(this._createHook())\n  }\n\n  disable () {\n    if (!this._enabled) return\n\n    this._hook.disable()\n    this._enabled = false\n  }\n\n  getStore () {\n    if (!this._enabled) return\n\n    const resource = this._executionAsyncResource()\n\n    return resource[this._ddResourceStore]\n  }\n\n  enterWith (store) {\n    this._enable()\n\n    const resource = this._executionAsyncResource()\n\n    resource[this._ddResourceStore] = store\n  }\n\n  run (store, callback, ...args) {\n    this._enable()\n\n    const resource = this._executionAsyncResource()\n    const oldStore = resource[this._ddResourceStore]\n\n    resource[this._ddResourceStore] = store\n\n    try {\n      return callback(...args)\n    } finally {\n      resource[this._ddResourceStore] = oldStore\n    }\n  }\n\n  _createHook () {\n    return {\n      init: this._init.bind(this),\n      before () {\n        beforeCh.publish()\n      },\n      after () {\n        afterCh.publish()\n      }\n    }\n  }\n\n  _enable () {\n    if (this._enabled) return\n\n    this._enabled = true\n    this._hook.enable()\n  }\n\n  _init (asyncId, type, triggerAsyncId, resource) {\n    const currentResource = this._executionAsyncResource()\n\n    if (Object.prototype.hasOwnProperty.call(currentResource, this._ddResourceStore)) {\n      resource[this._ddResourceStore] = currentResource[this._ddResourceStore]\n    }\n  }\n\n  _executionAsyncResource () {\n    return executionAsyncResource() || {}\n  }\n}\n\nmodule.exports = AsyncResourceStorage\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}