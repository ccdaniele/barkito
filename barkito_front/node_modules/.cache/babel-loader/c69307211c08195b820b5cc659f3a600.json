{"ast":null,"code":"'use strict';\n\nconst {\n  channel,\n  addHook\n} = require('./helpers/instrument');\n\nconst shimmer = require('../../datadog-shimmer');\n\nfunction wrapPino(symbol, wrapper, pino) {\n  return function pinoWithTrace() {\n    const instance = pino.apply(this, arguments);\n    Object.defineProperty(instance, symbol, {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: wrapper(instance[symbol])\n    });\n    return instance;\n  };\n}\n\nfunction wrapAsJson(asJson) {\n  const ch = channel('apm:pino:log');\n  return function asJsonWithTrace(obj, msg, num, time) {\n    obj = arguments[0] = obj || {};\n    const payload = {\n      message: obj\n    };\n    ch.publish(payload);\n    arguments[0] = payload.message;\n    return asJson.apply(this, arguments);\n  };\n}\n\nfunction wrapMixin(mixin) {\n  const ch = channel('apm:pino:log');\n  return function mixinWithTrace() {\n    let obj = {};\n\n    if (mixin) {\n      obj = mixin.apply(this, arguments);\n    }\n\n    const payload = {\n      message: obj\n    };\n    ch.publish(payload);\n    return payload.message;\n  };\n}\n\nfunction wrapPrettifyObject(prettifyObject) {\n  const ch = channel('apm:pino:log');\n  return function prettifyObjectWithTrace(input) {\n    const payload = {\n      message: input.input\n    };\n    ch.publish(payload);\n    input.input = payload.message;\n    return prettifyObject.apply(this, arguments);\n  };\n}\n\nfunction wrapPrettyFactory(prettyFactory) {\n  const ch = channel('apm:pino:log');\n  return function prettyFactoryWithTrace() {\n    const pretty = prettyFactory.apply(this, arguments);\n    return function prettyWithTrace(obj) {\n      const payload = {\n        message: obj\n      };\n      ch.publish(payload);\n      arguments[0] = payload.message;\n      return pretty.apply(this, arguments);\n    };\n  };\n}\n\naddHook({\n  name: 'pino',\n  versions: ['2 - 3', '4', '>=5 <5.14.0']\n}, pino => {\n  const asJsonSym = pino.symbols && pino.symbols.asJsonSym || 'asJson';\n  return shimmer.wrap(pino, wrapPino(asJsonSym, wrapAsJson, pino));\n});\naddHook({\n  name: 'pino',\n  versions: ['>=5.14.0 <6.8.0']\n}, pino => {\n  const mixinSym = pino.symbols.mixinSym;\n  return shimmer.wrap(pino, wrapPino(mixinSym, wrapMixin, pino));\n});\naddHook({\n  name: 'pino',\n  versions: ['>=6.8.0']\n}, pino => {\n  const mixinSym = pino.symbols.mixinSym;\n  const wrapped = shimmer.wrap(pino, wrapPino(mixinSym, wrapMixin, pino));\n  wrapped.pino = wrapped;\n  wrapped.default = wrapped;\n  return wrapped;\n});\naddHook({\n  name: 'pino-pretty',\n  file: 'lib/utils.js',\n  versions: ['>=3']\n}, utils => {\n  shimmer.wrap(utils, 'prettifyObject', wrapPrettifyObject);\n  return utils;\n});\naddHook({\n  name: 'pino-pretty',\n  versions: ['1 - 2']\n}, prettyFactory => {\n  return shimmer.wrap(prettyFactory, wrapPrettyFactory(prettyFactory));\n});","map":{"version":3,"names":["channel","addHook","require","shimmer","wrapPino","symbol","wrapper","pino","pinoWithTrace","instance","apply","arguments","Object","defineProperty","configurable","enumerable","writable","value","wrapAsJson","asJson","ch","asJsonWithTrace","obj","msg","num","time","payload","message","publish","wrapMixin","mixin","mixinWithTrace","wrapPrettifyObject","prettifyObject","prettifyObjectWithTrace","input","wrapPrettyFactory","prettyFactory","prettyFactoryWithTrace","pretty","prettyWithTrace","name","versions","asJsonSym","symbols","wrap","mixinSym","wrapped","default","file","utils"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/datadog-instrumentations/src/pino.js"],"sourcesContent":["'use strict'\n\nconst {\n  channel,\n  addHook\n} = require('./helpers/instrument')\nconst shimmer = require('../../datadog-shimmer')\n\nfunction wrapPino (symbol, wrapper, pino) {\n  return function pinoWithTrace () {\n    const instance = pino.apply(this, arguments)\n\n    Object.defineProperty(instance, symbol, {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: wrapper(instance[symbol])\n    })\n\n    return instance\n  }\n}\n\nfunction wrapAsJson (asJson) {\n  const ch = channel('apm:pino:log')\n  return function asJsonWithTrace (obj, msg, num, time) {\n    obj = arguments[0] = obj || {}\n\n    const payload = { message: obj }\n    ch.publish(payload)\n    arguments[0] = payload.message\n\n    return asJson.apply(this, arguments)\n  }\n}\n\nfunction wrapMixin (mixin) {\n  const ch = channel('apm:pino:log')\n  return function mixinWithTrace () {\n    let obj = {}\n\n    if (mixin) {\n      obj = mixin.apply(this, arguments)\n    }\n\n    const payload = { message: obj }\n    ch.publish(payload)\n\n    return payload.message\n  }\n}\n\nfunction wrapPrettifyObject (prettifyObject) {\n  const ch = channel('apm:pino:log')\n  return function prettifyObjectWithTrace (input) {\n    const payload = { message: input.input }\n    ch.publish(payload)\n    input.input = payload.message\n    return prettifyObject.apply(this, arguments)\n  }\n}\n\nfunction wrapPrettyFactory (prettyFactory) {\n  const ch = channel('apm:pino:log')\n  return function prettyFactoryWithTrace () {\n    const pretty = prettyFactory.apply(this, arguments)\n    return function prettyWithTrace (obj) {\n      const payload = { message: obj }\n      ch.publish(payload)\n      arguments[0] = payload.message\n      return pretty.apply(this, arguments)\n    }\n  }\n}\n\naddHook({ name: 'pino', versions: ['2 - 3', '4', '>=5 <5.14.0'] }, pino => {\n  const asJsonSym = (pino.symbols && pino.symbols.asJsonSym) || 'asJson'\n\n  return shimmer.wrap(pino, wrapPino(asJsonSym, wrapAsJson, pino))\n})\n\naddHook({ name: 'pino', versions: ['>=5.14.0 <6.8.0'] }, pino => {\n  const mixinSym = pino.symbols.mixinSym\n\n  return shimmer.wrap(pino, wrapPino(mixinSym, wrapMixin, pino))\n})\n\naddHook({ name: 'pino', versions: ['>=6.8.0'] }, pino => {\n  const mixinSym = pino.symbols.mixinSym\n\n  const wrapped = shimmer.wrap(pino, wrapPino(mixinSym, wrapMixin, pino))\n  wrapped.pino = wrapped\n  wrapped.default = wrapped\n\n  return wrapped\n})\n\naddHook({ name: 'pino-pretty', file: 'lib/utils.js', versions: ['>=3'] }, utils => {\n  shimmer.wrap(utils, 'prettifyObject', wrapPrettifyObject)\n  return utils\n})\n\naddHook({ name: 'pino-pretty', versions: ['1 - 2'] }, prettyFactory => {\n  return shimmer.wrap(prettyFactory, wrapPrettyFactory(prettyFactory))\n})\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}