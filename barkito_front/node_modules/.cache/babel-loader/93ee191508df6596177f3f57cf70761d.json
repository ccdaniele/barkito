{"ast":null,"code":"'use strict';\n\nconst limiter = require('limiter');\n\nclass RateLimiter {\n  constructor(rateLimit) {\n    this._rateLimit = parseInt(rateLimit);\n    this._limiter = new limiter.RateLimiter(this._rateLimit, 'second');\n    this._tokensRequested = 0;\n    this._prevIntervalTokens = 0;\n    this._prevTokensRequested = 0;\n  }\n\n  isAllowed() {\n    const curIntervalStart = this._limiter.curIntervalStart;\n    const curIntervalTokens = this._limiter.tokensThisInterval;\n\n    const allowed = this._isAllowed();\n\n    if (curIntervalStart !== this._limiter.curIntervalStart) {\n      this._prevIntervalTokens = curIntervalTokens;\n      this._prevTokensRequested = this._tokensRequested;\n      this._tokensRequested = 1;\n    } else {\n      this._tokensRequested++;\n    }\n\n    return allowed;\n  }\n\n  effectiveRate() {\n    if (this._rateLimit < 0) return 1;\n    if (this._rateLimit === 0) return 0;\n    if (this._tokensRequested === 0) return 1;\n    const allowed = this._prevIntervalTokens + this._limiter.tokensThisInterval;\n    const requested = this._prevTokensRequested + this._tokensRequested;\n    return allowed / requested;\n  }\n\n  _isAllowed() {\n    if (this._rateLimit < 0) return true;\n    if (this._rateLimit === 0) return false;\n    return this._limiter.tryRemoveTokens(1);\n  }\n\n  _currentWindowRate() {\n    if (this._rateLimit < 0) return 1;\n    if (this._rateLimit === 0) return 0;\n    if (this._tokensRequested === 0) return 1;\n    return this._limiter.tokensThisInterval / this._tokensRequested;\n  }\n\n}\n\nmodule.exports = RateLimiter;","map":{"version":3,"names":["limiter","require","RateLimiter","constructor","rateLimit","_rateLimit","parseInt","_limiter","_tokensRequested","_prevIntervalTokens","_prevTokensRequested","isAllowed","curIntervalStart","curIntervalTokens","tokensThisInterval","allowed","_isAllowed","effectiveRate","requested","tryRemoveTokens","_currentWindowRate","module","exports"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/dd-trace/src/rate_limiter.js"],"sourcesContent":["'use strict'\n\nconst limiter = require('limiter')\n\nclass RateLimiter {\n  constructor (rateLimit) {\n    this._rateLimit = parseInt(rateLimit)\n    this._limiter = new limiter.RateLimiter(this._rateLimit, 'second')\n    this._tokensRequested = 0\n    this._prevIntervalTokens = 0\n    this._prevTokensRequested = 0\n  }\n\n  isAllowed () {\n    const curIntervalStart = this._limiter.curIntervalStart\n    const curIntervalTokens = this._limiter.tokensThisInterval\n    const allowed = this._isAllowed()\n\n    if (curIntervalStart !== this._limiter.curIntervalStart) {\n      this._prevIntervalTokens = curIntervalTokens\n      this._prevTokensRequested = this._tokensRequested\n      this._tokensRequested = 1\n    } else {\n      this._tokensRequested++\n    }\n\n    return allowed\n  }\n\n  effectiveRate () {\n    if (this._rateLimit < 0) return 1\n    if (this._rateLimit === 0) return 0\n    if (this._tokensRequested === 0) return 1\n\n    const allowed = this._prevIntervalTokens + this._limiter.tokensThisInterval\n    const requested = this._prevTokensRequested + this._tokensRequested\n\n    return allowed / requested\n  }\n\n  _isAllowed () {\n    if (this._rateLimit < 0) return true\n    if (this._rateLimit === 0) return false\n\n    return this._limiter.tryRemoveTokens(1)\n  }\n\n  _currentWindowRate () {\n    if (this._rateLimit < 0) return 1\n    if (this._rateLimit === 0) return 0\n    if (this._tokensRequested === 0) return 1\n\n    return this._limiter.tokensThisInterval / this._tokensRequested\n  }\n}\n\nmodule.exports = RateLimiter\n"],"mappings":"AAAA;;AAEA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;;AAEA,MAAMC,WAAN,CAAkB;EAChBC,WAAW,CAAEC,SAAF,EAAa;IACtB,KAAKC,UAAL,GAAkBC,QAAQ,CAACF,SAAD,CAA1B;IACA,KAAKG,QAAL,GAAgB,IAAIP,OAAO,CAACE,WAAZ,CAAwB,KAAKG,UAA7B,EAAyC,QAAzC,CAAhB;IACA,KAAKG,gBAAL,GAAwB,CAAxB;IACA,KAAKC,mBAAL,GAA2B,CAA3B;IACA,KAAKC,oBAAL,GAA4B,CAA5B;EACD;;EAEDC,SAAS,GAAI;IACX,MAAMC,gBAAgB,GAAG,KAAKL,QAAL,CAAcK,gBAAvC;IACA,MAAMC,iBAAiB,GAAG,KAAKN,QAAL,CAAcO,kBAAxC;;IACA,MAAMC,OAAO,GAAG,KAAKC,UAAL,EAAhB;;IAEA,IAAIJ,gBAAgB,KAAK,KAAKL,QAAL,CAAcK,gBAAvC,EAAyD;MACvD,KAAKH,mBAAL,GAA2BI,iBAA3B;MACA,KAAKH,oBAAL,GAA4B,KAAKF,gBAAjC;MACA,KAAKA,gBAAL,GAAwB,CAAxB;IACD,CAJD,MAIO;MACL,KAAKA,gBAAL;IACD;;IAED,OAAOO,OAAP;EACD;;EAEDE,aAAa,GAAI;IACf,IAAI,KAAKZ,UAAL,GAAkB,CAAtB,EAAyB,OAAO,CAAP;IACzB,IAAI,KAAKA,UAAL,KAAoB,CAAxB,EAA2B,OAAO,CAAP;IAC3B,IAAI,KAAKG,gBAAL,KAA0B,CAA9B,EAAiC,OAAO,CAAP;IAEjC,MAAMO,OAAO,GAAG,KAAKN,mBAAL,GAA2B,KAAKF,QAAL,CAAcO,kBAAzD;IACA,MAAMI,SAAS,GAAG,KAAKR,oBAAL,GAA4B,KAAKF,gBAAnD;IAEA,OAAOO,OAAO,GAAGG,SAAjB;EACD;;EAEDF,UAAU,GAAI;IACZ,IAAI,KAAKX,UAAL,GAAkB,CAAtB,EAAyB,OAAO,IAAP;IACzB,IAAI,KAAKA,UAAL,KAAoB,CAAxB,EAA2B,OAAO,KAAP;IAE3B,OAAO,KAAKE,QAAL,CAAcY,eAAd,CAA8B,CAA9B,CAAP;EACD;;EAEDC,kBAAkB,GAAI;IACpB,IAAI,KAAKf,UAAL,GAAkB,CAAtB,EAAyB,OAAO,CAAP;IACzB,IAAI,KAAKA,UAAL,KAAoB,CAAxB,EAA2B,OAAO,CAAP;IAC3B,IAAI,KAAKG,gBAAL,KAA0B,CAA9B,EAAiC,OAAO,CAAP;IAEjC,OAAO,KAAKD,QAAL,CAAcO,kBAAd,GAAmC,KAAKN,gBAA/C;EACD;;AAjDe;;AAoDlBa,MAAM,CAACC,OAAP,GAAiBpB,WAAjB"},"metadata":{},"sourceType":"script"}