{"ast":null,"code":"'use strict';\n\nconst dc = require('diagnostics_channel');\n\nconst semver = require('semver');\n\nconst instrumentations = require('./instrumentations');\n\nconst {\n  AsyncResource\n} = require('async_hooks');\n\nconst channelMap = {};\n\nexports.channel = function (name) {\n  const maybe = channelMap[name];\n  if (maybe) return maybe;\n  const ch = dc.channel(name);\n  channelMap[name] = ch;\n  return ch;\n};\n\nexports.addHook = function addHook(_ref, hook) {\n  let {\n    name,\n    versions,\n    file\n  } = _ref;\n\n  if (!instrumentations[name]) {\n    instrumentations[name] = [];\n  }\n\n  instrumentations[name].push({\n    name,\n    versions,\n    file,\n    hook\n  });\n}; // AsyncResource.bind exists and binds `this` properly only from 17.8.0 and up.\n// https://nodejs.org/api/async_context.html#asyncresourcebindfn-thisarg\n\n\nif (semver.satisfies(process.versions.node, '>=17.8.0')) {\n  exports.AsyncResource = AsyncResource;\n} else {\n  exports.AsyncResource = class extends AsyncResource {\n    static bind(fn, type, thisArg) {\n      type = type || fn.name;\n      return new exports.AsyncResource(type || 'bound-anonymous-fn').bind(fn, thisArg);\n    }\n\n    bind(fn, thisArg) {\n      let bound;\n\n      if (thisArg === undefined) {\n        const resource = this;\n\n        bound = function () {\n          for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n            args[_key] = arguments[_key];\n          }\n\n          args.unshift(fn, this);\n          return Reflect.apply(resource.runInAsyncScope, resource, args);\n        };\n      } else {\n        bound = this.runInAsyncScope.bind(this, fn, thisArg);\n      }\n\n      Object.defineProperties(bound, {\n        'length': {\n          configurable: true,\n          enumerable: false,\n          value: fn.length,\n          writable: false\n        },\n        'asyncResource': {\n          configurable: true,\n          enumerable: true,\n          value: this,\n          writable: true\n        }\n      });\n      return bound;\n    }\n\n  };\n}","map":{"version":3,"names":["dc","require","semver","instrumentations","AsyncResource","channelMap","exports","channel","name","maybe","ch","addHook","hook","versions","file","push","satisfies","process","node","bind","fn","type","thisArg","bound","undefined","resource","args","unshift","Reflect","apply","runInAsyncScope","Object","defineProperties","configurable","enumerable","value","length","writable"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/datadog-instrumentations/src/helpers/instrument.js"],"sourcesContent":["'use strict'\n\nconst dc = require('diagnostics_channel')\nconst semver = require('semver')\nconst instrumentations = require('./instrumentations')\nconst { AsyncResource } = require('async_hooks')\n\nconst channelMap = {}\nexports.channel = function (name) {\n  const maybe = channelMap[name]\n  if (maybe) return maybe\n  const ch = dc.channel(name)\n  channelMap[name] = ch\n  return ch\n}\n\nexports.addHook = function addHook ({ name, versions, file }, hook) {\n  if (!instrumentations[name]) {\n    instrumentations[name] = []\n  }\n\n  instrumentations[name].push({ name, versions, file, hook })\n}\n\n// AsyncResource.bind exists and binds `this` properly only from 17.8.0 and up.\n// https://nodejs.org/api/async_context.html#asyncresourcebindfn-thisarg\nif (semver.satisfies(process.versions.node, '>=17.8.0')) {\n  exports.AsyncResource = AsyncResource\n} else {\n  exports.AsyncResource = class extends AsyncResource {\n    static bind (fn, type, thisArg) {\n      type = type || fn.name\n      return (new exports.AsyncResource(type || 'bound-anonymous-fn')).bind(fn, thisArg)\n    }\n\n    bind (fn, thisArg) {\n      let bound\n      if (thisArg === undefined) {\n        const resource = this\n        bound = function (...args) {\n          args.unshift(fn, this)\n          return Reflect.apply(resource.runInAsyncScope, resource, args)\n        }\n      } else {\n        bound = this.runInAsyncScope.bind(this, fn, thisArg)\n      }\n      Object.defineProperties(bound, {\n        'length': {\n          configurable: true,\n          enumerable: false,\n          value: fn.length,\n          writable: false\n        },\n        'asyncResource': {\n          configurable: true,\n          enumerable: true,\n          value: this,\n          writable: true\n        }\n      })\n      return bound\n    }\n  }\n}\n"],"mappings":"AAAA;;AAEA,MAAMA,EAAE,GAAGC,OAAO,CAAC,qBAAD,CAAlB;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAC,QAAD,CAAtB;;AACA,MAAME,gBAAgB,GAAGF,OAAO,CAAC,oBAAD,CAAhC;;AACA,MAAM;EAAEG;AAAF,IAAoBH,OAAO,CAAC,aAAD,CAAjC;;AAEA,MAAMI,UAAU,GAAG,EAAnB;;AACAC,OAAO,CAACC,OAAR,GAAkB,UAAUC,IAAV,EAAgB;EAChC,MAAMC,KAAK,GAAGJ,UAAU,CAACG,IAAD,CAAxB;EACA,IAAIC,KAAJ,EAAW,OAAOA,KAAP;EACX,MAAMC,EAAE,GAAGV,EAAE,CAACO,OAAH,CAAWC,IAAX,CAAX;EACAH,UAAU,CAACG,IAAD,CAAV,GAAmBE,EAAnB;EACA,OAAOA,EAAP;AACD,CAND;;AAQAJ,OAAO,CAACK,OAAR,GAAkB,SAASA,OAAT,OAA4CC,IAA5C,EAAkD;EAAA,IAAhC;IAAEJ,IAAF;IAAQK,QAAR;IAAkBC;EAAlB,CAAgC;;EAClE,IAAI,CAACX,gBAAgB,CAACK,IAAD,CAArB,EAA6B;IAC3BL,gBAAgB,CAACK,IAAD,CAAhB,GAAyB,EAAzB;EACD;;EAEDL,gBAAgB,CAACK,IAAD,CAAhB,CAAuBO,IAAvB,CAA4B;IAAEP,IAAF;IAAQK,QAAR;IAAkBC,IAAlB;IAAwBF;EAAxB,CAA5B;AACD,CAND,C,CAQA;AACA;;;AACA,IAAIV,MAAM,CAACc,SAAP,CAAiBC,OAAO,CAACJ,QAAR,CAAiBK,IAAlC,EAAwC,UAAxC,CAAJ,EAAyD;EACvDZ,OAAO,CAACF,aAAR,GAAwBA,aAAxB;AACD,CAFD,MAEO;EACLE,OAAO,CAACF,aAAR,GAAwB,cAAcA,aAAd,CAA4B;IACvC,OAAJe,IAAI,CAAEC,EAAF,EAAMC,IAAN,EAAYC,OAAZ,EAAqB;MAC9BD,IAAI,GAAGA,IAAI,IAAID,EAAE,CAACZ,IAAlB;MACA,OAAQ,IAAIF,OAAO,CAACF,aAAZ,CAA0BiB,IAAI,IAAI,oBAAlC,CAAD,CAA0DF,IAA1D,CAA+DC,EAA/D,EAAmEE,OAAnE,CAAP;IACD;;IAEDH,IAAI,CAAEC,EAAF,EAAME,OAAN,EAAe;MACjB,IAAIC,KAAJ;;MACA,IAAID,OAAO,KAAKE,SAAhB,EAA2B;QACzB,MAAMC,QAAQ,GAAG,IAAjB;;QACAF,KAAK,GAAG,YAAmB;UAAA,kCAANG,IAAM;YAANA,IAAM;UAAA;;UACzBA,IAAI,CAACC,OAAL,CAAaP,EAAb,EAAiB,IAAjB;UACA,OAAOQ,OAAO,CAACC,KAAR,CAAcJ,QAAQ,CAACK,eAAvB,EAAwCL,QAAxC,EAAkDC,IAAlD,CAAP;QACD,CAHD;MAID,CAND,MAMO;QACLH,KAAK,GAAG,KAAKO,eAAL,CAAqBX,IAArB,CAA0B,IAA1B,EAAgCC,EAAhC,EAAoCE,OAApC,CAAR;MACD;;MACDS,MAAM,CAACC,gBAAP,CAAwBT,KAAxB,EAA+B;QAC7B,UAAU;UACRU,YAAY,EAAE,IADN;UAERC,UAAU,EAAE,KAFJ;UAGRC,KAAK,EAAEf,EAAE,CAACgB,MAHF;UAIRC,QAAQ,EAAE;QAJF,CADmB;QAO7B,iBAAiB;UACfJ,YAAY,EAAE,IADC;UAEfC,UAAU,EAAE,IAFG;UAGfC,KAAK,EAAE,IAHQ;UAIfE,QAAQ,EAAE;QAJK;MAPY,CAA/B;MAcA,OAAOd,KAAP;IACD;;EAhCiD,CAApD;AAkCD"},"metadata":{},"sourceType":"script"}