{"ast":null,"code":"'use strict';\n\nconst {\n  channel,\n  addHook,\n  AsyncResource\n} = require('./helpers/instrument');\n\nconst shimmer = require('../../datadog-shimmer');\n\nconst startCh = channel(`apm:mongodb:query:start`);\nconst finishCh = channel(`apm:mongodb:query:finish`);\nconst errorCh = channel(`apm:mongodb:query:error`);\naddHook({\n  name: 'mongodb-core',\n  versions: ['2 - 3.1.9']\n}, Server => {\n  const serverProto = Server.Server.prototype;\n  shimmer.wrap(serverProto, 'command', command => wrapCommand(command, 'command'));\n  shimmer.wrap(serverProto, 'insert', insert => wrapCommand(insert, 'insert', 'insert'));\n  shimmer.wrap(serverProto, 'update', update => wrapCommand(update, 'update', 'update'));\n  shimmer.wrap(serverProto, 'remove', remove => wrapCommand(remove, 'remove', 'remove'));\n  const cursorProto = Server.Cursor.prototype;\n  shimmer.wrap(cursorProto, '_getmore', _getmore => wrapCursor(_getmore, 'getMore', 'getMore'));\n  shimmer.wrap(cursorProto, '_find', _find => wrapQuery(_find, '_find'));\n  shimmer.wrap(cursorProto, 'kill', kill => wrapCursor(kill, 'killCursors', 'killCursors'));\n  return Server;\n});\naddHook({\n  name: 'mongodb',\n  versions: ['>=4'],\n  file: 'lib/cmap/connection.js'\n}, Connection => {\n  const proto = Connection.Connection.prototype;\n  shimmer.wrap(proto, 'command', command => wrapConnectionCommand(command, 'command'));\n  shimmer.wrap(proto, 'query', query => wrapConnectionCommand(query, 'query'));\n  return Connection;\n});\naddHook({\n  name: 'mongodb',\n  versions: ['>=3.3 <4'],\n  file: 'lib/core/wireprotocol/index.js'\n}, wp => wrapWp(wp));\naddHook({\n  name: 'mongodb-core',\n  versions: ['>=3.2'],\n  file: 'lib/wireprotocol/index.js'\n}, wp => wrapWp(wp));\naddHook({\n  name: 'mongodb-core',\n  versions: ['~3.1.10'],\n  file: 'lib/wireprotocol/3_2_support.js'\n}, WireProtocol => {\n  shimmer.wrap(WireProtocol.prototype, 'command', command => wrapUnifiedCommand(command, 'command'));\n  return WireProtocol;\n});\naddHook({\n  name: 'mongodb-core',\n  versions: ['~3.1.10'],\n  file: 'lib/wireprotocol/2_6_support.js'\n}, WireProtocol => {\n  shimmer.wrap(WireProtocol.prototype, 'command', command => wrapUnifiedCommand(command, 'command'));\n  return WireProtocol;\n});\naddHook({\n  name: 'mongodb',\n  versions: ['>=3.5.4'],\n  file: 'lib/utils.js'\n}, util => {\n  shimmer.wrap(util, 'maybePromise', maybePromise => function (parent, callback, fn) {\n    const asyncResource = new AsyncResource('bound-anonymous-fn');\n    const callbackIndex = arguments.length - 2;\n    callback = arguments[callbackIndex];\n\n    if (typeof callback === 'function') {\n      arguments[callbackIndex] = asyncResource.bind(callback);\n    }\n\n    return maybePromise.apply(this, arguments);\n  });\n  return util;\n});\n\nfunction wrapWp(wp) {\n  shimmer.wrap(wp, 'command', command => wrapUnifiedCommand(command, 'command'));\n  shimmer.wrap(wp, 'insert', insert => wrapUnifiedCommand(insert, 'insert', 'insert'));\n  shimmer.wrap(wp, 'update', update => wrapUnifiedCommand(update, 'update', 'update'));\n  shimmer.wrap(wp, 'remove', remove => wrapUnifiedCommand(remove, 'remove', 'remove'));\n  shimmer.wrap(wp, 'query', query => wrapUnifiedCommand(query, 'query'));\n  shimmer.wrap(wp, 'getMore', getMore => wrapUnifiedCommand(getMore, 'getMore', 'getMore'));\n  shimmer.wrap(wp, 'killCursors', killCursors => wrapUnifiedCommand(killCursors, 'killCursors', 'killCursors'));\n  return wp;\n}\n\nfunction wrapUnifiedCommand(command, operation, name) {\n  const wrapped = function (server, ns, ops) {\n    if (!startCh.hasSubscribers) {\n      return command.apply(this, arguments);\n    }\n\n    return instrument(operation, command, this, arguments, server, ns, ops, {\n      name\n    });\n  };\n\n  return shimmer.wrap(command, wrapped);\n}\n\nfunction wrapConnectionCommand(command, operation, name) {\n  const wrapped = function (ns, ops) {\n    if (!startCh.hasSubscribers) {\n      return command.apply(this, arguments);\n    }\n\n    const hostParts = typeof this.address === 'string' ? this.address.split(':') : '';\n    const options = hostParts.length === 2 ? {\n      host: hostParts[0],\n      port: hostParts[1]\n    } : {}; // no port means the address is a random UUID so no host either\n\n    const topology = {\n      s: {\n        options\n      }\n    };\n    ns = `${ns.db}.${ns.collection}`;\n    return instrument(operation, command, this, arguments, topology, ns, ops, {\n      name\n    });\n  };\n\n  return shimmer.wrap(command, wrapped);\n}\n\nfunction wrapQuery(query, operation, name) {\n  const wrapped = function () {\n    if (!startCh.hasSubscribers) {\n      return query.apply(this, arguments);\n    }\n\n    const pool = this.server.s.pool;\n    const ns = this.ns;\n    const ops = this.cmd;\n    return instrument(operation, query, this, arguments, pool, ns, ops);\n  };\n\n  return shimmer.wrap(query, wrapped);\n}\n\nfunction wrapCursor(cursor, operation, name) {\n  const wrapped = function () {\n    if (!startCh.hasSubscribers) {\n      return cursor.apply(this, arguments);\n    }\n\n    const pool = this.server.s.pool;\n    const ns = this.ns;\n    return instrument(operation, cursor, this, arguments, pool, ns, {}, {\n      name\n    });\n  };\n\n  return shimmer.wrap(cursor, wrapped);\n}\n\nfunction wrapCommand(command, operation, name) {\n  const wrapped = function (ns, ops) {\n    if (!startCh.hasSubscribers) {\n      return command.apply(this, arguments);\n    }\n\n    return instrument(operation, command, this, arguments, this, ns, ops, {\n      name\n    });\n  };\n\n  return shimmer.wrap(command, wrapped);\n}\n\nfunction instrument(operation, command, ctx, args, server, ns, ops) {\n  let options = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : {};\n  const name = options.name || ops && Object.keys(ops)[0];\n  const index = args.length - 1;\n  let callback = args[index];\n  if (typeof callback !== 'function') return command.apply(ctx, args);\n  const serverInfo = server && server.s && server.s.options;\n  const callbackResource = new AsyncResource('bound-anonymous-fn');\n  const asyncResource = new AsyncResource('bound-anonymous-fn');\n  callback = callbackResource.bind(callback);\n  return asyncResource.runInAsyncScope(() => {\n    startCh.publish({\n      ns,\n      ops,\n      options: serverInfo,\n      name\n    });\n    args[index] = asyncResource.bind(function (err, res) {\n      if (err) {\n        errorCh.publish(err);\n      }\n\n      finishCh.publish();\n\n      if (callback) {\n        return callback.apply(this, arguments);\n      }\n    });\n\n    try {\n      return command.apply(ctx, args);\n    } catch (err) {\n      errorCh.publish(err);\n      throw err;\n    }\n  });\n}","map":{"version":3,"names":["channel","addHook","AsyncResource","require","shimmer","startCh","finishCh","errorCh","name","versions","Server","serverProto","prototype","wrap","command","wrapCommand","insert","update","remove","cursorProto","Cursor","_getmore","wrapCursor","_find","wrapQuery","kill","file","Connection","proto","wrapConnectionCommand","query","wp","wrapWp","WireProtocol","wrapUnifiedCommand","util","maybePromise","parent","callback","fn","asyncResource","callbackIndex","arguments","length","bind","apply","getMore","killCursors","operation","wrapped","server","ns","ops","hasSubscribers","instrument","hostParts","address","split","options","host","port","topology","s","db","collection","pool","cmd","cursor","ctx","args","Object","keys","index","serverInfo","callbackResource","runInAsyncScope","publish","err","res"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/datadog-instrumentations/src/mongodb-core.js"],"sourcesContent":["'use strict'\n\nconst {\n  channel,\n  addHook,\n  AsyncResource\n} = require('./helpers/instrument')\nconst shimmer = require('../../datadog-shimmer')\n\nconst startCh = channel(`apm:mongodb:query:start`)\nconst finishCh = channel(`apm:mongodb:query:finish`)\nconst errorCh = channel(`apm:mongodb:query:error`)\n\naddHook({ name: 'mongodb-core', versions: ['2 - 3.1.9'] }, Server => {\n  const serverProto = Server.Server.prototype\n  shimmer.wrap(serverProto, 'command', command => wrapCommand(command, 'command'))\n  shimmer.wrap(serverProto, 'insert', insert => wrapCommand(insert, 'insert', 'insert'))\n  shimmer.wrap(serverProto, 'update', update => wrapCommand(update, 'update', 'update'))\n  shimmer.wrap(serverProto, 'remove', remove => wrapCommand(remove, 'remove', 'remove'))\n\n  const cursorProto = Server.Cursor.prototype\n  shimmer.wrap(cursorProto, '_getmore', _getmore => wrapCursor(_getmore, 'getMore', 'getMore'))\n  shimmer.wrap(cursorProto, '_find', _find => wrapQuery(_find, '_find'))\n  shimmer.wrap(cursorProto, 'kill', kill => wrapCursor(kill, 'killCursors', 'killCursors'))\n  return Server\n})\n\naddHook({ name: 'mongodb', versions: ['>=4'], file: 'lib/cmap/connection.js' }, Connection => {\n  const proto = Connection.Connection.prototype\n  shimmer.wrap(proto, 'command', command => wrapConnectionCommand(command, 'command'))\n  shimmer.wrap(proto, 'query', query => wrapConnectionCommand(query, 'query'))\n  return Connection\n})\n\naddHook({ name: 'mongodb', versions: ['>=3.3 <4'], file: 'lib/core/wireprotocol/index.js' }, wp => wrapWp(wp))\n\naddHook({ name: 'mongodb-core', versions: ['>=3.2'], file: 'lib/wireprotocol/index.js' }, wp => wrapWp(wp))\n\naddHook({ name: 'mongodb-core', versions: ['~3.1.10'], file: 'lib/wireprotocol/3_2_support.js' }, WireProtocol => {\n  shimmer.wrap(WireProtocol.prototype, 'command', command => wrapUnifiedCommand(command, 'command'))\n  return WireProtocol\n})\n\naddHook({ name: 'mongodb-core', versions: ['~3.1.10'], file: 'lib/wireprotocol/2_6_support.js' }, WireProtocol => {\n  shimmer.wrap(WireProtocol.prototype, 'command', command => wrapUnifiedCommand(command, 'command'))\n  return WireProtocol\n})\n\naddHook({ name: 'mongodb', versions: ['>=3.5.4'], file: 'lib/utils.js' }, util => {\n  shimmer.wrap(util, 'maybePromise', maybePromise => function (parent, callback, fn) {\n    const asyncResource = new AsyncResource('bound-anonymous-fn')\n    const callbackIndex = arguments.length - 2\n\n    callback = arguments[callbackIndex]\n\n    if (typeof callback === 'function') {\n      arguments[callbackIndex] = asyncResource.bind(callback)\n    }\n\n    return maybePromise.apply(this, arguments)\n  })\n  return util\n})\n\nfunction wrapWp (wp) {\n  shimmer.wrap(wp, 'command', command => wrapUnifiedCommand(command, 'command'))\n  shimmer.wrap(wp, 'insert', insert => wrapUnifiedCommand(insert, 'insert', 'insert'))\n  shimmer.wrap(wp, 'update', update => wrapUnifiedCommand(update, 'update', 'update'))\n  shimmer.wrap(wp, 'remove', remove => wrapUnifiedCommand(remove, 'remove', 'remove'))\n  shimmer.wrap(wp, 'query', query => wrapUnifiedCommand(query, 'query'))\n  shimmer.wrap(wp, 'getMore', getMore => wrapUnifiedCommand(getMore, 'getMore', 'getMore'))\n  shimmer.wrap(wp, 'killCursors', killCursors => wrapUnifiedCommand(killCursors, 'killCursors', 'killCursors'))\n  return wp\n}\n\nfunction wrapUnifiedCommand (command, operation, name) {\n  const wrapped = function (server, ns, ops) {\n    if (!startCh.hasSubscribers) {\n      return command.apply(this, arguments)\n    }\n    return instrument(operation, command, this, arguments, server, ns, ops, { name })\n  }\n  return shimmer.wrap(command, wrapped)\n}\n\nfunction wrapConnectionCommand (command, operation, name) {\n  const wrapped = function (ns, ops) {\n    if (!startCh.hasSubscribers) {\n      return command.apply(this, arguments)\n    }\n    const hostParts = typeof this.address === 'string' ? this.address.split(':') : ''\n    const options = hostParts.length === 2\n      ? { host: hostParts[0], port: hostParts[1] }\n      : {} // no port means the address is a random UUID so no host either\n    const topology = { s: { options } }\n\n    ns = `${ns.db}.${ns.collection}`\n    return instrument(operation, command, this, arguments, topology, ns, ops, { name })\n  }\n  return shimmer.wrap(command, wrapped)\n}\n\nfunction wrapQuery (query, operation, name) {\n  const wrapped = function () {\n    if (!startCh.hasSubscribers) {\n      return query.apply(this, arguments)\n    }\n    const pool = this.server.s.pool\n    const ns = this.ns\n    const ops = this.cmd\n    return instrument(operation, query, this, arguments, pool, ns, ops)\n  }\n\n  return shimmer.wrap(query, wrapped)\n}\n\nfunction wrapCursor (cursor, operation, name) {\n  const wrapped = function () {\n    if (!startCh.hasSubscribers) {\n      return cursor.apply(this, arguments)\n    }\n    const pool = this.server.s.pool\n    const ns = this.ns\n    return instrument(operation, cursor, this, arguments, pool, ns, {}, { name })\n  }\n  return shimmer.wrap(cursor, wrapped)\n}\n\nfunction wrapCommand (command, operation, name) {\n  const wrapped = function (ns, ops) {\n    if (!startCh.hasSubscribers) {\n      return command.apply(this, arguments)\n    }\n    return instrument(operation, command, this, arguments, this, ns, ops, { name })\n  }\n  return shimmer.wrap(command, wrapped)\n}\n\nfunction instrument (operation, command, ctx, args, server, ns, ops, options = {}) {\n  const name = options.name || (ops && Object.keys(ops)[0])\n  const index = args.length - 1\n  let callback = args[index]\n\n  if (typeof callback !== 'function') return command.apply(ctx, args)\n\n  const serverInfo = server && server.s && server.s.options\n  const callbackResource = new AsyncResource('bound-anonymous-fn')\n  const asyncResource = new AsyncResource('bound-anonymous-fn')\n\n  callback = callbackResource.bind(callback)\n\n  return asyncResource.runInAsyncScope(() => {\n    startCh.publish({ ns, ops, options: serverInfo, name })\n\n    args[index] = asyncResource.bind(function (err, res) {\n      if (err) {\n        errorCh.publish(err)\n      }\n\n      finishCh.publish()\n\n      if (callback) {\n        return callback.apply(this, arguments)\n      }\n    })\n\n    try {\n      return command.apply(ctx, args)\n    } catch (err) {\n      errorCh.publish(err)\n\n      throw err\n    }\n  })\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}