{"ast":null,"code":"'use strict';\n\nconst request = require('../../../exporters/common/request');\n\nconst log = require('../../../log');\n\nconst {\n  CoverageCIVisibilityEncoder\n} = require('../../../encode/coverage-ci-visibility');\n\nconst BaseWriter = require('../../../exporters/common/writer');\n\nfunction safeJSONStringify(value) {\n  return JSON.stringify(value, (key, value) => key !== 'dd-api-key' ? value : undefined);\n}\n\nclass Writer extends BaseWriter {\n  constructor(_ref) {\n    let {\n      url\n    } = _ref;\n    super(...arguments);\n    this._url = url;\n    this._encoder = new CoverageCIVisibilityEncoder(this);\n  }\n\n  _sendPayload(form, _, done) {\n    const options = {\n      path: '/api/v2/citestcov',\n      method: 'POST',\n      headers: {\n        'dd-api-key': process.env.DATADOG_API_KEY || process.env.DD_API_KEY,\n        ...form.getHeaders()\n      },\n      timeout: 15000\n    };\n    options.protocol = this._url.protocol;\n    options.hostname = this._url.hostname;\n    options.port = this._url.port;\n    log.debug(() => `Request to the intake: ${safeJSONStringify(options)}`);\n    request(form, options, (err, res) => {\n      if (err) {\n        log.error(err);\n        done();\n        return;\n      }\n\n      log.debug(`Response from the intake: ${res}`);\n      done();\n    });\n  }\n\n}\n\nmodule.exports = Writer;","map":{"version":3,"names":["request","require","log","CoverageCIVisibilityEncoder","BaseWriter","safeJSONStringify","value","JSON","stringify","key","undefined","Writer","constructor","url","arguments","_url","_encoder","_sendPayload","form","_","done","options","path","method","headers","process","env","DATADOG_API_KEY","DD_API_KEY","getHeaders","timeout","protocol","hostname","port","debug","err","res","error","module","exports"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/dd-trace/src/ci-visibility/exporters/agentless/coverage-writer.js"],"sourcesContent":["'use strict'\nconst request = require('../../../exporters/common/request')\nconst log = require('../../../log')\n\nconst { CoverageCIVisibilityEncoder } = require('../../../encode/coverage-ci-visibility')\nconst BaseWriter = require('../../../exporters/common/writer')\n\nfunction safeJSONStringify (value) {\n  return JSON.stringify(value, (key, value) =>\n    key !== 'dd-api-key' ? value : undefined\n  )\n}\n\nclass Writer extends BaseWriter {\n  constructor ({ url }) {\n    super(...arguments)\n    this._url = url\n    this._encoder = new CoverageCIVisibilityEncoder(this)\n  }\n\n  _sendPayload (form, _, done) {\n    const options = {\n      path: '/api/v2/citestcov',\n      method: 'POST',\n      headers: {\n        'dd-api-key': process.env.DATADOG_API_KEY || process.env.DD_API_KEY,\n        ...form.getHeaders()\n      },\n      timeout: 15000\n    }\n\n    options.protocol = this._url.protocol\n    options.hostname = this._url.hostname\n    options.port = this._url.port\n\n    log.debug(() => `Request to the intake: ${safeJSONStringify(options)}`)\n\n    request(form, options, (err, res) => {\n      if (err) {\n        log.error(err)\n        done()\n        return\n      }\n      log.debug(`Response from the intake: ${res}`)\n      done()\n    })\n  }\n}\n\nmodule.exports = Writer\n"],"mappings":"AAAA;;AACA,MAAMA,OAAO,GAAGC,OAAO,CAAC,mCAAD,CAAvB;;AACA,MAAMC,GAAG,GAAGD,OAAO,CAAC,cAAD,CAAnB;;AAEA,MAAM;EAAEE;AAAF,IAAkCF,OAAO,CAAC,wCAAD,CAA/C;;AACA,MAAMG,UAAU,GAAGH,OAAO,CAAC,kCAAD,CAA1B;;AAEA,SAASI,iBAAT,CAA4BC,KAA5B,EAAmC;EACjC,OAAOC,IAAI,CAACC,SAAL,CAAeF,KAAf,EAAsB,CAACG,GAAD,EAAMH,KAAN,KAC3BG,GAAG,KAAK,YAAR,GAAuBH,KAAvB,GAA+BI,SAD1B,CAAP;AAGD;;AAED,MAAMC,MAAN,SAAqBP,UAArB,CAAgC;EAC9BQ,WAAW,OAAW;IAAA,IAAT;MAAEC;IAAF,CAAS;IACpB,MAAM,GAAGC,SAAT;IACA,KAAKC,IAAL,GAAYF,GAAZ;IACA,KAAKG,QAAL,GAAgB,IAAIb,2BAAJ,CAAgC,IAAhC,CAAhB;EACD;;EAEDc,YAAY,CAAEC,IAAF,EAAQC,CAAR,EAAWC,IAAX,EAAiB;IAC3B,MAAMC,OAAO,GAAG;MACdC,IAAI,EAAE,mBADQ;MAEdC,MAAM,EAAE,MAFM;MAGdC,OAAO,EAAE;QACP,cAAcC,OAAO,CAACC,GAAR,CAAYC,eAAZ,IAA+BF,OAAO,CAACC,GAAR,CAAYE,UADlD;QAEP,GAAGV,IAAI,CAACW,UAAL;MAFI,CAHK;MAOdC,OAAO,EAAE;IAPK,CAAhB;IAUAT,OAAO,CAACU,QAAR,GAAmB,KAAKhB,IAAL,CAAUgB,QAA7B;IACAV,OAAO,CAACW,QAAR,GAAmB,KAAKjB,IAAL,CAAUiB,QAA7B;IACAX,OAAO,CAACY,IAAR,GAAe,KAAKlB,IAAL,CAAUkB,IAAzB;IAEA/B,GAAG,CAACgC,KAAJ,CAAU,MAAO,0BAAyB7B,iBAAiB,CAACgB,OAAD,CAAU,EAArE;IAEArB,OAAO,CAACkB,IAAD,EAAOG,OAAP,EAAgB,CAACc,GAAD,EAAMC,GAAN,KAAc;MACnC,IAAID,GAAJ,EAAS;QACPjC,GAAG,CAACmC,KAAJ,CAAUF,GAAV;QACAf,IAAI;QACJ;MACD;;MACDlB,GAAG,CAACgC,KAAJ,CAAW,6BAA4BE,GAAI,EAA3C;MACAhB,IAAI;IACL,CARM,CAAP;EASD;;AAjC6B;;AAoChCkB,MAAM,CAACC,OAAP,GAAiB5B,MAAjB"},"metadata":{},"sourceType":"script"}