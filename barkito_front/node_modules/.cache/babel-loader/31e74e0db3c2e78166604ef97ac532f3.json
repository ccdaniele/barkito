{"ast":null,"code":"'use strict';\n\nconst {\n  channel,\n  addHook,\n  AsyncResource\n} = require('./helpers/instrument');\n\nconst shimmer = require('../../datadog-shimmer');\n\nconst circularBufferConstructor = Symbol('circularBufferConstructor');\nconst inFlightDeliveries = Symbol('inFlightDeliveries');\nconst patched = new WeakSet();\nconst dispatchCh = channel('apm:rhea:dispatch');\nconst errorCh = channel('apm:rhea:error');\nconst finishCh = channel('apm:rhea:finish');\nconst encodeCh = channel('apm:rhea:encode');\nconst contexts = new WeakMap();\naddHook({\n  name: 'rhea',\n  versions: ['>=1']\n}, rhea => {\n  shimmer.wrap(rhea.message, 'encode', encode => function (msg) {\n    encodeCh.publish(msg);\n    return encode.apply(this, arguments);\n  });\n  return rhea;\n});\naddHook({\n  name: 'rhea',\n  versions: ['>=1'],\n  file: 'lib/link.js'\n}, obj => {\n  const startSendCh = channel('apm:rhea:send:start');\n  const startReceiveCh = channel('apm:rhea:receive:start');\n  const Sender = obj.Sender;\n  const Receiver = obj.Receiver;\n  shimmer.wrap(Sender.prototype, 'send', send => function (msg, tag, format) {\n    if (!canTrace(this)) {\n      // we can't handle disconnects or ending spans, so we can't safely instrument\n      return send.apply(this, arguments);\n    }\n\n    const {\n      host,\n      port\n    } = getHostAndPort(this.connection);\n    const targetAddress = this.options && this.options.target && this.options.target.address ? this.options.target.address : undefined;\n    const asyncResource = new AsyncResource('bound-anonymous-fn');\n    return asyncResource.runInAsyncScope(() => {\n      startSendCh.publish({\n        targetAddress,\n        host,\n        port,\n        msg\n      });\n      const delivery = send.apply(this, arguments);\n      const context = {\n        asyncResource\n      };\n      contexts.set(delivery, context);\n      addToInFlightDeliveries(this.connection, delivery);\n\n      try {\n        return delivery;\n      } catch (err) {\n        errorCh.publish(err);\n        throw err;\n      }\n    });\n  });\n  shimmer.wrap(Receiver.prototype, 'dispatch', dispatch => function (eventName, msgObj) {\n    if (!canTrace(this)) {\n      // we can't handle disconnects or ending spans, so we can't safely instrument\n      return dispatch.apply(this, arguments);\n    }\n\n    if (eventName === 'message' && msgObj) {\n      const asyncResource = new AsyncResource('bound-anonymous-fn');\n      return asyncResource.runInAsyncScope(() => {\n        startReceiveCh.publish({\n          msgObj,\n          connection: this.connection\n        });\n\n        if (msgObj.delivery) {\n          const context = {\n            asyncResource\n          };\n          contexts.set(msgObj.delivery, context);\n          msgObj.delivery.update = wrapDeliveryUpdate(msgObj.delivery, msgObj.delivery.update);\n          addToInFlightDeliveries(this.connection, msgObj.delivery);\n        }\n\n        try {\n          return dispatch.apply(this, arguments);\n        } catch (err) {\n          errorCh.publish(err);\n          throw err;\n        }\n      });\n    }\n\n    return dispatch.apply(this, arguments);\n  });\n  return obj;\n});\naddHook({\n  name: 'rhea',\n  versions: ['>=1'],\n  file: 'lib/connection.js'\n}, Connection => {\n  shimmer.wrap(Connection.prototype, 'dispatch', dispatch => function (eventName, obj) {\n    if (eventName === 'disconnected') {\n      const error = obj.error || this.saved_error;\n\n      if (this[inFlightDeliveries]) {\n        this[inFlightDeliveries].forEach(delivery => {\n          const context = contexts.get(delivery);\n          const asyncResource = context && context.asyncResource;\n          if (!asyncResource) return;\n          asyncResource.runInAsyncScope(() => {\n            errorCh.publish(error);\n            finish(delivery, null);\n          });\n        });\n      }\n    }\n\n    return dispatch.apply(this, arguments);\n  });\n  return Connection;\n});\naddHook({\n  name: 'rhea',\n  versions: ['>=1'],\n  file: 'lib/session.js'\n}, Session => {\n  patchCircularBuffer(Session.prototype, Session);\n  return Session;\n});\n\nfunction canTrace(link) {\n  return link.connection && link.session && link.session.outgoing;\n}\n\nfunction getHostAndPort(connection) {\n  let host;\n  let port;\n\n  if (connection && connection.options) {\n    host = connection.options.host;\n    port = connection.options.port;\n  }\n\n  return {\n    host,\n    port\n  };\n}\n\nfunction wrapDeliveryUpdate(obj, update) {\n  const context = contexts.get(obj);\n  const asyncResource = context.asyncResource;\n\n  if (obj && asyncResource) {\n    const cb = asyncResource.bind(update);\n    return AsyncResource.bind(function wrappedUpdate(settled, stateData) {\n      const state = getStateFromData(stateData);\n      dispatchCh.publish({\n        state\n      });\n      return cb.apply(this, arguments);\n    });\n  }\n\n  return function wrappedUpdate(settled, stateData) {\n    return update.apply(this, arguments);\n  };\n}\n\nfunction patchCircularBuffer(proto, Session) {\n  Object.defineProperty(proto, 'outgoing', {\n    configurable: true,\n\n    get() {\n      return undefined;\n    },\n\n    set(outgoing) {\n      delete proto.outgoing; // removes the setter on the prototype\n\n      this.outgoing = outgoing; // assigns on the instance, like normal\n\n      if (outgoing) {\n        let CircularBuffer;\n\n        if (outgoing.deliveries) {\n          CircularBuffer = outgoing.deliveries.constructor;\n        }\n\n        if (CircularBuffer && !patched.has(CircularBuffer.prototype)) {\n          shimmer.wrap(CircularBuffer.prototype, 'pop_if', popIf => function (fn) {\n            arguments[0] = AsyncResource.bind(function (entry) {\n              const context = contexts.get(entry);\n              const asyncResource = context && context.asyncResource;\n              if (!asyncResource) return fn(entry);\n              const shouldPop = asyncResource.runInAsyncScope(() => fn(entry));\n\n              if (shouldPop) {\n                const remoteState = entry.remote_state;\n                const state = remoteState && remoteState.constructor ? entry.remote_state.constructor.composite_type : undefined;\n                asyncResource.runInAsyncScope(() => {\n                  return finish(entry, state);\n                });\n              }\n\n              return shouldPop;\n            });\n            return popIf.apply(this, arguments);\n          });\n          patched.add(CircularBuffer.prototype);\n          const Session = proto.constructor;\n\n          if (Session) {\n            Session[circularBufferConstructor] = CircularBuffer;\n          }\n        }\n      }\n    }\n\n  });\n}\n\nfunction addToInFlightDeliveries(connection, delivery) {\n  let deliveries = connection[inFlightDeliveries];\n\n  if (!deliveries) {\n    deliveries = new Set();\n    connection[inFlightDeliveries] = deliveries;\n  }\n\n  deliveries.add(delivery);\n}\n\nfunction finish(delivery, state) {\n  const obj = contexts.get(delivery);\n\n  if (obj) {\n    if (state) {\n      dispatchCh.publish({\n        state\n      });\n    }\n\n    finishCh.publish(undefined);\n\n    if (obj.connection && obj.connection[inFlightDeliveries]) {\n      obj.connection[inFlightDeliveries].delete(delivery);\n    }\n  }\n}\n\nfunction getStateFromData(stateData) {\n  if (stateData && stateData.descriptor && stateData.descriptor) {\n    switch (stateData.descriptor.value) {\n      case 0x24:\n        return 'accepted';\n\n      case 0x25:\n        return 'rejected';\n\n      case 0x26:\n        return 'released';\n\n      case 0x27:\n        return 'modified';\n    }\n  }\n}","map":{"version":3,"names":["channel","addHook","AsyncResource","require","shimmer","circularBufferConstructor","Symbol","inFlightDeliveries","patched","WeakSet","dispatchCh","errorCh","finishCh","encodeCh","contexts","WeakMap","name","versions","rhea","wrap","message","encode","msg","publish","apply","arguments","file","obj","startSendCh","startReceiveCh","Sender","Receiver","prototype","send","tag","format","canTrace","host","port","getHostAndPort","connection","targetAddress","options","target","address","undefined","asyncResource","runInAsyncScope","delivery","context","set","addToInFlightDeliveries","err","dispatch","eventName","msgObj","update","wrapDeliveryUpdate","Connection","error","saved_error","forEach","get","finish","Session","patchCircularBuffer","link","session","outgoing","cb","bind","wrappedUpdate","settled","stateData","state","getStateFromData","proto","Object","defineProperty","configurable","CircularBuffer","deliveries","constructor","has","popIf","fn","entry","shouldPop","remoteState","remote_state","composite_type","add","Set","delete","descriptor","value"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/datadog-instrumentations/src/rhea.js"],"sourcesContent":["'use strict'\n\nconst {\n  channel,\n  addHook,\n  AsyncResource\n} = require('./helpers/instrument')\nconst shimmer = require('../../datadog-shimmer')\n\nconst circularBufferConstructor = Symbol('circularBufferConstructor')\nconst inFlightDeliveries = Symbol('inFlightDeliveries')\n\nconst patched = new WeakSet()\nconst dispatchCh = channel('apm:rhea:dispatch')\nconst errorCh = channel('apm:rhea:error')\nconst finishCh = channel('apm:rhea:finish')\n\nconst encodeCh = channel('apm:rhea:encode')\n\nconst contexts = new WeakMap()\n\naddHook({ name: 'rhea', versions: ['>=1'] }, rhea => {\n  shimmer.wrap(rhea.message, 'encode', encode => function (msg) {\n    encodeCh.publish(msg)\n    return encode.apply(this, arguments)\n  })\n\n  return rhea\n})\n\naddHook({ name: 'rhea', versions: ['>=1'], file: 'lib/link.js' }, obj => {\n  const startSendCh = channel('apm:rhea:send:start')\n  const startReceiveCh = channel('apm:rhea:receive:start')\n\n  const Sender = obj.Sender\n  const Receiver = obj.Receiver\n  shimmer.wrap(Sender.prototype, 'send', send => function (msg, tag, format) {\n    if (!canTrace(this)) {\n      // we can't handle disconnects or ending spans, so we can't safely instrument\n      return send.apply(this, arguments)\n    }\n\n    const { host, port } = getHostAndPort(this.connection)\n\n    const targetAddress = this.options && this.options.target &&\n      this.options.target.address ? this.options.target.address : undefined\n\n    const asyncResource = new AsyncResource('bound-anonymous-fn')\n    return asyncResource.runInAsyncScope(() => {\n      startSendCh.publish({ targetAddress, host, port, msg })\n      const delivery = send.apply(this, arguments)\n      const context = {\n        asyncResource\n      }\n      contexts.set(delivery, context)\n\n      addToInFlightDeliveries(this.connection, delivery)\n      try {\n        return delivery\n      } catch (err) {\n        errorCh.publish(err)\n\n        throw err\n      }\n    })\n  })\n\n  shimmer.wrap(Receiver.prototype, 'dispatch', dispatch => function (eventName, msgObj) {\n    if (!canTrace(this)) {\n      // we can't handle disconnects or ending spans, so we can't safely instrument\n      return dispatch.apply(this, arguments)\n    }\n\n    if (eventName === 'message' && msgObj) {\n      const asyncResource = new AsyncResource('bound-anonymous-fn')\n      return asyncResource.runInAsyncScope(() => {\n        startReceiveCh.publish({ msgObj, connection: this.connection })\n\n        if (msgObj.delivery) {\n          const context = {\n            asyncResource\n          }\n          contexts.set(msgObj.delivery, context)\n          msgObj.delivery.update = wrapDeliveryUpdate(msgObj.delivery, msgObj.delivery.update)\n          addToInFlightDeliveries(this.connection, msgObj.delivery)\n        }\n        try {\n          return dispatch.apply(this, arguments)\n        } catch (err) {\n          errorCh.publish(err)\n\n          throw err\n        }\n      })\n    }\n\n    return dispatch.apply(this, arguments)\n  })\n  return obj\n})\n\naddHook({ name: 'rhea', versions: ['>=1'], file: 'lib/connection.js' }, Connection => {\n  shimmer.wrap(Connection.prototype, 'dispatch', dispatch => function (eventName, obj) {\n    if (eventName === 'disconnected') {\n      const error = obj.error || this.saved_error\n      if (this[inFlightDeliveries]) {\n        this[inFlightDeliveries].forEach(delivery => {\n          const context = contexts.get(delivery)\n          const asyncResource = context && context.asyncResource\n\n          if (!asyncResource) return\n\n          asyncResource.runInAsyncScope(() => {\n            errorCh.publish(error)\n            finish(delivery, null)\n          })\n        })\n      }\n    }\n    return dispatch.apply(this, arguments)\n  })\n  return Connection\n})\n\naddHook({ name: 'rhea', versions: ['>=1'], file: 'lib/session.js' }, (Session) => {\n  patchCircularBuffer(Session.prototype, Session)\n  return Session\n})\n\nfunction canTrace (link) {\n  return link.connection && link.session && link.session.outgoing\n}\n\nfunction getHostAndPort (connection) {\n  let host\n  let port\n  if (connection && connection.options) {\n    host = connection.options.host\n    port = connection.options.port\n  }\n  return { host, port }\n}\n\nfunction wrapDeliveryUpdate (obj, update) {\n  const context = contexts.get(obj)\n  const asyncResource = context.asyncResource\n  if (obj && asyncResource) {\n    const cb = asyncResource.bind(update)\n    return AsyncResource.bind(function wrappedUpdate (settled, stateData) {\n      const state = getStateFromData(stateData)\n      dispatchCh.publish({ state })\n      return cb.apply(this, arguments)\n    })\n  }\n  return function wrappedUpdate (settled, stateData) {\n    return update.apply(this, arguments)\n  }\n}\n\nfunction patchCircularBuffer (proto, Session) {\n  Object.defineProperty(proto, 'outgoing', {\n    configurable: true,\n    get () { return undefined },\n    set (outgoing) {\n      delete proto.outgoing // removes the setter on the prototype\n      this.outgoing = outgoing // assigns on the instance, like normal\n      if (outgoing) {\n        let CircularBuffer\n        if (outgoing.deliveries) {\n          CircularBuffer = outgoing.deliveries.constructor\n        }\n        if (CircularBuffer && !patched.has(CircularBuffer.prototype)) {\n          shimmer.wrap(CircularBuffer.prototype, 'pop_if', popIf => function (fn) {\n            arguments[0] = AsyncResource.bind(function (entry) {\n              const context = contexts.get(entry)\n              const asyncResource = context && context.asyncResource\n\n              if (!asyncResource) return fn(entry)\n\n              const shouldPop = asyncResource.runInAsyncScope(() => fn(entry))\n\n              if (shouldPop) {\n                const remoteState = entry.remote_state\n                const state = remoteState && remoteState.constructor\n                  ? entry.remote_state.constructor.composite_type : undefined\n                asyncResource.runInAsyncScope(() => {\n                  return finish(entry, state)\n                })\n              }\n\n              return shouldPop\n            })\n            return popIf.apply(this, arguments)\n          })\n          patched.add(CircularBuffer.prototype)\n          const Session = proto.constructor\n          if (Session) {\n            Session[circularBufferConstructor] = CircularBuffer\n          }\n        }\n      }\n    }\n  })\n}\n\nfunction addToInFlightDeliveries (connection, delivery) {\n  let deliveries = connection[inFlightDeliveries]\n  if (!deliveries) {\n    deliveries = new Set()\n    connection[inFlightDeliveries] = deliveries\n  }\n  deliveries.add(delivery)\n}\n\nfunction finish (delivery, state) {\n  const obj = contexts.get(delivery)\n  if (obj) {\n    if (state) {\n      dispatchCh.publish({ state })\n    }\n    finishCh.publish(undefined)\n    if (obj.connection && obj.connection[inFlightDeliveries]) {\n      obj.connection[inFlightDeliveries].delete(delivery)\n    }\n  }\n}\n\nfunction getStateFromData (stateData) {\n  if (stateData && stateData.descriptor && stateData.descriptor) {\n    switch (stateData.descriptor.value) {\n      case 0x24: return 'accepted'\n      case 0x25: return 'rejected'\n      case 0x26: return 'released'\n      case 0x27: return 'modified'\n    }\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}