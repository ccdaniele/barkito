{"ast":null,"code":"'use strict';\n\nconst {\n  truncateSpan,\n  normalizeSpan\n} = require('./tags-processors');\n\nconst {\n  AgentEncoder: BaseEncoder\n} = require('./0.4');\n\nconst ARRAY_OF_TWO = 0x92;\nconst ARRAY_OF_TWELVE = 0x9c;\n\nfunction formatSpan(span) {\n  return normalizeSpan(truncateSpan(span));\n}\n\nclass AgentEncoder extends BaseEncoder {\n  makePayload() {\n    const prefixSize = 1;\n    const stringSize = this._stringBytes.length + 5;\n    const traceSize = this._traceBytes.length + 5;\n    const buffer = Buffer.allocUnsafe(prefixSize + stringSize + traceSize);\n    let offset = 0;\n    buffer[offset++] = ARRAY_OF_TWO;\n    offset = this._writeStrings(buffer, offset);\n    offset = this._writeTraces(buffer, offset);\n\n    this._reset();\n\n    return buffer;\n  }\n\n  _encode(bytes, trace) {\n    this._encodeArrayPrefix(bytes, trace);\n\n    for (let span of trace) {\n      span = formatSpan(span);\n\n      this._encodeByte(bytes, ARRAY_OF_TWELVE);\n\n      this._encodeString(bytes, span.service);\n\n      this._encodeString(bytes, span.name);\n\n      this._encodeString(bytes, span.resource);\n\n      this._encodeId(bytes, span.trace_id);\n\n      this._encodeId(bytes, span.span_id);\n\n      this._encodeId(bytes, span.parent_id);\n\n      this._encodeLong(bytes, span.start || 0);\n\n      this._encodeLong(bytes, span.duration || 0);\n\n      this._encodeInteger(bytes, span.error);\n\n      this._encodeMap(bytes, span.meta || {});\n\n      this._encodeMap(bytes, span.metrics || {});\n\n      this._encodeString(bytes, span.type);\n    }\n  }\n\n  _encodeString(bytes) {\n    let value = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n\n    this._cacheString(value);\n\n    this._encodeInteger(bytes, this._stringMap[value]);\n  }\n\n  _cacheString(value) {\n    if (!(value in this._stringMap)) {\n      this._stringMap[value] = this._stringCount++;\n\n      this._stringBytes.write(value);\n    }\n  }\n\n  _writeStrings(buffer, offset) {\n    offset = this._writeArrayPrefix(buffer, offset, this._stringCount);\n    offset += this._stringBytes.buffer.copy(buffer, offset, 0, this._stringBytes.length);\n    return offset;\n  }\n\n}\n\nmodule.exports = {\n  AgentEncoder\n};","map":{"version":3,"names":["truncateSpan","normalizeSpan","require","AgentEncoder","BaseEncoder","ARRAY_OF_TWO","ARRAY_OF_TWELVE","formatSpan","span","makePayload","prefixSize","stringSize","_stringBytes","length","traceSize","_traceBytes","buffer","Buffer","allocUnsafe","offset","_writeStrings","_writeTraces","_reset","_encode","bytes","trace","_encodeArrayPrefix","_encodeByte","_encodeString","service","name","resource","_encodeId","trace_id","span_id","parent_id","_encodeLong","start","duration","_encodeInteger","error","_encodeMap","meta","metrics","type","value","_cacheString","_stringMap","_stringCount","write","_writeArrayPrefix","copy","module","exports"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/dd-trace/src/encode/0.5.js"],"sourcesContent":["'use strict'\n\nconst { truncateSpan, normalizeSpan } = require('./tags-processors')\nconst { AgentEncoder: BaseEncoder } = require('./0.4')\n\nconst ARRAY_OF_TWO = 0x92\nconst ARRAY_OF_TWELVE = 0x9c\n\nfunction formatSpan (span) {\n  return normalizeSpan(truncateSpan(span))\n}\n\nclass AgentEncoder extends BaseEncoder {\n  makePayload () {\n    const prefixSize = 1\n    const stringSize = this._stringBytes.length + 5\n    const traceSize = this._traceBytes.length + 5\n    const buffer = Buffer.allocUnsafe(prefixSize + stringSize + traceSize)\n\n    let offset = 0\n\n    buffer[offset++] = ARRAY_OF_TWO\n\n    offset = this._writeStrings(buffer, offset)\n    offset = this._writeTraces(buffer, offset)\n\n    this._reset()\n\n    return buffer\n  }\n\n  _encode (bytes, trace) {\n    this._encodeArrayPrefix(bytes, trace)\n\n    for (let span of trace) {\n      span = formatSpan(span)\n      this._encodeByte(bytes, ARRAY_OF_TWELVE)\n      this._encodeString(bytes, span.service)\n      this._encodeString(bytes, span.name)\n      this._encodeString(bytes, span.resource)\n      this._encodeId(bytes, span.trace_id)\n      this._encodeId(bytes, span.span_id)\n      this._encodeId(bytes, span.parent_id)\n      this._encodeLong(bytes, span.start || 0)\n      this._encodeLong(bytes, span.duration || 0)\n      this._encodeInteger(bytes, span.error)\n      this._encodeMap(bytes, span.meta || {})\n      this._encodeMap(bytes, span.metrics || {})\n      this._encodeString(bytes, span.type)\n    }\n  }\n\n  _encodeString (bytes, value = '') {\n    this._cacheString(value)\n    this._encodeInteger(bytes, this._stringMap[value])\n  }\n\n  _cacheString (value) {\n    if (!(value in this._stringMap)) {\n      this._stringMap[value] = this._stringCount++\n      this._stringBytes.write(value)\n    }\n  }\n\n  _writeStrings (buffer, offset) {\n    offset = this._writeArrayPrefix(buffer, offset, this._stringCount)\n    offset += this._stringBytes.buffer.copy(buffer, offset, 0, this._stringBytes.length)\n\n    return offset\n  }\n}\n\nmodule.exports = { AgentEncoder }\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}