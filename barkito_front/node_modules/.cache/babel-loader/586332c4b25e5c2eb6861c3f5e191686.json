{"ast":null,"code":"'use strict';\n\nconst Plugin = require('../../dd-trace/src/plugins/plugin');\n\nconst {\n  storage\n} = require('../../datadog-core');\n\nconst tags = require('../../../ext/tags');\n\nconst analyticsSampler = require('../../dd-trace/src/analytics_sampler');\n\nconst formats = require('../../../ext/formats');\n\nconst HTTP_HEADERS = formats.HTTP_HEADERS;\n\nconst urlFilter = require('../../dd-trace/src/plugins/util/urlfilter');\n\nconst log = require('../../dd-trace/src/log');\n\nconst url = require('url');\n\nconst HTTP_STATUS_CODE = tags.HTTP_STATUS_CODE;\nconst HTTP_REQUEST_HEADERS = tags.HTTP_REQUEST_HEADERS;\nconst HTTP_RESPONSE_HEADERS = tags.HTTP_RESPONSE_HEADERS;\n\nclass HttpClientPlugin extends Plugin {\n  static get name() {\n    return 'http';\n  }\n\n  constructor() {\n    super(...arguments);\n    this.addSub('apm:http:client:request:start', _ref => {\n      let {\n        args,\n        http\n      } = _ref;\n      const store = storage.getStore();\n      const options = args.options;\n      const agent = options.agent || options._defaultAgent || http.globalAgent;\n      const protocol = options.protocol || agent.protocol || 'http:';\n      const hostname = options.hostname || options.host || 'localhost';\n      const host = options.port ? `${hostname}:${options.port}` : hostname;\n      const path = options.path ? options.path.split(/[?#]/)[0] : '/';\n      const uri = `${protocol}//${host}${path}`;\n      const method = (options.method || 'GET').toUpperCase();\n      const childOf = store ? store.span : store;\n      const span = this.tracer.startSpan('http.request', {\n        childOf,\n        tags: {\n          'span.kind': 'client',\n          'service.name': getServiceName(this.tracer, this.config, options),\n          'resource.name': method,\n          'span.type': 'http',\n          'http.method': method,\n          'http.url': uri\n        }\n      });\n\n      if (!(hasAmazonSignature(options) || !this.config.propagationFilter(uri))) {\n        this.tracer.inject(span, HTTP_HEADERS, options.headers);\n      }\n\n      analyticsSampler.sample(span, this.config.measured);\n      this.enter(span, store);\n    });\n    this.addSub('apm:http:client:request:finish', _ref2 => {\n      let {\n        req,\n        res\n      } = _ref2;\n      const span = storage.getStore().span;\n\n      if (res) {\n        span.setTag(HTTP_STATUS_CODE, res.statusCode);\n\n        if (!this.config.validateStatus(res.statusCode)) {\n          span.setTag('error', 1);\n        }\n\n        addResponseHeaders(res, span, this.config);\n      }\n\n      addRequestHeaders(req, span, this.config);\n      this.config.hooks.request(span, req, res);\n      span.finish();\n    });\n    this.addSub('apm:http:client:request:error', errorHandler);\n  }\n\n  configure(config) {\n    return super.configure(normalizeClientConfig(config));\n  }\n\n}\n\nfunction errorHandler(err) {\n  const span = storage.getStore().span;\n\n  if (err) {\n    span.addTags({\n      'error.type': err.name,\n      'error.msg': err.message,\n      'error.stack': err.stack\n    });\n  } else {\n    span.setTag('error', 1);\n  }\n}\n\nfunction addResponseHeaders(res, span, config) {\n  config.headers.forEach(key => {\n    const value = res.headers[key];\n\n    if (value) {\n      span.setTag(`${HTTP_RESPONSE_HEADERS}.${key}`, value);\n    }\n  });\n}\n\nfunction addRequestHeaders(req, span, config) {\n  config.headers.forEach(key => {\n    const value = req.getHeader(key);\n\n    if (value) {\n      span.setTag(`${HTTP_REQUEST_HEADERS}.${key}`, value);\n    }\n  });\n}\n\nfunction normalizeClientConfig(config) {\n  const validateStatus = getStatusValidator(config);\n  const propagationFilter = getFilter({\n    blocklist: config.propagationBlocklist\n  });\n  const headers = getHeaders(config);\n  const hooks = getHooks(config);\n  return Object.assign({}, config, {\n    validateStatus,\n    propagationFilter,\n    headers,\n    hooks\n  });\n}\n\nfunction getStatusValidator(config) {\n  if (typeof config.validateStatus === 'function') {\n    return config.validateStatus;\n  } else if (config.hasOwnProperty('validateStatus')) {\n    log.error('Expected `validateStatus` to be a function.');\n  }\n\n  return code => code < 400 || code >= 500;\n}\n\nfunction getFilter(config) {\n  config = Object.assign({}, config, {\n    blocklist: config.blocklist || []\n  });\n  return urlFilter.getFilter(config);\n}\n\nfunction getHeaders(config) {\n  if (!Array.isArray(config.headers)) return [];\n  return config.headers.filter(key => typeof key === 'string').map(key => key.toLowerCase());\n}\n\nfunction getHooks(config) {\n  const noop = () => {};\n\n  const request = config.hooks && config.hooks.request || noop;\n  return {\n    request\n  };\n}\n\nfunction hasAmazonSignature(options) {\n  if (!options) {\n    return false;\n  }\n\n  if (options.headers) {\n    const headers = Object.keys(options.headers).reduce((prev, next) => Object.assign(prev, {\n      [next.toLowerCase()]: options.headers[next]\n    }), {});\n\n    if (headers['x-amz-signature']) {\n      return true;\n    }\n\n    if ([].concat(headers['authorization']).some(startsWith('AWS4-HMAC-SHA256'))) {\n      return true;\n    }\n  }\n\n  return options.path && options.path.toLowerCase().indexOf('x-amz-signature=') !== -1;\n}\n\nfunction getServiceName(tracer, config, options) {\n  if (config.splitByDomain) {\n    return getHost(options);\n  } else if (config.service) {\n    return config.service;\n  }\n\n  return `${tracer._service}-http-client`;\n}\n\nfunction getHost(options) {\n  if (typeof options === 'string') {\n    return url.parse(options).host;\n  }\n\n  const hostname = options.hostname || options.host || 'localhost';\n  const port = options.port;\n  return [hostname, port].filter(val => val).join(':');\n}\n\nfunction startsWith(searchString) {\n  return value => String(value).startsWith(searchString);\n}\n\nmodule.exports = HttpClientPlugin;","map":{"version":3,"names":["Plugin","require","storage","tags","analyticsSampler","formats","HTTP_HEADERS","urlFilter","log","url","HTTP_STATUS_CODE","HTTP_REQUEST_HEADERS","HTTP_RESPONSE_HEADERS","HttpClientPlugin","name","constructor","addSub","args","http","store","getStore","options","agent","_defaultAgent","globalAgent","protocol","hostname","host","port","path","split","uri","method","toUpperCase","childOf","span","tracer","startSpan","getServiceName","config","hasAmazonSignature","propagationFilter","inject","headers","sample","measured","enter","req","res","setTag","statusCode","validateStatus","addResponseHeaders","addRequestHeaders","hooks","request","finish","errorHandler","configure","normalizeClientConfig","err","addTags","message","stack","forEach","key","value","getHeader","getStatusValidator","getFilter","blocklist","propagationBlocklist","getHeaders","getHooks","Object","assign","hasOwnProperty","error","code","Array","isArray","filter","map","toLowerCase","noop","keys","reduce","prev","next","concat","some","startsWith","indexOf","splitByDomain","getHost","service","_service","parse","val","join","searchString","String","module","exports"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/datadog-plugin-http/src/client.js"],"sourcesContent":["'use strict'\n\nconst Plugin = require('../../dd-trace/src/plugins/plugin')\nconst { storage } = require('../../datadog-core')\nconst tags = require('../../../ext/tags')\nconst analyticsSampler = require('../../dd-trace/src/analytics_sampler')\nconst formats = require('../../../ext/formats')\nconst HTTP_HEADERS = formats.HTTP_HEADERS\nconst urlFilter = require('../../dd-trace/src/plugins/util/urlfilter')\nconst log = require('../../dd-trace/src/log')\nconst url = require('url')\n\nconst HTTP_STATUS_CODE = tags.HTTP_STATUS_CODE\nconst HTTP_REQUEST_HEADERS = tags.HTTP_REQUEST_HEADERS\nconst HTTP_RESPONSE_HEADERS = tags.HTTP_RESPONSE_HEADERS\n\nclass HttpClientPlugin extends Plugin {\n  static get name () {\n    return 'http'\n  }\n\n  constructor (...args) {\n    super(...args)\n\n    this.addSub('apm:http:client:request:start', ({ args, http }) => {\n      const store = storage.getStore()\n      const options = args.options\n      const agent = options.agent || options._defaultAgent || http.globalAgent\n      const protocol = options.protocol || agent.protocol || 'http:'\n      const hostname = options.hostname || options.host || 'localhost'\n      const host = options.port ? `${hostname}:${options.port}` : hostname\n      const path = options.path ? options.path.split(/[?#]/)[0] : '/'\n      const uri = `${protocol}//${host}${path}`\n\n      const method = (options.method || 'GET').toUpperCase()\n      const childOf = store ? store.span : store\n      const span = this.tracer.startSpan('http.request', {\n        childOf,\n        tags: {\n          'span.kind': 'client',\n          'service.name': getServiceName(this.tracer, this.config, options),\n          'resource.name': method,\n          'span.type': 'http',\n          'http.method': method,\n          'http.url': uri\n        }\n      })\n\n      if (!(hasAmazonSignature(options) || !this.config.propagationFilter(uri))) {\n        this.tracer.inject(span, HTTP_HEADERS, options.headers)\n      }\n\n      analyticsSampler.sample(span, this.config.measured)\n      this.enter(span, store)\n    })\n\n    this.addSub('apm:http:client:request:finish', ({ req, res }) => {\n      const span = storage.getStore().span\n      if (res) {\n        span.setTag(HTTP_STATUS_CODE, res.statusCode)\n\n        if (!this.config.validateStatus(res.statusCode)) {\n          span.setTag('error', 1)\n        }\n\n        addResponseHeaders(res, span, this.config)\n      }\n\n      addRequestHeaders(req, span, this.config)\n\n      this.config.hooks.request(span, req, res)\n      span.finish()\n    })\n\n    this.addSub('apm:http:client:request:error', errorHandler)\n  }\n\n  configure (config) {\n    return super.configure(normalizeClientConfig(config))\n  }\n}\n\nfunction errorHandler (err) {\n  const span = storage.getStore().span\n\n  if (err) {\n    span.addTags({\n      'error.type': err.name,\n      'error.msg': err.message,\n      'error.stack': err.stack\n    })\n  } else {\n    span.setTag('error', 1)\n  }\n}\n\nfunction addResponseHeaders (res, span, config) {\n  config.headers.forEach(key => {\n    const value = res.headers[key]\n\n    if (value) {\n      span.setTag(`${HTTP_RESPONSE_HEADERS}.${key}`, value)\n    }\n  })\n}\n\nfunction addRequestHeaders (req, span, config) {\n  config.headers.forEach(key => {\n    const value = req.getHeader(key)\n\n    if (value) {\n      span.setTag(`${HTTP_REQUEST_HEADERS}.${key}`, value)\n    }\n  })\n}\n\nfunction normalizeClientConfig (config) {\n  const validateStatus = getStatusValidator(config)\n  const propagationFilter = getFilter({ blocklist: config.propagationBlocklist })\n  const headers = getHeaders(config)\n  const hooks = getHooks(config)\n\n  return Object.assign({}, config, {\n    validateStatus,\n    propagationFilter,\n    headers,\n    hooks\n  })\n}\n\nfunction getStatusValidator (config) {\n  if (typeof config.validateStatus === 'function') {\n    return config.validateStatus\n  } else if (config.hasOwnProperty('validateStatus')) {\n    log.error('Expected `validateStatus` to be a function.')\n  }\n  return code => code < 400 || code >= 500\n}\n\nfunction getFilter (config) {\n  config = Object.assign({}, config, {\n    blocklist: config.blocklist || []\n  })\n\n  return urlFilter.getFilter(config)\n}\n\nfunction getHeaders (config) {\n  if (!Array.isArray(config.headers)) return []\n\n  return config.headers\n    .filter(key => typeof key === 'string')\n    .map(key => key.toLowerCase())\n}\n\nfunction getHooks (config) {\n  const noop = () => {}\n  const request = (config.hooks && config.hooks.request) || noop\n\n  return { request }\n}\n\nfunction hasAmazonSignature (options) {\n  if (!options) {\n    return false\n  }\n\n  if (options.headers) {\n    const headers = Object.keys(options.headers)\n      .reduce((prev, next) => Object.assign(prev, {\n        [next.toLowerCase()]: options.headers[next]\n      }), {})\n\n    if (headers['x-amz-signature']) {\n      return true\n    }\n\n    if ([].concat(headers['authorization']).some(startsWith('AWS4-HMAC-SHA256'))) {\n      return true\n    }\n  }\n\n  return options.path && options.path.toLowerCase().indexOf('x-amz-signature=') !== -1\n}\n\nfunction getServiceName (tracer, config, options) {\n  if (config.splitByDomain) {\n    return getHost(options)\n  } else if (config.service) {\n    return config.service\n  }\n\n  return `${tracer._service}-http-client`\n}\n\nfunction getHost (options) {\n  if (typeof options === 'string') {\n    return url.parse(options).host\n  }\n\n  const hostname = options.hostname || options.host || 'localhost'\n  const port = options.port\n\n  return [hostname, port].filter(val => val).join(':')\n}\n\nfunction startsWith (searchString) {\n  return value => String(value).startsWith(searchString)\n}\n\nmodule.exports = HttpClientPlugin\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}