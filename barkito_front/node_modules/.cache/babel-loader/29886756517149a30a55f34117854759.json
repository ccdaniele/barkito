{"ast":null,"code":"'use strict'; // Plugin temporarily disabled. See https://github.com/DataDog/dd-trace-js/issues/312\n\nconst Plugin = require('../../dd-trace/src/plugins/plugin');\n\nconst {\n  storage\n} = require('../../datadog-core');\n\nconst web = require('../../dd-trace/src/plugins/util/web');\n\nconst {\n  incomingHttpRequestStart\n} = require('../../dd-trace/src/appsec/gateway/channels');\n\nclass Http2ServerPlugin extends Plugin {\n  static get name() {\n    return 'http2';\n  }\n\n  constructor() {\n    super(...arguments);\n    this.addSub('apm:http2:server:request:start', _ref => {\n      let {\n        req,\n        res\n      } = _ref;\n      const store = storage.getStore();\n      const span = web.startSpan(this.tracer, this.config, req, res, 'web.request');\n      this.enter(span, { ...store,\n        req\n      });\n      const context = web.getContext(req);\n\n      if (!context.instrumented) {\n        context.res.writeHead = web.wrapWriteHead(context);\n        context.instrumented = true;\n      }\n\n      if (incomingHttpRequestStart.hasSubscribers) {\n        incomingHttpRequestStart.publish({\n          req,\n          res\n        });\n      }\n    });\n    this.addSub('apm:http2:server:request:error', error => {\n      web.addError(error);\n    });\n    this.addSub('apm:http2:server:request:finish', _ref2 => {\n      let {\n        req\n      } = _ref2;\n      const context = web.getContext(req);\n      if (!context || !context.res) return; // Not created by a http.Server instance.\n\n      web.finishAll(context);\n    });\n  }\n\n  configure(config) {\n    return super.configure(web.normalizeConfig(config));\n  }\n\n}\n\nmodule.exports = Http2ServerPlugin;","map":{"version":3,"names":["Plugin","require","storage","web","incomingHttpRequestStart","Http2ServerPlugin","name","constructor","addSub","req","res","store","getStore","span","startSpan","tracer","config","enter","context","getContext","instrumented","writeHead","wrapWriteHead","hasSubscribers","publish","error","addError","finishAll","configure","normalizeConfig","module","exports"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/datadog-plugin-http2/src/server.js"],"sourcesContent":["'use strict'\n\n// Plugin temporarily disabled. See https://github.com/DataDog/dd-trace-js/issues/312\n\nconst Plugin = require('../../dd-trace/src/plugins/plugin')\nconst { storage } = require('../../datadog-core')\nconst web = require('../../dd-trace/src/plugins/util/web')\nconst { incomingHttpRequestStart } = require('../../dd-trace/src/appsec/gateway/channels')\n\nclass Http2ServerPlugin extends Plugin {\n  static get name () {\n    return 'http2'\n  }\n\n  constructor (...args) {\n    super(...args)\n\n    this.addSub('apm:http2:server:request:start', ({ req, res }) => {\n      const store = storage.getStore()\n      const span = web.startSpan(this.tracer, this.config, req, res, 'web.request')\n\n      this.enter(span, { ...store, req })\n\n      const context = web.getContext(req)\n\n      if (!context.instrumented) {\n        context.res.writeHead = web.wrapWriteHead(context)\n        context.instrumented = true\n      }\n\n      if (incomingHttpRequestStart.hasSubscribers) {\n        incomingHttpRequestStart.publish({ req, res })\n      }\n    })\n\n    this.addSub('apm:http2:server:request:error', (error) => {\n      web.addError(error)\n    })\n\n    this.addSub('apm:http2:server:request:finish', ({ req }) => {\n      const context = web.getContext(req)\n\n      if (!context || !context.res) return // Not created by a http.Server instance.\n\n      web.finishAll(context)\n    })\n  }\n\n  configure (config) {\n    return super.configure(web.normalizeConfig(config))\n  }\n}\n\nmodule.exports = Http2ServerPlugin\n"],"mappings":"AAAA,a,CAEA;;AAEA,MAAMA,MAAM,GAAGC,OAAO,CAAC,mCAAD,CAAtB;;AACA,MAAM;EAAEC;AAAF,IAAcD,OAAO,CAAC,oBAAD,CAA3B;;AACA,MAAME,GAAG,GAAGF,OAAO,CAAC,qCAAD,CAAnB;;AACA,MAAM;EAAEG;AAAF,IAA+BH,OAAO,CAAC,4CAAD,CAA5C;;AAEA,MAAMI,iBAAN,SAAgCL,MAAhC,CAAuC;EACtB,WAAJM,IAAI,GAAI;IACjB,OAAO,OAAP;EACD;;EAEDC,WAAW,GAAW;IACpB,MAAM,YAAN;IAEA,KAAKC,MAAL,CAAY,gCAAZ,EAA8C,QAAkB;MAAA,IAAjB;QAAEC,GAAF;QAAOC;MAAP,CAAiB;MAC9D,MAAMC,KAAK,GAAGT,OAAO,CAACU,QAAR,EAAd;MACA,MAAMC,IAAI,GAAGV,GAAG,CAACW,SAAJ,CAAc,KAAKC,MAAnB,EAA2B,KAAKC,MAAhC,EAAwCP,GAAxC,EAA6CC,GAA7C,EAAkD,aAAlD,CAAb;MAEA,KAAKO,KAAL,CAAWJ,IAAX,EAAiB,EAAE,GAAGF,KAAL;QAAYF;MAAZ,CAAjB;MAEA,MAAMS,OAAO,GAAGf,GAAG,CAACgB,UAAJ,CAAeV,GAAf,CAAhB;;MAEA,IAAI,CAACS,OAAO,CAACE,YAAb,EAA2B;QACzBF,OAAO,CAACR,GAAR,CAAYW,SAAZ,GAAwBlB,GAAG,CAACmB,aAAJ,CAAkBJ,OAAlB,CAAxB;QACAA,OAAO,CAACE,YAAR,GAAuB,IAAvB;MACD;;MAED,IAAIhB,wBAAwB,CAACmB,cAA7B,EAA6C;QAC3CnB,wBAAwB,CAACoB,OAAzB,CAAiC;UAAEf,GAAF;UAAOC;QAAP,CAAjC;MACD;IACF,CAhBD;IAkBA,KAAKF,MAAL,CAAY,gCAAZ,EAA+CiB,KAAD,IAAW;MACvDtB,GAAG,CAACuB,QAAJ,CAAaD,KAAb;IACD,CAFD;IAIA,KAAKjB,MAAL,CAAY,iCAAZ,EAA+C,SAAa;MAAA,IAAZ;QAAEC;MAAF,CAAY;MAC1D,MAAMS,OAAO,GAAGf,GAAG,CAACgB,UAAJ,CAAeV,GAAf,CAAhB;MAEA,IAAI,CAACS,OAAD,IAAY,CAACA,OAAO,CAACR,GAAzB,EAA8B,OAH4B,CAGrB;;MAErCP,GAAG,CAACwB,SAAJ,CAAcT,OAAd;IACD,CAND;EAOD;;EAEDU,SAAS,CAAEZ,MAAF,EAAU;IACjB,OAAO,MAAMY,SAAN,CAAgBzB,GAAG,CAAC0B,eAAJ,CAAoBb,MAApB,CAAhB,CAAP;EACD;;AAzCoC;;AA4CvCc,MAAM,CAACC,OAAP,GAAiB1B,iBAAjB"},"metadata":{},"sourceType":"script"}