{"ast":null,"code":"'use strict';\n\nconst {\n  storage\n} = require('../../datadog-core');\n\nconst Plugin = require('../../dd-trace/src/plugins/plugin');\n\nconst URL = require('url').URL;\n\nconst log = require('../../dd-trace/src/log');\n\nconst tags = require('../../../ext/tags');\n\nconst kinds = require('../../../ext/kinds');\n\nconst formats = require('../../../ext/formats');\n\nconst analyticsSampler = require('../../dd-trace/src/analytics_sampler');\n\nconst HTTP_HEADERS = formats.HTTP_HEADERS;\nconst HTTP_STATUS_CODE = tags.HTTP_STATUS_CODE;\nconst HTTP_REQUEST_HEADERS = tags.HTTP_REQUEST_HEADERS;\nconst HTTP_RESPONSE_HEADERS = tags.HTTP_RESPONSE_HEADERS;\nconst SPAN_KIND = tags.SPAN_KIND;\nconst CLIENT = kinds.CLIENT;\nconst HTTP2_HEADER_METHOD = ':method';\nconst HTTP2_HEADER_PATH = ':path';\nconst HTTP2_HEADER_STATUS = ':status';\nconst HTTP2_METHOD_GET = 'GET';\n\nclass Http2ClientPlugin extends Plugin {\n  static get name() {\n    return 'http2';\n  }\n\n  constructor() {\n    super(...arguments);\n    this.addSub('apm:http2:client:request:start', _ref => {\n      let {\n        authority,\n        options,\n        headers = {}\n      } = _ref;\n      const sessionDetails = extractSessionDetails(authority, options);\n      const path = headers[HTTP2_HEADER_PATH] || '/';\n      const pathname = path.split(/[?#]/)[0];\n      const method = headers[HTTP2_HEADER_METHOD] || HTTP2_METHOD_GET;\n      const uri = `${sessionDetails.protocol}//${sessionDetails.host}:${sessionDetails.port}${pathname}`;\n      const store = storage.getStore();\n      const childOf = store ? store.span : store;\n      const span = this.tracer.startSpan('http.request', {\n        childOf,\n        tags: {\n          [SPAN_KIND]: CLIENT,\n          'service.name': getServiceName(this.tracer, this.config, sessionDetails),\n          'resource.name': method,\n          'span.type': 'http',\n          'http.method': method,\n          'http.url': uri\n        }\n      });\n      addHeaderTags(span, headers, HTTP_REQUEST_HEADERS, this.config);\n\n      if (!hasAmazonSignature(headers, path)) {\n        this.tracer.inject(span, HTTP_HEADERS, headers);\n      }\n\n      analyticsSampler.sample(span, this.config.measured);\n      this.enter(span, store);\n    });\n    this.addSub('apm:http2:client:response', headers => {\n      const span = storage.getStore().span;\n      const status = headers && headers[HTTP2_HEADER_STATUS];\n      span.setTag(HTTP_STATUS_CODE, status);\n\n      if (!this.config.validateStatus(status)) {\n        this.addError();\n      }\n\n      addHeaderTags(span, headers, HTTP_RESPONSE_HEADERS, this.config);\n    });\n    this.addSub('apm:http2:client:request:finish', () => {\n      const span = storage.getStore().span;\n      span.finish();\n    });\n    this.addSub('apm:http2:client:request:error', this.addError);\n  }\n\n  configure(config) {\n    return super.configure(normalizeConfig(config));\n  }\n\n}\n\nfunction extractSessionDetails(authority, options) {\n  if (typeof authority === 'string') {\n    authority = new URL(authority);\n  }\n\n  const protocol = authority.protocol || options.protocol || 'https:';\n  let port = '' + (authority.port !== '' ? authority.port : authority.protocol === 'http:' ? 80 : 443);\n  let host = authority.hostname || authority.host || 'localhost';\n\n  if (protocol === 'https:' && options) {\n    port = options.port || port;\n    host = options.host || host;\n  }\n\n  return {\n    protocol,\n    port,\n    host\n  };\n}\n\nfunction getFormattedHostString(host, port) {\n  return [host, port].filter(val => val).join(':');\n}\n\nfunction getServiceName(tracer, config, sessionDetails) {\n  if (config.splitByDomain) {\n    return getFormattedHostString(sessionDetails.host, sessionDetails.port);\n  } else if (config.service) {\n    return config.service;\n  }\n\n  return `${tracer._service}-http-client`;\n}\n\nfunction hasAmazonSignature(headers, path) {\n  if (headers) {\n    headers = Object.keys(headers).reduce((prev, next) => Object.assign(prev, {\n      [next.toLowerCase()]: headers[next]\n    }), {});\n\n    if (headers['x-amz-signature']) {\n      return true;\n    }\n\n    if ([].concat(headers['authorization']).some(startsWith('AWS4-HMAC-SHA256'))) {\n      return true;\n    }\n  }\n\n  return path && path.toLowerCase().indexOf('x-amz-signature=') !== -1;\n}\n\nfunction startsWith(searchString) {\n  return value => String(value).startsWith(searchString);\n}\n\nfunction getStatusValidator(config) {\n  if (typeof config.validateStatus === 'function') {\n    return config.validateStatus;\n  } else if (config.hasOwnProperty('validateStatus')) {\n    log.error('Expected `validateStatus` to be a function.');\n  }\n\n  return code => code < 400 || code >= 500;\n}\n\nfunction normalizeConfig(config) {\n  const validateStatus = getStatusValidator(config);\n  const headers = getHeaders(config);\n  return Object.assign({}, config, {\n    validateStatus,\n    headers\n  });\n}\n\nfunction addHeaderTags(span, headers, prefix, config) {\n  if (!headers) return;\n  config.headers.forEach(key => {\n    const value = headers[key];\n\n    if (value) {\n      span.setTag(`${prefix}.${key}`, value);\n    }\n  });\n}\n\nfunction getHeaders(config) {\n  if (!Array.isArray(config.headers)) return [];\n  return config.headers.filter(key => typeof key === 'string').map(key => key.toLowerCase());\n}\n\nmodule.exports = Http2ClientPlugin;","map":{"version":3,"names":["storage","require","Plugin","URL","log","tags","kinds","formats","analyticsSampler","HTTP_HEADERS","HTTP_STATUS_CODE","HTTP_REQUEST_HEADERS","HTTP_RESPONSE_HEADERS","SPAN_KIND","CLIENT","HTTP2_HEADER_METHOD","HTTP2_HEADER_PATH","HTTP2_HEADER_STATUS","HTTP2_METHOD_GET","Http2ClientPlugin","name","constructor","addSub","authority","options","headers","sessionDetails","extractSessionDetails","path","pathname","split","method","uri","protocol","host","port","store","getStore","childOf","span","tracer","startSpan","getServiceName","config","addHeaderTags","hasAmazonSignature","inject","sample","measured","enter","status","setTag","validateStatus","addError","finish","configure","normalizeConfig","hostname","getFormattedHostString","filter","val","join","splitByDomain","service","_service","Object","keys","reduce","prev","next","assign","toLowerCase","concat","some","startsWith","indexOf","searchString","value","String","getStatusValidator","hasOwnProperty","error","code","getHeaders","prefix","forEach","key","Array","isArray","map","module","exports"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/datadog-plugin-http2/src/client.js"],"sourcesContent":["'use strict'\n\nconst { storage } = require('../../datadog-core')\nconst Plugin = require('../../dd-trace/src/plugins/plugin')\n\nconst URL = require('url').URL\nconst log = require('../../dd-trace/src/log')\nconst tags = require('../../../ext/tags')\nconst kinds = require('../../../ext/kinds')\nconst formats = require('../../../ext/formats')\nconst analyticsSampler = require('../../dd-trace/src/analytics_sampler')\n\nconst HTTP_HEADERS = formats.HTTP_HEADERS\nconst HTTP_STATUS_CODE = tags.HTTP_STATUS_CODE\nconst HTTP_REQUEST_HEADERS = tags.HTTP_REQUEST_HEADERS\nconst HTTP_RESPONSE_HEADERS = tags.HTTP_RESPONSE_HEADERS\nconst SPAN_KIND = tags.SPAN_KIND\nconst CLIENT = kinds.CLIENT\n\nconst HTTP2_HEADER_METHOD = ':method'\nconst HTTP2_HEADER_PATH = ':path'\nconst HTTP2_HEADER_STATUS = ':status'\nconst HTTP2_METHOD_GET = 'GET'\n\nclass Http2ClientPlugin extends Plugin {\n  static get name () {\n    return 'http2'\n  }\n\n  constructor (...args) {\n    super(...args)\n\n    this.addSub('apm:http2:client:request:start', ({ authority, options, headers = {} }) => {\n      const sessionDetails = extractSessionDetails(authority, options)\n      const path = headers[HTTP2_HEADER_PATH] || '/'\n      const pathname = path.split(/[?#]/)[0]\n      const method = headers[HTTP2_HEADER_METHOD] || HTTP2_METHOD_GET\n      const uri = `${sessionDetails.protocol}//${sessionDetails.host}:${sessionDetails.port}${pathname}`\n\n      const store = storage.getStore()\n      const childOf = store ? store.span : store\n      const span = this.tracer.startSpan('http.request', {\n        childOf,\n        tags: {\n          [SPAN_KIND]: CLIENT,\n          'service.name': getServiceName(this.tracer, this.config, sessionDetails),\n          'resource.name': method,\n          'span.type': 'http',\n          'http.method': method,\n          'http.url': uri\n        }\n      })\n\n      addHeaderTags(span, headers, HTTP_REQUEST_HEADERS, this.config)\n\n      if (!hasAmazonSignature(headers, path)) {\n        this.tracer.inject(span, HTTP_HEADERS, headers)\n      }\n\n      analyticsSampler.sample(span, this.config.measured)\n\n      this.enter(span, store)\n    })\n\n    this.addSub('apm:http2:client:response', (headers) => {\n      const span = storage.getStore().span\n      const status = headers && headers[HTTP2_HEADER_STATUS]\n\n      span.setTag(HTTP_STATUS_CODE, status)\n\n      if (!this.config.validateStatus(status)) {\n        this.addError()\n      }\n\n      addHeaderTags(span, headers, HTTP_RESPONSE_HEADERS, this.config)\n    })\n\n    this.addSub('apm:http2:client:request:finish', () => {\n      const span = storage.getStore().span\n\n      span.finish()\n    })\n\n    this.addSub('apm:http2:client:request:error', this.addError)\n  }\n\n  configure (config) {\n    return super.configure(normalizeConfig(config))\n  }\n}\n\nfunction extractSessionDetails (authority, options) {\n  if (typeof authority === 'string') {\n    authority = new URL(authority)\n  }\n\n  const protocol = authority.protocol || options.protocol || 'https:'\n  let port = '' + (authority.port !== ''\n    ? authority.port : (authority.protocol === 'http:' ? 80 : 443))\n  let host = authority.hostname || authority.host || 'localhost'\n\n  if (protocol === 'https:' && options) {\n    port = options.port || port\n    host = options.host || host\n  }\n\n  return { protocol, port, host }\n}\n\nfunction getFormattedHostString (host, port) {\n  return [host, port].filter(val => val).join(':')\n}\n\nfunction getServiceName (tracer, config, sessionDetails) {\n  if (config.splitByDomain) {\n    return getFormattedHostString(sessionDetails.host, sessionDetails.port)\n  } else if (config.service) {\n    return config.service\n  }\n\n  return `${tracer._service}-http-client`\n}\n\nfunction hasAmazonSignature (headers, path) {\n  if (headers) {\n    headers = Object.keys(headers)\n      .reduce((prev, next) => Object.assign(prev, {\n        [next.toLowerCase()]: headers[next]\n      }), {})\n\n    if (headers['x-amz-signature']) {\n      return true\n    }\n\n    if ([].concat(headers['authorization']).some(startsWith('AWS4-HMAC-SHA256'))) {\n      return true\n    }\n  }\n\n  return path && path.toLowerCase().indexOf('x-amz-signature=') !== -1\n}\n\nfunction startsWith (searchString) {\n  return value => String(value).startsWith(searchString)\n}\n\nfunction getStatusValidator (config) {\n  if (typeof config.validateStatus === 'function') {\n    return config.validateStatus\n  } else if (config.hasOwnProperty('validateStatus')) {\n    log.error('Expected `validateStatus` to be a function.')\n  }\n  return code => code < 400 || code >= 500\n}\n\nfunction normalizeConfig (config) {\n  const validateStatus = getStatusValidator(config)\n  const headers = getHeaders(config)\n\n  return Object.assign({}, config, {\n    validateStatus,\n    headers\n  })\n}\n\nfunction addHeaderTags (span, headers, prefix, config) {\n  if (!headers) return\n\n  config.headers.forEach(key => {\n    const value = headers[key]\n\n    if (value) {\n      span.setTag(`${prefix}.${key}`, value)\n    }\n  })\n}\n\nfunction getHeaders (config) {\n  if (!Array.isArray(config.headers)) return []\n\n  return config.headers\n    .filter(key => typeof key === 'string')\n    .map(key => key.toLowerCase())\n}\n\nmodule.exports = Http2ClientPlugin\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}