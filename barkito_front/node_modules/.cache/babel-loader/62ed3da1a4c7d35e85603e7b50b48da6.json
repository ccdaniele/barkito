{"ast":null,"code":"'use strict';\n\nconst als = require('../als');\n\nlet lock = false; // lock to prevent recursive calls to runSubscriptions\n\nfunction runSubscriptions(subscriptions, params) {\n  const results = [];\n  if (lock || !subscriptions.size) return results;\n  lock = true;\n  const store = als.getStore(); // TODO: possible optimization\n  // can we deduplicate those before ?\n\n  const executedCallbacks = new Set();\n\n  for (const subscription of subscriptions) {\n    if (executedCallbacks.has(subscription.callback)) continue;\n    executedCallbacks.add(subscription.callback);\n    let result;\n\n    try {\n      result = subscription.callback.method(params, store);\n    } catch (err) {\n      // TODO: log ?\n      result = {};\n    }\n\n    results.push(result);\n  }\n\n  lock = false;\n  return results;\n}\n\nmodule.exports = {\n  runSubscriptions\n};","map":{"version":3,"names":["als","require","lock","runSubscriptions","subscriptions","params","results","size","store","getStore","executedCallbacks","Set","subscription","has","callback","add","result","method","err","push","module","exports"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/dd-trace/src/appsec/gateway/engine/runner.js"],"sourcesContent":["'use strict'\n\nconst als = require('../als')\n\nlet lock = false // lock to prevent recursive calls to runSubscriptions\n\nfunction runSubscriptions (subscriptions, params) {\n  const results = []\n\n  if (lock || !subscriptions.size) return results\n  lock = true\n\n  const store = als.getStore()\n\n  // TODO: possible optimization\n  // can we deduplicate those before ?\n  const executedCallbacks = new Set()\n\n  for (const subscription of subscriptions) {\n    if (executedCallbacks.has(subscription.callback)) continue\n    executedCallbacks.add(subscription.callback)\n\n    let result\n\n    try {\n      result = subscription.callback.method(params, store)\n    } catch (err) {\n      // TODO: log ?\n      result = {}\n    }\n\n    results.push(result)\n  }\n\n  lock = false\n\n  return results\n}\n\nmodule.exports = {\n  runSubscriptions\n}\n"],"mappings":"AAAA;;AAEA,MAAMA,GAAG,GAAGC,OAAO,CAAC,QAAD,CAAnB;;AAEA,IAAIC,IAAI,GAAG,KAAX,C,CAAiB;;AAEjB,SAASC,gBAAT,CAA2BC,aAA3B,EAA0CC,MAA1C,EAAkD;EAChD,MAAMC,OAAO,GAAG,EAAhB;EAEA,IAAIJ,IAAI,IAAI,CAACE,aAAa,CAACG,IAA3B,EAAiC,OAAOD,OAAP;EACjCJ,IAAI,GAAG,IAAP;EAEA,MAAMM,KAAK,GAAGR,GAAG,CAACS,QAAJ,EAAd,CANgD,CAQhD;EACA;;EACA,MAAMC,iBAAiB,GAAG,IAAIC,GAAJ,EAA1B;;EAEA,KAAK,MAAMC,YAAX,IAA2BR,aAA3B,EAA0C;IACxC,IAAIM,iBAAiB,CAACG,GAAlB,CAAsBD,YAAY,CAACE,QAAnC,CAAJ,EAAkD;IAClDJ,iBAAiB,CAACK,GAAlB,CAAsBH,YAAY,CAACE,QAAnC;IAEA,IAAIE,MAAJ;;IAEA,IAAI;MACFA,MAAM,GAAGJ,YAAY,CAACE,QAAb,CAAsBG,MAAtB,CAA6BZ,MAA7B,EAAqCG,KAArC,CAAT;IACD,CAFD,CAEE,OAAOU,GAAP,EAAY;MACZ;MACAF,MAAM,GAAG,EAAT;IACD;;IAEDV,OAAO,CAACa,IAAR,CAAaH,MAAb;EACD;;EAEDd,IAAI,GAAG,KAAP;EAEA,OAAOI,OAAP;AACD;;AAEDc,MAAM,CAACC,OAAP,GAAiB;EACflB;AADe,CAAjB"},"metadata":{},"sourceType":"script"}