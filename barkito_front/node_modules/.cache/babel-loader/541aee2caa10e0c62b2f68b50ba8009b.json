{"ast":null,"code":"'use strict';\n\nconst path = require('path');\n\nconst iitm = require('../../../dd-trace/src/iitm');\n\nconst ritm = require('../../../dd-trace/src/ritm');\n\nfunction Hook(modules, onrequire) {\n  if (!(this instanceof Hook)) return new Hook(modules, onrequire);\n  this._patched = Object.create(null);\n\n  const safeHook = (moduleExports, moduleName, moduleBaseDir) => {\n    const parts = [moduleBaseDir, moduleName].filter(v => v);\n    const filename = path.join(...parts);\n    if (this._patched[filename]) return moduleExports;\n    this._patched[filename] = true;\n    return onrequire(moduleExports, moduleName, moduleBaseDir);\n  };\n\n  this._ritmHook = ritm(modules, {}, safeHook);\n  this._iitmHook = iitm(modules, {}, (moduleExports, moduleName, moduleBaseDir) => {\n    // TODO: Move this logic to import-in-the-middle and only do it for CommonJS\n    // modules and not ESM. In the meantime, all the modules we instrument are\n    // CommonJS modules for which the default export is always moved to\n    // `default` anyway.\n    if (moduleExports && moduleExports.default) {\n      moduleExports.default = safeHook(moduleExports.default, moduleName, moduleBaseDir);\n      return moduleExports;\n    } else {\n      return safeHook(moduleExports, moduleName, moduleBaseDir);\n    }\n  });\n}\n\nHook.prototype.unhook = function () {\n  this._ritmHook.unhook();\n\n  this._iitmHook.unhook();\n\n  this._patched = Object.create(null);\n};\n\nmodule.exports = Hook;","map":{"version":3,"names":["path","require","iitm","ritm","Hook","modules","onrequire","_patched","Object","create","safeHook","moduleExports","moduleName","moduleBaseDir","parts","filter","v","filename","join","_ritmHook","_iitmHook","default","prototype","unhook","module","exports"],"sources":["/Users/daniel.calderon/Projects/barkito/barkito_front/node_modules/dd-trace/packages/datadog-instrumentations/src/helpers/hook.js"],"sourcesContent":["'use strict'\n\nconst path = require('path')\nconst iitm = require('../../../dd-trace/src/iitm')\nconst ritm = require('../../../dd-trace/src/ritm')\n\nfunction Hook (modules, onrequire) {\n  if (!(this instanceof Hook)) return new Hook(modules, onrequire)\n\n  this._patched = Object.create(null)\n\n  const safeHook = (moduleExports, moduleName, moduleBaseDir) => {\n    const parts = [moduleBaseDir, moduleName].filter(v => v)\n    const filename = path.join(...parts)\n\n    if (this._patched[filename]) return moduleExports\n\n    this._patched[filename] = true\n\n    return onrequire(moduleExports, moduleName, moduleBaseDir)\n  }\n\n  this._ritmHook = ritm(modules, {}, safeHook)\n  this._iitmHook = iitm(modules, {}, (moduleExports, moduleName, moduleBaseDir) => {\n    // TODO: Move this logic to import-in-the-middle and only do it for CommonJS\n    // modules and not ESM. In the meantime, all the modules we instrument are\n    // CommonJS modules for which the default export is always moved to\n    // `default` anyway.\n    if (moduleExports && moduleExports.default) {\n      moduleExports.default = safeHook(moduleExports.default, moduleName, moduleBaseDir)\n      return moduleExports\n    } else {\n      return safeHook(moduleExports, moduleName, moduleBaseDir)\n    }\n  })\n}\n\nHook.prototype.unhook = function () {\n  this._ritmHook.unhook()\n  this._iitmHook.unhook()\n  this._patched = Object.create(null)\n}\n\nmodule.exports = Hook\n"],"mappings":"AAAA;;AAEA,MAAMA,IAAI,GAAGC,OAAO,CAAC,MAAD,CAApB;;AACA,MAAMC,IAAI,GAAGD,OAAO,CAAC,4BAAD,CAApB;;AACA,MAAME,IAAI,GAAGF,OAAO,CAAC,4BAAD,CAApB;;AAEA,SAASG,IAAT,CAAeC,OAAf,EAAwBC,SAAxB,EAAmC;EACjC,IAAI,EAAE,gBAAgBF,IAAlB,CAAJ,EAA6B,OAAO,IAAIA,IAAJ,CAASC,OAAT,EAAkBC,SAAlB,CAAP;EAE7B,KAAKC,QAAL,GAAgBC,MAAM,CAACC,MAAP,CAAc,IAAd,CAAhB;;EAEA,MAAMC,QAAQ,GAAG,CAACC,aAAD,EAAgBC,UAAhB,EAA4BC,aAA5B,KAA8C;IAC7D,MAAMC,KAAK,GAAG,CAACD,aAAD,EAAgBD,UAAhB,EAA4BG,MAA5B,CAAmCC,CAAC,IAAIA,CAAxC,CAAd;IACA,MAAMC,QAAQ,GAAGjB,IAAI,CAACkB,IAAL,CAAU,GAAGJ,KAAb,CAAjB;IAEA,IAAI,KAAKP,QAAL,CAAcU,QAAd,CAAJ,EAA6B,OAAON,aAAP;IAE7B,KAAKJ,QAAL,CAAcU,QAAd,IAA0B,IAA1B;IAEA,OAAOX,SAAS,CAACK,aAAD,EAAgBC,UAAhB,EAA4BC,aAA5B,CAAhB;EACD,CATD;;EAWA,KAAKM,SAAL,GAAiBhB,IAAI,CAACE,OAAD,EAAU,EAAV,EAAcK,QAAd,CAArB;EACA,KAAKU,SAAL,GAAiBlB,IAAI,CAACG,OAAD,EAAU,EAAV,EAAc,CAACM,aAAD,EAAgBC,UAAhB,EAA4BC,aAA5B,KAA8C;IAC/E;IACA;IACA;IACA;IACA,IAAIF,aAAa,IAAIA,aAAa,CAACU,OAAnC,EAA4C;MAC1CV,aAAa,CAACU,OAAd,GAAwBX,QAAQ,CAACC,aAAa,CAACU,OAAf,EAAwBT,UAAxB,EAAoCC,aAApC,CAAhC;MACA,OAAOF,aAAP;IACD,CAHD,MAGO;MACL,OAAOD,QAAQ,CAACC,aAAD,EAAgBC,UAAhB,EAA4BC,aAA5B,CAAf;IACD;EACF,CAXoB,CAArB;AAYD;;AAEDT,IAAI,CAACkB,SAAL,CAAeC,MAAf,GAAwB,YAAY;EAClC,KAAKJ,SAAL,CAAeI,MAAf;;EACA,KAAKH,SAAL,CAAeG,MAAf;;EACA,KAAKhB,QAAL,GAAgBC,MAAM,CAACC,MAAP,CAAc,IAAd,CAAhB;AACD,CAJD;;AAMAe,MAAM,CAACC,OAAP,GAAiBrB,IAAjB"},"metadata":{},"sourceType":"script"}